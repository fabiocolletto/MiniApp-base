<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>App 5 Horas - Header</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,300..700,0..1,-50..200" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
:root{color-scheme:light dark;--page-bg:0 0 0;--page-bg-alpha:.92;--page-fg:248 250 252;}html[data-theme="light"]{--page-bg:248 250 252;--page-bg-alpha:.96;--page-fg:15 23 42;}.text-warn{color:#fbbf24;}
</style>
</head>
<body class="min-h-screen font-inter text-[rgb(var(--page-fg))] bg-[rgb(var(--page-bg)/var(--page-bg-alpha))]">

<div class="fixed top-0 inset-x-0 z-50 flex justify-end px-4 py-4 rounded-b-3xl border-b border-white/10 backdrop-blur-md bg-black/20">
<button data-theme-toggle class="inline-flex items-center gap-2 rounded-full border border-emerald-500/40 bg-emerald-400/10 px-3 py-2 text-sm font-medium hover:bg-emerald-400/20 transition" aria-label="Alternar tema">
  <span data-theme-icon class="material-symbols-rounded">dark_mode</span>
  <span class="sr-only" data-theme-label>Usar tema escuro</span>
</button>
<button id="user-btn" class="inline-flex items-center gap-2 rounded-full border border-sky-500/40 bg-sky-400/10 px-3 py-2 text-sm font-medium hover:bg-sky-400/20 transition ml-2"><span class="material-symbols-rounded">account_circle</span></button>
</div>

<div id="user-panel" class="fixed inset-0 z-[70] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
<div id="user-container" class="relative bg-black/70 border border-white/10 rounded-3xl p-6 pt-14 w-96 shadow-xl text-white">
<button id="user-close" class="absolute top-3 left-3 rounded-full bg-white/10 hover:bg-white/20 p-2"><span class="material-symbols-rounded">close</span></button>
<button id="user-edit-icon" class="absolute top-3 right-3 rounded-full bg-white/10 hover:bg-white/20 p-2"><span class="material-symbols-rounded">edit</span></button>
<h2 class="text-xl font-semibold mb-4">Painel do Usuário</h2>
<div id="user-form" class="space-y-3 mb-5 hidden">
<input id="user-name" placeholder="Nome completo" class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/20 focus:outline-none" />
<input id="user-phone" placeholder="Telefone" class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/20 focus:outline-none" />
<input id="user-email" placeholder="E-mail" class="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/20 focus:outline-none" />
</div>
<div id="user-data" class="mb-4 text-sm space-y-2"></div>
<button id="sync-drive" class="mt-5 rounded-full border border-indigo-500/40 bg-indigo-400/10 px-3 py-2 text-sm w-full hover:bg-indigo-400/20">Backup para Google Drive</button>
<button id="delete-data" class="mt-3 rounded-full border border-red-500/40 bg-red-400/10 px-3 py-2 text-sm w-full hover:bg-red-400/20">Excluir meus dados</button>
<div id="status-bar" class="mt-6 pt-3 border-t border-white/10 text-xs opacity-80 text-center">Nenhum backup realizado</div>
</div></div>

<script>
(function(){
const DataService={async get(){return await localforage.getItem('user-data')||{};},async save(d){await localforage.setItem('user-data',d);},async clear(){await localforage.removeItem('user-data');}};

const ThemeService={
  storageKey:'theme',
  async load(){
    if(window.MiniappTheme){
      window.MiniappTheme.registerToggles?.();
      await window.MiniappTheme.init?.();
      return;
    }
    const localStored=localStorage.getItem(this.storageKey);
    const stored=localStored|| (window.localforage?.getItem?await window.localforage.getItem(this.storageKey):null);
    const sys=window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light';
    this.apply(stored||sys,{persist:false});
  },
  async persist(theme){
    localStorage.setItem(this.storageKey,theme);
    if(window.localforage?.setItem){
      await window.localforage.setItem(this.storageKey,theme);
    }
  },
  apply(t,{persist=true}={}){
    document.documentElement.setAttribute('data-theme',t);
    const isDark=t==='dark';
    document.querySelectorAll('[data-theme-icon]').forEach((el)=>{el.textContent=isDark?'light_mode':'dark_mode';});
    document.querySelectorAll('[data-theme-label]').forEach((el)=>{el.textContent=isDark?'Usar tema claro':'Usar tema escuro';});
    if(persist) this.persist(t);
  },
  toggle(){const c=document.documentElement.getAttribute('data-theme');this.apply(c==='dark'?'light':'dark');}
};

ThemeService.load();
document.querySelectorAll('[data-theme-toggle]').forEach((btn)=>{btn.onclick=()=>ThemeService.toggle();});

const userBtn=document.getElementById('user-btn'),userPanel=document.getElementById('user-panel'),userClose=document.getElementById('user-close'),userEditIcon=document.getElementById('user-edit-icon');
let isEditing=false;
userBtn.onclick=()=>{userPanel.classList.remove('hidden');userPanel.classList.add('flex');};
userClose.onclick=()=>{userPanel.classList.add('hidden');userPanel.classList.remove('flex');isEditing=false;userForm.classList.add('hidden');userData.classList.remove('hidden');};
userPanel.onclick=e=>{if(e.target===userPanel)userClose.onclick();};

const nameInput=document.getElementById('user-name'),phoneInput=document.getElementById('user-phone'),emailInput=document.getElementById('user-email');
const userForm=document.getElementById('user-form'),userData=document.getElementById('user-data'),statusBar=document.getElementById('status-bar');

function renderUser(d){userData.innerHTML=`<div><strong>Nome:</strong> ${d.name||''}</div><div><strong>Telefone:</strong> ${d.phone||''}</div><div><strong>E-mail:</strong> ${d.email||''}</div>`;}

let autoCC=false;function maskPhone(v){let n=v.replace(/\D/g,'');if(!autoCC&&n.length===0){n='55';autoCC=true;}if(n.length>13)n=n.slice(0,13);let cc=n.slice(0,2),ddd=n.slice(2,4),f=n.slice(4,9),l=n.slice(9,13);if(n.length<=2)return`+${cc}`;if(n.length<=4)return`+${cc} ${ddd}`;if(n.length<=9)return`+${cc} ${ddd} ${f}`;return`+${cc} ${ddd} ${f}-${l}`;}
phoneInput.oninput=()=>{phoneInput.value=maskPhone(phoneInput.value);};

function validateName(n){return n.trim().split(' ').length>=2;}
function validateEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);}function validatePhone(p){return p.replace(/\D/g,'').length>=10;}

async function saveLocal(){const n=nameInput.value.trim(),p=phoneInput.value.trim(),e=emailInput.value.trim();let error=!validateName(n)?'Nome incompleto — informe nome e sobrenome.':!validatePhone(p)?'Telefone incompleto — revise o número.':!validateEmail(e)?'E-mail inválido — revise o endereço.':'';statusBar.classList.remove('text-warn');if(error){statusBar.textContent=error;statusBar.classList.add('text-warn');return;}const updated={name:n,phone:p,email:e,updated:new Date().toLocaleString()};await DataService.save(updated);renderUser(updated);statusBar.textContent=`Último salvamento: ${updated.updated}`;}

nameInput.onblur=saveLocal;phoneInput.onblur=saveLocal;emailInput.onblur=saveLocal;

userEditIcon.onclick=()=>{isEditing=!isEditing;if(isEditing){userForm.classList.remove('hidden');userData.classList.add('hidden');}else{userForm.classList.add('hidden');userData.classList.remove('hidden');}};

document.getElementById('delete-data').onclick=async()=>{await DataService.clear();nameInput.value='';phoneInput.value='';emailInput.value='';userData.innerHTML='';statusBar.textContent='Dados excluídos';};

DataService.get().then(u=>{if(!u)return;nameInput.value=u.name||'';phoneInput.value=maskPhone(u.phone||'');emailInput.value=u.email||'';renderUser(u);statusBar.textContent=`Restaurado (última atualização: ${u.updated||'--'})`;});
})();
</script>
</body>
</html>
