<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro e Login</title>
    <!-- Carrega Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega Fontes e Ícones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200" rel="stylesheet"/>
    <style>
        /* Estilos básicos para o MiniApp */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    
    <div id="auth-card" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border-t-4 border-purple-600">
        <h1 class="text-3xl font-bold text-gray-800 mb-2" id="form-title">Entrar</h1>
        <p class="text-sm text-gray-500 mb-6" id="form-subtitle">Acesse sua conta ou crie um novo cadastro.</p>

        <div id="message-area" class="hidden p-3 mb-4 rounded-lg text-sm" role="alert"></div>

        <form id="auth-form" onsubmit="handleAuth(event)">
            <!-- CAMPO ALTERADO: De E-mail para Telefone -->
            <div class="mb-4">
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefone (com DDD)</label>
                <input type="tel" id="phone" required 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition" 
                       placeholder="(99) 99999-9999" pattern="[0-9]{10,15}" title="Insira um número válido (mínimo 10 dígitos)">
            </div>
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                <input type="password" id="password" required minlength="6"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition" 
                       placeholder="Mínimo 6 caracteres">
            </div>

            <button type="submit" id="submit-btn" 
                    class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2.5 rounded-lg shadow-md transition duration-150 flex items-center justify-center">
                <span id="loading-spinner" class="hidden animate-spin h-5 w-5 mr-3 border-b-2 border-white rounded-full"></span>
                <span id="button-text">Entrar</span>
            </button>
        </form>
        
        <div class="mt-4 text-center">
            <button id="toggle-mode-btn" onclick="toggleMode()" class="text-sm text-purple-600 hover:text-purple-700 transition">
                Ainda não tem conta? Cadastre-se
            </button>
        </div>
    </div>

    <!-- SCRIPT DE AUTENTICAÇÃO SIMULADA (SEM FIREBASE) -->
    <script>
        let isRegisterMode = false;
        
        // Simulação de usuário logado (armazenamento local)
        function setLocalUser(phoneNumber) {
            localStorage.setItem('user_phone', phoneNumber); // Armazena Telefone
        }

        function showMessage(type, message) {
            const messageArea = document.getElementById('message-area');
            messageArea.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            messageArea.innerHTML = message;

            if (type === 'error') {
                messageArea.classList.add('bg-red-100', 'text-red-700');
            } else if (type === 'success') {
                messageArea.classList.add('bg-green-100', 'text-green-700');
            }
        }

        function setFormLoading(isLoading) {
            const submitBtn = document.getElementById('submit-btn');
            const buttonText = document.getElementById('button-text');
            const spinner = document.getElementById('loading-spinner');
            
            submitBtn.disabled = isLoading;
            if (isLoading) {
                spinner.classList.remove('hidden');
                buttonText.textContent = isRegisterMode ? 'Registrando...' : 'Acessando...';
            } else {
                spinner.classList.add('hidden');
                buttonText.textContent = isRegisterMode ? 'Cadastrar' : 'Entrar';
            }
        }
        
        window.toggleMode = () => {
            isRegisterMode = !isRegisterMode;
            document.getElementById('form-title').textContent = isRegisterMode ? 'Novo Cadastro' : 'Entrar';
            document.getElementById('form-subtitle').textContent = isRegisterMode ? 'Crie sua conta com telefone e senha.' : 'Acesse sua conta para continuar.';
            document.getElementById('toggle-mode-btn').textContent = isRegisterMode ? 'Já tem conta? Entrar' : 'Ainda não tem conta? Cadastre-se';
            
            // As cores serão ajustadas dinamicamente com base no modo
            document.getElementById('submit-btn').classList.toggle('bg-purple-600', !isRegisterMode);
            document.getElementById('submit-btn').classList.toggle('hover:bg-purple-700', !isRegisterMode);
            document.getElementById('submit-btn').classList.toggle('bg-emerald-600', isRegisterMode);
            document.getElementById('submit-btn').classList.toggle('hover:bg-emerald-700', isRegisterMode);

            document.getElementById('submit-btn').querySelector('#button-text').textContent = isRegisterMode ? 'Cadastrar' : 'Entrar';
            document.getElementById('message-area').classList.add('hidden');
        };
        
        // Validação simples do número de telefone (apenas dígitos)
        function validatePhoneNumber(number) {
            // Remove caracteres não-dígitos para a verificação
            const cleanNumber = number.replace(/\D/g, ''); 
            // Permite um mínimo de 10 dígitos (DDD + 8 ou 9 dígitos)
            return cleanNumber.length >= 10; 
        }

        // --- FUNÇÃO DE AUTENTICAÇÃO SIMULADA (CHAMADA API) ---
        window.handleAuth = async (event) => {
            event.preventDefault();
            setFormLoading(true);
            document.getElementById('message-area').classList.add('hidden');

            const phoneNumber = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            
            if (!validatePhoneNumber(phoneNumber)) {
                showMessage('error', 'Por favor, insira um número de telefone válido (com DDD).');
                setFormLoading(false);
                return;
            }

            if (password.length < 6) {
                showMessage('error', 'A senha deve ter no mínimo 6 caracteres.');
                setFormLoading(false);
                return;
            }

            // SIMULAÇÃO DE CHAMADA SEGURA PARA API DE PLANILHA GOOGLE (2 SEGUNDOS)
            await new Promise(resolve => setTimeout(resolve, 2000)); 

            try {
                if (isRegisterMode) {
                    // SIMULAÇÃO: Registro bem-sucedido e dados enviados para a planilha
                    setLocalUser(phoneNumber); 
                    showMessage('success', `Sucesso! Cadastro enviado para a Planilha Google para validação. Você está logado como ${phoneNumber}.`);
                    
                    // Notifica a janela pai (o app React) para atualizar o estado de login
                    if (window.parent && window.parent.postMessage) {
                         window.parent.postMessage({ type: 'AUTH_SUCCESS', phone: phoneNumber }, '*');
                    }
                    
                } else {
                    // SIMULAÇÃO: Login bem-sucedido
                    setLocalUser(phoneNumber); 
                    showMessage('success', `Acesso realizado com sucesso! Bem-vindo(a), ${phoneNumber}.`);
                    
                    // Notifica a janela pai (o app React) para atualizar o estado de login
                    if (window.parent && window.parent.postMessage) {
                         window.parent.postMessage({ type: 'AUTH_SUCCESS', phone: phoneNumber }, '*');
                    }
                }
                
            } catch (error) {
                // Caso a simulação falhe (apenas para exemplo)
                showMessage('error', 'Erro na comunicação com o servidor de Planilhas Google.');
            } finally {
                setFormLoading(false);
            }
        };

        // Estado inicial de UI
        if (localStorage.getItem('user_phone')) { // Verifica 'user_phone'
            document.getElementById('form-title').textContent = 'Bem-vindo(a) de Volta!';
            document.getElementById('form-subtitle').textContent = `Usuário atual: ${localStorage.getItem('user_phone')}. Clique em Entrar para continuar.`;
        }
    </script>

</body>
</html>
