<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfólio de Aplicações</title>
    <!-- Tailwind CDN (Para manter a estética consistente) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background: transparent; font-family: 'Inter', sans-serif; }
        /* Centraliza o conteúdo verticalmente dentro do iFrame */
        #portfolio-root { 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="portfolio-root" class="p-4 sm:p-6 lg:p-8 w-full max-w-5xl mx-auto"></div>

    <script>
        // Definição das cores (deve ser idêntica ao Host)
        const COLOR = {
            indigo: { base:"indigo", bg50:"bg-indigo-50", text900:"text-indigo-900", border100:"border-indigo-100", text600:"text-indigo-600" },
            emerald:{ base:"emerald",bg50:"bg-emerald-50",text900:"text-emerald-900", border100:"border-emerald-100", text600:"text-emerald-600" },
            amber:{ base:"amber",bg50:"bg-amber-50",text900:"text-amber-900", border100:"border-amber-100", text600:"text-amber-600" },
            rose:{ base:"rose",bg50:"bg-rose-50",text900:"text-rose-900", border100:"border-rose-100", text600:"text-rose-600" },
        };
        
        // Definição do Menu (Minimalista - apenas o suficiente para renderizar os cartões)
        const PORTFOLIO_MENU_ITEMS = [
            { id: "alerts", titleKey: "menu_alerts", icon: "notifications", color: "rose", isMFE: true },
            { id: "settings", titleKey: "menu_settings", icon: "settings", color: "indigo", isMFE: false, viewName: "settings" },
            { id: "student_reg", titleKey: "edu_student_profile", icon: "person_add", color: "emerald", isMFE: true },
            {
                id: "simulados",
                titleKey: "edu_simulados",
                icon: "quiz",
                color: "amber",
                isMFE: true,
                targetUrl: "products/educacao/app-quiz/index.html",
                basePath: "products/educacao/app-quiz/"
            }
        ];

        // FUNÇÃO DE COMUNICAÇÃO (BRIDGE) - Solicita navegação ao Host
        const requestNavigation = (item) => {
            if (window.parent) {
                // Envia o comando para o Host
                window.parent.postMessage({
                    type: 'MFE_NAV_REQUEST',
                    payload: {
                        action: 'OPEN_APP', // Indica que queremos abrir um app/view
                        appId: item?.id || item?.viewName, // Envia o ID ou nome da view
                        targetUrl: item?.targetUrl || null,
                        basePath: item?.basePath || null
                    }
                }, '*');
            } else if (item?.targetUrl) {
                // Fallback local: abre o MiniApp diretamente quando não há Host
                window.location.href = item.targetUrl;
            } else {
                console.error("Não é possível comunicar com o Host (parent window não encontrada).");
            }
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function AppCard({ item, t, onClick }) {
            const c = COLOR[item.color] || COLOR.indigo;
            return (
                <div onClick={onClick} className={`relative flex flex-col items-center justify-end w-32 h-32 rounded-2xl group cursor-pointer transition border ${c.border100} ${c.bg50} hover:shadow hover:-translate-y-1`}>
                    <div className="absolute inset-0 flex items-center justify-center">
                        <span className={`material-symbols-rounded text-[5rem] opacity-10 group-hover:opacity-20 ${c.text600}`}>{item.icon}</span>
                    </div>
                    <div className="relative z-10 p-2 text-center">
                        {/* Chama a função t */}
                        <span className={`font-semibold text-sm ${c.text900}`}>{t(item.titleKey)}</span>
                    </div>
                </div>
            );
        }

        const PortfolioMiniApp = () => {
            // CORREÇÃO: t deve ser inicializado como uma função que retorna a chave, e isLoading deve ser usado para controle de estado.
            const initialT = (key) => key;
            const [t, setT] = useState(() => initialT); 
            const [isLoading, setIsLoading] = useState(true);
            
            // Listener para receber dados de tradução do Host
            useEffect(() => {
                const handleMessage = (event) => {
                    if (event.data.type === 'HOST_DATA_INIT' && event.data.payload.i18n) {
                        const i18n = event.data.payload.i18n;
                        const lang = event.data.payload.lang || 'pt-BR';
                        
                        // Cria uma função t local baseada nos dados do Host
                        const localT = (key) => {
                            // Tenta pegar a tradução. Se falhar, usa a chave.
                            return i18n[lang]?.[key] || key;
                        };
                        
                        setT(() => localT);
                        setIsLoading(false); // Dados carregados, remove o loader
                    }
                };

                window.addEventListener('message', handleMessage);
                
                // Solicita dados do Host após a montagem
                if (window.parent) {
                    window.parent.postMessage({ type: 'MFE_REQUEST_INIT_DATA' }, '*');
                }

                return () => window.removeEventListener('message', handleMessage);
            }, []);
            
            // Envia o comando de navegação ao Host
            const handleCardClick = (item) => {
                // Verifica se é uma tela nativa do Host ('settings') ou um MiniApp a ser carregado
                requestNavigation(item);
            };
            
            // Usa isLoading para mostrar o loader.
            if (isLoading) {
                // Tenta traduzir a mensagem de carregamento, mas usa a chave como fallback.
                return (
                    <div className="text-center text-slate-500">
                        <span className="material-symbols-rounded animate-spin mr-2">sync</span>
                        {t('loading_label') === 'loading_label' ? 'Carregando...' : t('loading_label')}
                    </div>
                );
            }

            return (
                <div className="text-center w-full animate-fade-in-up">
                    <h1 className="text-3xl font-extrabold mb-2">{t("app_title_portfolio")}</h1>
                    <p className="text-slate-500 mb-8">{t('home_choose_app')}</p>
                    <div className="flex flex-wrap justify-center gap-6 max-w-3xl mx-auto">
                        {PORTFOLIO_MENU_ITEMS.map(item => 
                            <AppCard key={item.id} item={item} t={t} onClick={() => handleCardClick(item)}/>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById("portfolio-root")).render(<PortfolioMiniApp />);
    </script>
</body>
</html>
