<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniApp - Gestão de Catálogo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="../../docs/miniapp-global.css">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@emotion/react@11.11.1/dist/emotion-react.umd.min.js"></script>
    <script crossorigin src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
    <script crossorigin src="https://unpkg.com/@mui/material@5.15.14/umd/material-ui.production.min.js"></script>
    <script src="../../docs/components/app-shared-ui.js"></script>
    <script src="../../docs/components/app-modal-context.js"></script>

    <meta name="theme-color" content="#f3f4f6">
</head>
<body class="miniapp-shell">
    <main id="catalog-root" class="miniapp-stage"></main>

    <script type="module">
        const ReactLib = window.React;
        const ReactDOMLib = window.ReactDOM;
        const Material = window.MaterialUI;
        const { AppCard, AppButton, AppSection } = window.AppUI;
        const { AppModalProvider, useAppModal } = window.AppModalContext;

        if (!ReactLib || !ReactDOMLib || !Material || !AppCard || !AppModalProvider) {
            throw new Error('Dependências essenciais não foram carregadas para o MiniApp de Catálogo.');
        }

        const {
            useMemo,
            Fragment,
        } = ReactLib;
        const {
            ThemeProvider,
            createTheme,
            CssBaseline,
            Box,
            Button,
            Chip,
            Container,
            Grid,
            Stack,
            Typography,
            Avatar,
            Divider,
            List,
            ListItem,
            ListItemText,
        } = Material;

        const e = ReactLib.createElement;

        const CATALOG_ITEMS = [
            {
                id: 'catalogo-5horas',
                title: 'Catálogo 5Horas',
                description: 'Card principal do shell, expõe o grid oficial de MiniApps e integra com favoritos.',
                category: 'Core',
                contract: 'RodaPack',
                status: 'published',
                url: './index.html',
                owner: 'Equipe 5Horas',
            },
            {
                id: 'settings-bridge',
                title: 'Configurações do Sistema',
                description: 'Card replicado dentro deste painel para navegação rápida com preferências globais.',
                category: 'MiniSystems',
                contract: 'Interno',
                status: 'draft',
                url: '../settings/index.html',
                owner: 'Equipe 5Horas',
            },
            {
                id: 'payments-pro',
                title: 'Pagamentos e Assinaturas',
                description: 'Experiência dedicada a recorrências financeiras e integrações com Mercado Pago.',
                category: 'Financeiro',
                contract: 'BR-MercadoPago',
                status: 'draft',
                url: '../payments/index.html',
                owner: 'MiniApp Payments',
            },
            {
                id: 'favorites-panel',
                title: 'Painel de Favoritos',
                description: 'Permite fixar atalhos críticos do catálogo com persistência no IndexedDB.',
                category: 'Produtividade',
                contract: 'RodaPack',
                status: 'em revisão',
                url: '../favorites/index.html',
                owner: 'Equipe Shell',
            },
            {
                id: 'recents-tracker',
                title: 'Histórico de Acessos',
                description: 'Mostra os últimos MiniApps abertos e sugere retornos rápidos.',
                category: 'Produtividade',
                contract: 'RodaPack',
                status: 'em revisão',
                url: '../recents/index.html',
                owner: 'Equipe Shell',
            },
            {
                id: 'alerts-hub',
                title: 'Central de Alertas',
                description: 'MiniApp legado preservado para notificar o time sobre incidentes críticos.',
                category: 'Legado',
                contract: 'Especial',
                status: 'manutenção',
                url: '../alerts/index.html',
                owner: 'Equipe Legada',
            },
        ];

        const STATUS_PROPS = {
            published: { label: 'Publicado', color: 'success' },
            draft: { label: 'Em rascunho', color: 'warning' },
            'em revisão': { label: 'Em revisão', color: 'info' },
            manutenção: { label: 'Manutenção', color: 'default' },
        };

        function CatalogCard({ app }) {
            const modal = useAppModal();
            const statusProps = STATUS_PROPS[app.status] || { label: app.status, color: 'default' };

            const openDetails = () => {
                modal.openDialog({
                    title: app.title,
                    maxWidth: 'sm',
                    content: () => e(
                        Stack,
                        { spacing: 2, sx: { pt: 1 } },
                        e(Typography, { variant: 'body2', color: 'text.secondary' }, app.description),
                        e(Divider, null),
                        e(List, { dense: true, disablePadding: true },
                            e(ListItem, { disableGutters: true },
                                e(ListItemText, { primary: 'Categoria', secondary: app.category })
                            ),
                            e(ListItem, { disableGutters: true },
                                e(ListItemText, { primary: 'Contrato', secondary: app.contract })
                            ),
                            e(ListItem, { disableGutters: true },
                                e(ListItemText, { primary: 'Responsável', secondary: app.owner })
                            )
                        )
                    ),
                    actions: ({ closeDialog }) => e(Fragment, null,
                        e(Button, { onClick: closeDialog }, 'Fechar')
                    ),
                });
            };

            return e(
                AppCard,
                {
                    title: app.title,
                    subtitle: app.category,
                    helper: app.description,
                    sx: { minHeight: 320 },
                    actions: e(Chip, { label: statusProps.label, color: statusProps.color === 'default' ? undefined : statusProps.color, variant: 'outlined' }),
                },
                e(
                    Stack,
                    { spacing: 2 },
                    e(Stack, { direction: 'row', spacing: 1.5, alignItems: 'center' },
                        e(Avatar, { children: app.title.slice(0, 1) }),
                        e('div', null,
                            e(Typography, { variant: 'body2', color: 'text.secondary' }, 'Contrato'),
                            e(Typography, { variant: 'h6' }, app.contract)
                        )
                    ),
                    e(Divider, null),
                    e(Stack, { direction: { xs: 'column', sm: 'row' }, spacing: 1.5 },
                        e(AppButton, { tone: 'primary', component: 'a', href: app.url }, 'Abrir MiniApp'),
                        e(AppButton, { tone: 'ghost', onClick: openDetails }, 'Detalhes')
                    )
                )
            );
        }

        function CatalogApp() {
            const theme = useMemo(() => createTheme({
                palette: {
                    mode: 'light',
                    primary: { main: '#f97316' },
                    secondary: { main: '#0ea5e9' },
                    background: {
                        default: '#f3f4f6',
                        paper: '#ffffff',
                    },
                },
                typography: {
                    fontFamily: '"Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                },
                shape: { borderRadius: 24 },
            }), []);

            return e(
                ThemeProvider,
                { theme },
                e(CssBaseline, null),
                e(
                    AppModalProvider,
                    null,
                    e(
                        Box,
                        { className: 'miniapp-stage', sx: { flex: 1 } },
                        e(
                            Container,
                            { maxWidth: 'lg', sx: { py: { xs: 3, md: 5 }, display: 'flex', flexDirection: 'column', gap: 4 } },
                            e(
                                Stack,
                                { spacing: 1.25 },
                                e(Typography, { variant: 'overline', color: 'text.secondary' }, 'MiniApp Catálogo'),
                                e(Typography, { variant: 'h4', component: 'h1' }, 'Gestão de MiniApps em desenvolvimento'),
                                e(Typography, { color: 'text.secondary' }, 'Todos os cards abaixo utilizam o AppCard e seguem o grid responsivo do MUI.')
                            ),
                            e(
                                AppSection,
                                { title: 'MiniApps ativos', description: 'A lista reflete o estado atual do RodaPack.' },
                                e(
                                    Grid,
                                    { container: true, spacing: 2 },
                                    CATALOG_ITEMS.map((app) => e(Grid, { item: true, xs: 12, sm: 6, md: 4, key: app.id }, e(CatalogCard, { app })))
                                )
                            )
                        )
                    )
                )
            );
        }

        ReactDOMLib.createRoot(document.getElementById('catalog-root')).render(e(CatalogApp));
    </script>
</body>
</html>
