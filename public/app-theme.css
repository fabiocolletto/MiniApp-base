@layer tokens, base, layout, components, utilities;

/* === TOKENS === */
@layer tokens {
  @import url("./tokens.css");

  :root {
    --ac-primary: var(--global-color-brand-primary, #1f6feb);
    --ac-secondary: var(--global-color-brand-secondary, #6c7a89);
    --ac-text: var(--light-color-text-primary, #111315);
    --ac-accent: var(--global-color-brand-accent, #00b3a4);
    --ac-bg: var(--light-color-surface-background, #ffffff);
    --ac-surface: var(--light-color-surface-card, #ffffff);
    --ac-surface-muted: var(--light-color-surface-muted, #f4f6f8);
    --ac-border-subtle: var(--light-color-border-subtle, rgba(17, 19, 21, 0.08));
    --ac-border-strong: var(--light-color-border-strong, rgba(31, 111, 235, 0.35));
    --ac-text-secondary: var(--light-color-text-secondary, #334155);
    --ac-text-muted: var(--light-color-text-muted, #475569);
    --ac-font-primary: var(
      --e-global-typography-primary-font-family,
      var(--global-font-family-primary, "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif)
    );
    --ac-font-secondary: var(
      --e-global-typography-secondary-font-family,
      var(--global-font-family-secondary, var(--ac-font-primary))
    );
    --ac-font-scale: 1;
    --ac-radius: var(--global-radius-lg, 16px);
    --ac-radius-md: var(--global-radius-md, 12px);
    --ac-radius-sm: var(--global-radius-sm, 8px);
    --ac-shadow: var(--global-shadow-md, 0 10px 24px rgba(17, 19, 21, 0.12));
    --ac-shadow-strong: var(--global-shadow-lg, 0 18px 48px rgba(17, 19, 21, 0.18));
    --ac-space-1: var(--global-space-2xs, 0.5rem);
    --ac-space-2: var(--global-space-sm, 1rem);
    --ac-space-3: var(--global-space-md, 1.5rem);
    --ac-space-4: var(--global-space-lg, 2rem);
    --ac-space-5: var(--global-space-xl, 3rem);
    --ac-z-overlay: var(--global-z-overlay, 50);
    --ac-z-modal: var(--global-z-modal, 100);
    --ac-elementor-primary: var(--e-global-color-primary, var(--ac-primary));
    --ac-elementor-secondary: var(--e-global-color-secondary, var(--ac-secondary));
    --ac-elementor-text: var(--e-global-color-text, var(--ac-text));
    --ac-elementor-accent: var(--e-global-color-accent, var(--ac-accent));
    --ac-primary-rgb: 31, 110, 235;
    --ac-accent-rgb: 0, 179, 164;
    --color-bg-body: var(--ac-bg);
    --color-bg-card: var(--ac-surface);
    --color-bg-elevated: color-mix(in oklab, var(--ac-surface) 92%, black 8%);
    --color-border-muted: var(--ac-border-subtle);
    --color-card-border: var(--ac-border-subtle);
    --color-shadow-primary: var(--ac-shadow);
    --color-shadow-elevated: var(--ac-shadow-strong);
    --color-text-primary: var(--ac-text);
    --color-text-secondary: var(--ac-text-secondary);
    --color-text-muted: var(--ac-text-muted);
    --color-text-inverse: var(--global-color-neutral-inverse, #f5f7fa);
    --color-focus-outline: color-mix(in srgb, var(--ac-primary) 40%, transparent);
    --color-accent: var(--ac-elementor-primary);
    --color-accent-strong: color-mix(in oklab, var(--color-accent) 88%, black 12%);
    --color-accent-deep: color-mix(in oklab, var(--color-accent) 74%, black 26%);
    --color-accent-rgb: var(--ac-primary-rgb);
    --color-input-bg: color-mix(in srgb, var(--ac-surface) 96%, white 4%);
    --color-input-border: var(--ac-border-subtle);
    --color-input-border-strong: var(--ac-border-strong);
    --color-input-placeholder: color-mix(in srgb, var(--ac-text) 38%, transparent);
    --color-success-text: var(--global-color-state-success, #0f9d58);
    --color-error-text: var(--global-color-state-error, #d93025);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --ac-bg: var(--dark-color-surface-background, #0b0f13);
      --ac-surface: var(--dark-color-surface-card, #141b22);
      --ac-surface-muted: var(--dark-color-surface-muted, #1f2933);
      --ac-text: var(--dark-color-text-primary, #ebeff3);
      --ac-text-secondary: var(--dark-color-text-secondary, #cbd5f5);
      --ac-text-muted: var(--dark-color-text-muted, #94a3b8);
      --ac-border-subtle: var(--dark-color-border-subtle, rgba(245, 247, 250, 0.12));
      --ac-border-strong: var(--dark-color-border-strong, rgba(0, 179, 164, 0.45));
      --ac-primary: var(--e-global-color-primary, #4ea1ff);
      --ac-accent: var(--e-global-color-accent, var(--global-color-brand-accent, #2dd4bf));
      --ac-secondary: var(--global-color-brand-secondary, #6c7a89);
      --color-bg-body: var(--ac-bg);
      --color-bg-card: var(--ac-surface);
      --color-bg-elevated: color-mix(in oklab, var(--ac-surface) 92%, white 8%);
      --color-border-muted: var(--ac-border-subtle);
      --color-card-border: var(--ac-border-subtle);
      --color-shadow-primary: var(--ac-shadow);
      --color-shadow-elevated: var(--ac-shadow-strong);
      --color-text-primary: var(--ac-text);
      --color-text-secondary: var(--ac-text-secondary);
      --color-text-muted: var(--ac-text-muted);
      --color-text-inverse: var(--global-color-neutral-base, #111315);
      --color-focus-outline: color-mix(in srgb, var(--ac-primary) 50%, transparent);
      --color-accent: var(--ac-primary);
      --color-accent-strong: color-mix(in oklab, var(--color-accent) 80%, black 20%);
      --color-accent-deep: color-mix(in oklab, var(--color-accent) 65%, black 35%);
      --color-input-bg: color-mix(in srgb, var(--ac-surface) 88%, black 12%);
      --color-input-border: var(--ac-border-subtle);
      --color-input-border-strong: var(--ac-border-strong);
      --color-input-placeholder: color-mix(in srgb, var(--ac-text) 40%, transparent);
      --color-success-text: color-mix(in srgb, var(--global-color-state-success, #0f9d58) 82%, white 18%);
      --color-error-text: color-mix(in srgb, var(--global-color-state-error, #d93025) 82%, white 18%);
    }
  }

  :root[data-theme="light"] {
    color-scheme: light;
    --ac-bg: var(--light-color-surface-background, #fef9f2);
    --ac-surface: var(--light-color-surface-card, #ffffff);
    --ac-surface-muted: var(--light-color-surface-muted, #f4f6f8);
    --ac-text: var(--light-color-text-primary, #111315);
    --ac-text-secondary: var(--light-color-text-secondary, #334155);
    --ac-text-muted: var(--light-color-text-muted, #475569);
    --ac-border-subtle: var(--light-color-border-subtle, rgba(17, 19, 21, 0.08));
    --ac-border-strong: var(--light-color-border-strong, rgba(31, 111, 235, 0.35));
    --color-bg-body: var(--ac-bg);
    --color-bg-card: var(--ac-surface);
    --color-bg-elevated: color-mix(in oklab, var(--ac-surface) 92%, black 8%);
    --color-border-muted: var(--ac-border-subtle);
    --color-card-border: var(--ac-border-subtle);
    --color-shadow-primary: var(--ac-shadow);
    --color-shadow-elevated: var(--ac-shadow-strong);
    --color-text-primary: var(--ac-text);
    --color-text-secondary: var(--ac-text-secondary);
    --color-text-muted: var(--ac-text-muted);
    --color-text-inverse: var(--global-color-neutral-inverse, #f5f7fa);
    --color-focus-outline: color-mix(in srgb, var(--ac-primary) 40%, transparent);
    --color-accent: var(--ac-elementor-primary);
    --color-accent-strong: color-mix(in oklab, var(--color-accent) 88%, black 12%);
    --color-accent-deep: color-mix(in oklab, var(--color-accent) 74%, black 26%);
    --color-input-bg: color-mix(in srgb, var(--ac-surface) 96%, white 4%);
    --color-input-border: var(--ac-border-subtle);
    --color-input-border-strong: var(--ac-border-strong);
    --color-input-placeholder: color-mix(in srgb, var(--ac-text) 38%, transparent);
    --color-success-text: var(--global-color-state-success, #0f9d58);
    --color-error-text: var(--global-color-state-error, #d93025);
  }

  :root[data-theme="dark"] {
    color-scheme: dark;
    --ac-bg: var(--dark-color-surface-background, #0b0f13);
    --ac-surface: var(--dark-color-surface-card, #141b22);
    --ac-surface-muted: var(--dark-color-surface-muted, #1f2933);
    --ac-text: var(--dark-color-text-primary, #ebeff3);
    --ac-text-secondary: var(--dark-color-text-secondary, #cbd5f5);
    --ac-text-muted: var(--dark-color-text-muted, #94a3b8);
    --ac-border-subtle: var(--dark-color-border-subtle, rgba(245, 247, 250, 0.12));
    --ac-border-strong: var(--dark-color-border-strong, rgba(0, 179, 164, 0.45));
    --color-bg-body: var(--ac-bg);
    --color-bg-card: var(--ac-surface);
    --color-bg-elevated: color-mix(in oklab, var(--ac-surface) 92%, white 8%);
    --color-border-muted: var(--ac-border-subtle);
    --color-card-border: var(--ac-border-subtle);
    --color-shadow-primary: var(--ac-shadow);
    --color-shadow-elevated: var(--ac-shadow-strong);
    --color-text-primary: var(--ac-text);
    --color-text-secondary: var(--ac-text-secondary);
    --color-text-muted: var(--ac-text-muted);
    --color-text-inverse: var(--global-color-neutral-base, #111315);
    --color-focus-outline: color-mix(in srgb, var(--ac-primary) 50%, transparent);
    --color-accent: var(--ac-primary);
    --color-accent-strong: color-mix(in oklab, var(--color-accent) 80%, black 20%);
    --color-accent-deep: color-mix(in oklab, var(--color-accent) 65%, black 35%);
    --color-input-bg: color-mix(in srgb, var(--ac-surface) 88%, black 12%);
    --color-input-border: var(--ac-border-subtle);
    --color-input-border-strong: var(--ac-border-strong);
    --color-input-placeholder: color-mix(in srgb, var(--ac-text) 40%, transparent);
    --color-success-text: color-mix(in srgb, var(--global-color-state-success, #0f9d58) 82%, white 18%);
    --color-error-text: color-mix(in srgb, var(--global-color-state-error, #d93025) 82%, white 18%);
  }
}

/* === BASE === */
@layer base {
  html {
    font-size: calc(16px * var(--ac-font-scale));
  }

  body {
    font-family: var(--ac-font-primary);
    color: var(--ac-text);
    background: var(--ac-bg);
    margin: 0;
  }

  ::selection {
    background: color-mix(in srgb, var(--ac-primary) 85%, transparent);
    color: #ffffff;
  }

  .reduce-motion * {
    transition: none !important;
    animation: none !important;
    scroll-behavior: auto !important;
  }
}

/* === LAYOUT === */
@layer layout {
  .app {
    min-height: 100dvh;
    padding-bottom: env(safe-area-inset-bottom);
  }

  body.density-compact {
    --density-gap: clamp(0.5rem, 1.5vw, 0.75rem);
  }

  body:not(.density-compact) {
    --density-gap: clamp(0.75rem, 2vw, 1.25rem);
  }
}

/* === COMPONENTS === */
@layer components {
  .card {
    border-radius: var(--ac-radius);
    box-shadow: var(--ac-shadow);
    background: color-mix(in oklab, var(--ac-surface) 96%, black 4%);
    color: var(--ac-text);
    padding: var(--ac-space-3);
    border: 1px solid var(--ac-border-subtle);
  }

  .btn {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1rem;
    border: 0;
    border-radius: var(--global-radius-pill, 999px);
    background: var(--ac-primary);
    color: #fff;
    font-weight: 600;
    line-height: 1.2;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
  }

  .btn:hover,
  .btn:focus-visible {
    box-shadow: var(--ac-shadow-strong);
    transform: translateY(-1px);
  }

  .btn.secondary {
    background: var(--ac-accent);
  }

  .chip {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.35rem 0.75rem;
    border-radius: var(--ac-radius-md);
    background: color-mix(in srgb, var(--ac-accent) 15%, transparent);
    color: var(--ac-text-secondary);
    font-size: 0.875rem;
  }
}

/* === UTILITIES === */
@layer utilities {
  .surface-muted {
    background: var(--ac-surface-muted);
    border: 1px solid var(--ac-border-subtle);
    border-radius: var(--ac-radius-md);
  }

  .text-muted {
    color: var(--ac-text-muted);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0 0 0 0);
    white-space: nowrap;
    border: 0;
  }
}
