export const SUPPORTED_LANGS = ['pt-BR', 'en-US', 'es-ES'];

const TEXTS = {
  'pt-BR': {
    'brand.title': 'MiniApp Base',
    'brand.subtitle': 'Shell pronto para MiniApps internos',
    'nav.toggle': 'Alternar menu',
    'nav.home': 'Início',
    'nav.miniapps': 'MiniApps',
    'nav.settings': 'Ajustes',
    'nav.help': 'Ajuda',
    'nav.diagnostics': 'Diagnóstico',
    'home.title': 'MiniApp Base',
    'home.caption': 'Ajuste tema, idioma e tamanho do texto antes de começar.',
    'home.gridTitle': 'MiniApps configurados',
    'miniapps.title': 'MiniApps',
    'miniapps.caption': 'Escolha um MiniApp interno para abrir no painel.',
    'settings.title': 'Ajustes globais',
    'settings.caption': 'Preferências compartilhadas com todos os MiniApps internos.',
    'settings.theme': 'Tema',
    'settings.theme.auto': 'Automático',
    'settings.theme.light': 'Claro',
    'settings.theme.dark': 'Escuro',
    'settings.language': 'Idioma',
    'settings.font': 'Escala da fonte',
    'settings.sync.title': 'Sincronização com Google Drive',
    'settings.sync.caption': 'Controle quando o backup em nuvem deve ser ligado, desligado ou limpo.',
    'settings.sync.enable': 'Ligar sincronização',
    'settings.sync.disable': 'Desligar sincronização',
    'settings.sync.delete': 'Excluir backups',
    'settings.sync.status.label': 'Status',
    'settings.sync.lastSync.label': 'Última sincronização',
    'settings.sync.error.label': 'Erro',
    'settings.sync.deleteConfirm': 'Deseja remover os backups salvos no Google Drive?',
    'settings.sync.deleteSuccess': 'Backups removidos do Google Drive.',
    'settings.sync.deleteError': 'Não foi possível excluir os backups.',
    'settings.sync.toggleError': 'Não foi possível alternar a sincronização agora.',
    'settings.sync.errorToast': 'Falha na sincronização com o Google Drive.',
    'settings.layout.title': 'Layout',
    'settings.layout.menu': 'Ocultar menu ao abrir MiniApp',
    'help.title': 'Ajuda e suporte',
    'help.caption': 'Documentação essencial do MiniApp Base.',
    'about.title': 'Sobre o MiniApp Base',
    'about.version': 'Versão <span data-app-version></span> — última atualização em <span data-app-updated></span>.',
    'about.owner.label': 'Proprietário',
    'about.owner.value': '5 Horas Tecnologia e Consultoria LTDA.',
    'about.privacy.label': 'Privacidade e termos',
    'about.privacy.value': 'Política de Privacidade',
    'about.contact.label': 'Contato',
    'about.contact.value': 'contato@5horas.com.br',
    'about.tech.label': 'Tecnologias',
    'about.tech.value': 'HTML5, CSS, JavaScript, IndexedDB, BroadcastChannel.',
    'help.resources.title': 'Recursos rápidos',
    'help.resources.guide': 'Guia de integração de MiniApps internos',
    'help.resources.elementor': 'Integração via Elementor',
    'diagnostics.title': 'Diagnóstico',
    'diagnostics.caption': 'Status do armazenamento e sincronização.',
    'diagnostics.storage.persisted': 'Armazenamento persistente',
    'diagnostics.storage.quota': 'Quota disponível',
    'diagnostics.storage.usage': 'Uso atual',
    'diagnostics.storage.updated': 'Última atualização',
    'diagnostics.persisted.yes': 'Sim (persistente)',
    'diagnostics.persisted.no': 'Não (volátil)',
    'diagnostics.storage.unit': 'MB',
    'miniapp.close': 'Voltar ao Início',
    'miniapp.external': 'Abrir em nova aba',
    'miniapp.open': 'Abrir MiniApp',
    'miniapp.notFound': 'MiniApp não encontrado.',
    'miniapp.menuHide': 'Ocultar menu',
    'miniapp.menuShow': 'Mostrar menu',
    'footer.product': 'MiniApp Base',
    'status.synced': 'Sincronizado',
    'status.dirty': 'Desatualizado',
    'status.saving': 'Salvando…',
    'status.saved': 'Salvo',
    'status.error': 'Erro ao salvar',
    'sync.status.disconnected': 'Sincronização desligada',
    'sync.status.authorizing': 'Autorizando…',
    'sync.status.syncing': 'Sincronizando…',
    'sync.status.synced': 'Sincronizado',
    'sync.status.error': 'Erro na sincronização',
    'sync.lastSync.never': 'Nunca sincronizado',
    'toast.externalBlocked': 'Conteúdo externo bloqueado. Abrimos em nova aba.',
  },
  'en-US': {
    'brand.title': 'MiniApp Base',
    'brand.subtitle': 'Shell ready for internal MiniApps',
    'nav.toggle': 'Toggle menu',
    'nav.home': 'Home',
    'nav.miniapps': 'MiniApps',
    'nav.settings': 'Settings',
    'nav.help': 'Help',
    'nav.diagnostics': 'Diagnostics',
    'home.title': 'MiniApp Base',
    'home.caption': 'Adjust theme, language and type scale before you start.',
    'home.gridTitle': 'Configured MiniApps',
    'miniapps.title': 'MiniApps',
    'miniapps.caption': 'Choose an internal MiniApp to open inside the panel.',
    'settings.title': 'Global preferences',
    'settings.caption': 'Shared preferences for every internal MiniApp.',
    'settings.theme': 'Theme',
    'settings.theme.auto': 'Automatic',
    'settings.theme.light': 'Light',
    'settings.theme.dark': 'Dark',
    'settings.language': 'Language',
    'settings.font': 'Font scale',
    'settings.sync.title': 'Google Drive sync',
    'settings.sync.caption': 'Decide when cloud backups should turn on, off or be wiped.',
    'settings.sync.enable': 'Enable sync',
    'settings.sync.disable': 'Disable sync',
    'settings.sync.delete': 'Delete backups',
    'settings.sync.status.label': 'Status',
    'settings.sync.lastSync.label': 'Last sync',
    'settings.sync.error.label': 'Error',
    'settings.sync.deleteConfirm': 'Remove the backups stored in Google Drive?',
    'settings.sync.deleteSuccess': 'Backups removed from Google Drive.',
    'settings.sync.deleteError': 'Could not delete the backups.',
    'settings.sync.toggleError': 'We could not change the sync status now.',
    'settings.sync.errorToast': 'Google Drive sync failed.',
    'settings.layout.title': 'Layout',
    'settings.layout.menu': 'Hide menu when a MiniApp is open',
    'help.title': 'Help & support',
    'help.caption': 'Essential documentation for MiniApp Base.',
    'about.title': 'About MiniApp Base',
    'about.version': 'Version <span data-app-version></span> — last updated on <span data-app-updated></span>.',
    'about.owner.label': 'Owner',
    'about.owner.value': '5 Horas Tecnologia e Consultoria LTDA.',
    'about.privacy.label': 'Privacy & terms',
    'about.privacy.value': 'Privacy Policy',
    'about.contact.label': 'Contact',
    'about.contact.value': 'contato@5horas.com.br',
    'about.tech.label': 'Technologies',
    'about.tech.value': 'HTML5, CSS, JavaScript, IndexedDB, BroadcastChannel.',
    'help.resources.title': 'Quick resources',
    'help.resources.guide': 'Internal MiniApp integration guide',
    'help.resources.elementor': 'Elementor integration',
    'diagnostics.title': 'Diagnostics',
    'diagnostics.caption': 'Storage and synchronisation status.',
    'diagnostics.storage.persisted': 'Persistent storage',
    'diagnostics.storage.quota': 'Available quota',
    'diagnostics.storage.usage': 'Current usage',
    'diagnostics.storage.updated': 'Last update',
    'diagnostics.persisted.yes': 'Yes (persistent)',
    'diagnostics.persisted.no': 'No (volatile)',
    'diagnostics.storage.unit': 'MB',
    'miniapp.close': 'Back to Home',
    'miniapp.external': 'Open in new tab',
    'miniapp.open': 'Open MiniApp',
    'miniapp.notFound': 'MiniApp not found.',
    'miniapp.menuHide': 'Hide menu',
    'miniapp.menuShow': 'Show menu',
    'footer.product': 'MiniApp Base',
    'status.synced': 'Synced',
    'status.dirty': 'Out of date',
    'status.saving': 'Saving…',
    'status.saved': 'Saved',
    'status.error': 'Save failed',
    'sync.status.disconnected': 'Sync disabled',
    'sync.status.authorizing': 'Authorising…',
    'sync.status.syncing': 'Syncing…',
    'sync.status.synced': 'Synced',
    'sync.status.error': 'Sync error',
    'sync.lastSync.never': 'Never synced',
    'toast.externalBlocked': 'External content blocked. We opened it in a new tab.',
  },
  'es-ES': {
    'brand.title': 'MiniApp Base',
    'brand.subtitle': 'Shell listo para MiniApps internos',
    'nav.toggle': 'Alternar menú',
    'nav.home': 'Inicio',
    'nav.miniapps': 'MiniApps',
    'nav.settings': 'Ajustes',
    'nav.help': 'Ayuda',
    'nav.diagnostics': 'Diagnóstico',
    'home.title': 'MiniApp Base',
    'home.caption': 'Ajusta tema, idioma y tamaño de fuente antes de comenzar.',
    'home.gridTitle': 'MiniApps configurados',
    'miniapps.title': 'MiniApps',
    'miniapps.caption': 'Elige un MiniApp interno para abrir en el panel.',
    'settings.title': 'Ajustes globales',
    'settings.caption': 'Preferencias compartidas con todos los MiniApps internos.',
    'settings.theme': 'Tema',
    'settings.theme.auto': 'Automático',
    'settings.theme.light': 'Claro',
    'settings.theme.dark': 'Oscuro',
    'settings.language': 'Idioma',
    'settings.font': 'Escala de fuente',
    'settings.sync.title': 'Sincronización con Google Drive',
    'settings.sync.caption': 'Controla cuándo activar, desactivar o limpiar el respaldo en la nube.',
    'settings.sync.enable': 'Activar sincronización',
    'settings.sync.disable': 'Desactivar sincronización',
    'settings.sync.delete': 'Eliminar copias',
    'settings.sync.status.label': 'Estado',
    'settings.sync.lastSync.label': 'Última sincronización',
    'settings.sync.error.label': 'Error',
    'settings.sync.deleteConfirm': '¿Deseas eliminar las copias almacenadas en Google Drive?',
    'settings.sync.deleteSuccess': 'Copias eliminadas de Google Drive.',
    'settings.sync.deleteError': 'No fue posible eliminar las copias.',
    'settings.sync.toggleError': 'No pudimos cambiar el estado de sincronización ahora.',
    'settings.sync.errorToast': 'Falló la sincronización con Google Drive.',
    'settings.layout.title': 'Diseño',
    'settings.layout.menu': 'Ocultar menú al abrir un MiniApp',
    'help.title': 'Ayuda y soporte',
    'help.caption': 'Documentación esencial del MiniApp Base.',
    'about.title': 'Acerca de MiniApp Base',
    'about.version': 'Versión <span data-app-version></span> — última actualización <span data-app-updated></span>.',
    'about.owner.label': 'Propietario',
    'about.owner.value': '5 Horas Tecnologia e Consultoria LTDA.',
    'about.privacy.label': 'Privacidad y términos',
    'about.privacy.value': 'Política de Privacidad',
    'about.contact.label': 'Contacto',
    'about.contact.value': 'contato@5horas.com.br',
    'about.tech.label': 'Tecnologías',
    'about.tech.value': 'HTML5, CSS, JavaScript, IndexedDB, BroadcastChannel.',
    'help.resources.title': 'Recursos rápidos',
    'help.resources.guide': 'Guía de integración de MiniApps internos',
    'help.resources.elementor': 'Integración con Elementor',
    'diagnostics.title': 'Diagnóstico',
    'diagnostics.caption': 'Estado del almacenamiento y la sincronización.',
    'diagnostics.storage.persisted': 'Almacenamiento persistente',
    'diagnostics.storage.quota': 'Cuota disponible',
    'diagnostics.storage.usage': 'Uso actual',
    'diagnostics.storage.updated': 'Última actualización',
    'diagnostics.persisted.yes': 'Sí (persistente)',
    'diagnostics.persisted.no': 'No (volátil)',
    'diagnostics.storage.unit': 'MB',
    'miniapp.close': 'Volver al inicio',
    'miniapp.external': 'Abrir en nueva pestaña',
    'miniapp.open': 'Abrir MiniApp',
    'miniapp.notFound': 'MiniApp no encontrado.',
    'miniapp.menuHide': 'Ocultar menú',
    'miniapp.menuShow': 'Mostrar menú',
    'footer.product': 'MiniApp Base',
    'status.synced': 'Sincronizado',
    'status.dirty': 'Desactualizado',
    'status.saving': 'Guardando…',
    'status.saved': 'Guardado',
    'status.error': 'Error al guardar',
    'sync.status.disconnected': 'Sincronización desactivada',
    'sync.status.authorizing': 'Autorizando…',
    'sync.status.syncing': 'Sincronizando…',
    'sync.status.synced': 'Sincronizado',
    'sync.status.error': 'Error de sincronización',
    'sync.lastSync.never': 'Nunca sincronizado',
    'toast.externalBlocked': 'Contenido externo bloqueado. Lo abrimos en una pestaña nueva.',
  },
};

function normalizeLang(lang) {
  if (!lang || !SUPPORTED_LANGS.includes(lang)) {
    return 'pt-BR';
  }
  return lang;
}

export function getTranslation(lang, key) {
  const normalized = normalizeLang(lang);
  return TEXTS[normalized]?.[key] ?? TEXTS['pt-BR']?.[key] ?? key;
}

export function applyTranslations(root, lang) {
  if (!root) return;
  const normalized = normalizeLang(lang);
  const elements = root.querySelectorAll('[data-i18n]');
  elements.forEach((element) => {
    const key = element.dataset.i18n;
    if (!key) return;
    const value = getTranslation(normalized, key);
    if (value.includes('<span')) {
      element.innerHTML = value;
    } else {
      element.textContent = value;
    }
  });
}

export function formatNumber(value, lang, options = {}) {
  try {
    return new Intl.NumberFormat(lang, options).format(value);
  } catch (error) {
    return String(value);
  }
}

export function formatDate(value, lang) {
  try {
    const formatter = new Intl.DateTimeFormat(lang, {
      dateStyle: 'long',
      timeStyle: 'short',
    });
    return formatter.format(value);
  } catch (error) {
    return value instanceof Date ? value.toISOString() : String(value);
  }
}
