/* styles.css — Demo v0.4 (2025-11-11)
   Escopo: .ma
   Correções: sem “moldura”, header/footer fixos, rolagem só no centro, sem overflow horizontal,
   grid responsivo seguro, tabela com melhor legibilidade, contraste dark melhorado. */
@layer reset, tokens, base, components, utilities, compat;

/* ========================
   RESET
   ======================== */
@layer reset {
  html, body { margin: 0 !important; padding: 0 !important; height: 100%; }
  .ma { line-height: 1.5; -webkit-text-size-adjust: 100%; text-rendering: optimizeLegibility; }
  .ma :where(*, *::before, *::after) { box-sizing: border-box; }
  .ma :where(img, svg, video, canvas, audio, iframe) { display: block; max-width: 100%; }
  .ma :where(input, button, textarea, select) { font: inherit; color: inherit; }
  .ma :where(button) { background: none; border: 0; padding: 0; cursor: pointer; }
  .ma :where(a) { color: inherit; text-decoration: none; }
  .ma :where([hidden]) { display: none !important; }
  .ma :where(:focus-visible) { outline: var(--ma-focus-outline, 2px solid var(--ma-brand)); outline-offset: 2px; }
  .ma :where(::selection) { background: color-mix(in oklab, var(--ma-brand) 18%, transparent); }
}

/* ========================
   TOKENS (light/dark)
   ======================== */
@layer tokens {
  .ma {
    --ma-font-sans: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    --ma-font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;

    --ma-bg: #ffffff;
    --ma-surface: #f8fafc;
    --ma-ink: #0f172a;
    --ma-muted: #64748b;
    --ma-border: #e2e8f0;
    --ma-on-brand: #04101f;
    --ma-on-danger: #ffffff;
    --ma-color-scheme: light;

    --ma-brand: #0ea5e9;
    --ma-brand-ink: #0c4a6e;
    --ma-success: #10b981;
    --ma-warning: #f59e0b;
    --ma-danger: #ef4444;

    --ma-radius-1: 8px;
    --ma-radius-2: 14px;
    --ma-shadow-1: 0 1px 2px rgba(15,23,42,.08), 0 1px 1px rgba(15,23,42,.06);
    --ma-shadow-2: 0 8px 24px rgba(15,23,42,.12);

    --ma-sp-1: 4px;  --ma-sp-2: 8px;  --ma-sp-3: 12px; --ma-sp-4: 16px;
    --ma-sp-5: 20px; --ma-sp-6: 24px; --ma-sp-7: 32px; --ma-sp-8: 40px;

    --ma-fs-1: clamp(14px, .92rem, 15px);
    --ma-fs-2: clamp(16px, 1rem, 18px);
    --ma-fs-3: clamp(18px, 1.125rem, 20px);
    --ma-fs-4: clamp(20px, 1.25rem, 22px);
    --ma-fs-5: clamp(24px, 1.5rem, 28px);
    --ma-fs-6: clamp(28px, 1.75rem, 34px);

    --ma-focus-outline: 2px solid var(--ma-brand);
    --ma-focus-ring: 0 0 0 4px color-mix(in oklab, var(--ma-brand) 25%, transparent);

    color: var(--ma-ink);
    background: var(--ma-bg);
    color-scheme: var(--ma-color-scheme);
  }

  .ma[data-theme="dark"] {
    --ma-bg: #0b1220;
    --ma-surface: #101827;   /* +contraste */
    --ma-ink: #e2e8f0;
    --ma-muted: #94a3b8;
    --ma-border: #334155;    /* +contraste */
    --ma-brand: #38bdf8;
    --ma-brand-ink: #cffafe;
    --ma-on-brand: #04101f;
    --ma-shadow-1: 0 1px 2px rgba(0,0,0,.45), 0 1px 1px rgba(0,0,0,.35);
    --ma-shadow-2: 0 8px 24px rgba(0,0,0,.6);
    --ma-color-scheme: dark;
  }

  @media (prefers-color-scheme: dark) {
    .ma:not([data-theme]) {
      --ma-bg: #0b1220; --ma-surface:#101827; --ma-ink:#e2e8f0; --ma-muted:#94a3b8; --ma-border:#334155;
      --ma-brand:#38bdf8; --ma-brand-ink:#cffafe; --ma-shadow-1:0 1px 2px rgba(0,0,0,.45),0 1px 1px rgba(0,0,0,.35);
      --ma-shadow-2:0 8px 24px rgba(0,0,0,.6);
      --ma-color-scheme: dark;
    }
  }
}

/* ========================
   BASE TIPOGRAFIA + LAYOUT
   ======================== */
@layer base {
  #miniapp-root, .ma { min-height: 100svh; }
  .ma { font-family: var(--ma-font-sans); font-size: var(--ma-fs-2); }
  .ma :where(h1,h2,h3,h4) { margin: 0 0 var(--ma-sp-3); font-weight: 700; letter-spacing: -0.01em; }
  .ma :where(h1){ font-size: var(--ma-fs-6); }
  .ma :where(h2){ font-size: var(--ma-fs-5); }
  .ma :where(h3){ font-size: var(--ma-fs-4); }
  .ma :where(h4){ font-size: var(--ma-fs-3); }
  .ma :where(p){ margin: 0 0 var(--ma-sp-3); color: var(--ma-ink); }
  .ma :where(small){ font-size: var(--ma-fs-1); color: var(--ma-muted); }
  .ma :where(code,pre,kbd,samp){ font-family: var(--ma-font-mono); }

  .ma .container { width: min(1120px, 100% - 2*var(--ma-sp-4)); margin-inline: auto; }
  .ma .wrap { padding: var(--ma-sp-4); }

  .ma .surface { background: var(--ma-surface); border: 1px solid var(--ma-border); border-radius: var(--ma-radius-1); box-shadow: var(--ma-shadow-1); }
}

/* ========================
   COMPONENTES — shell fixo e UI
   ======================== */
@layer components {
  /* Shell da aplicação: header/topo e footer/base fixos com rolagem apenas no <main> */
  .ma .app {
    height: 100svh;                 /* viewport inteira */
    display: grid;
    grid-template-rows: auto minmax(0,1fr) auto; /* header | main | footer -> main pode encolher */ /* header | main | footer */
    overflow: hidden;               /* sem scroll fora do main */
  }
  .ma .app-header {
    position: sticky; top: 0; z-index: 10;
    padding: var(--ma-sp-3) var(--ma-sp-4);
    border-bottom: 1px solid var(--ma-border);
    display: flex; gap: var(--ma-sp-3); align-items: center;
    background: var(--ma-bg);
    box-shadow: 0 1px 0 var(--ma-border);
  }
  .ma .app-header__branding { gap: var(--ma-sp-3); }
  .ma .app-header__actions { margin-left: auto; }
  .ma .app-logo { height: 24px; width: auto; }
  .ma main {
    display: flex;
    flex-direction: column;
    overflow-y: auto;               /* só rolagem vertical aqui */
    overflow-x: hidden;             /* bloqueia rolagem horizontal */
    -webkit-overflow-scrolling: touch;
    scrollbar-gutter: stable both-edges;
    min-height: 0;                  /* permite o main encolher sem empurrar o footer */
  }
  .ma main > .app-view {
    flex: 1 1 auto;                 /* ocupa o espaço disponível entre header e footer */
  }
  .ma .app-panel { width: 100%; height: 100%; border: 0; display: block; }
  .ma .app-view { min-height: 100%; display: flex; }
  .ma .app-view .app-panel { flex: 1 1 auto; }
  .ma .app-view--centered { align-items: center; justify-content: center; }
  .ma .app-view__wrap { width: 100%; display: flex; justify-content: center; }
  .ma .app-view__card { width: min(520px, 100%); padding: var(--ma-sp-5); gap: var(--ma-sp-4); }
  .ma .app-footer {
    position: sticky; bottom: 0;
    padding: var(--ma-sp-3) var(--ma-sp-4);
    border-top: 1px solid var(--ma-border);
    display:flex; justify-content:space-between; align-items:center;
    background: var(--ma-bg);
    box-shadow: 0 -1px 0 var(--ma-border);
  }
  .ma .app-footer__branding { gap: var(--ma-sp-3); }
  .ma .app-footer__logo {
    display: flex;
    flex: 0 0 auto;
    align-items: center;
    max-width: 140px;
  }
  .ma [data-theme-logo] { display: none; height: 24px; width: auto; }
  .ma [data-theme-logo="light"] { display: inline-block; }
  .ma[data-theme="light"] [data-theme-logo="dark"] { display: none; }
  .ma[data-theme="light"] [data-theme-logo="light"] { display: inline-block; }
  .ma[data-theme="dark"] [data-theme-logo="light"] { display: none; }
  .ma[data-theme="dark"] [data-theme-logo="dark"] { display: inline-block; }
  @media (prefers-color-scheme: dark) {
    .ma:not([data-theme]) [data-theme-logo="light"] { display: none; }
    .ma:not([data-theme]) [data-theme-logo="dark"] { display: inline-block; }
  }

  /* IMPORTANTE: nada empurra o layout para fora da tela */
  .ma main, .ma .wrap, .ma .container, .ma .grid, .ma .card, .ma .panel { min-width: 0; }

  /* Botões */
  .ma .btn { display:inline-flex; align-items:center; gap:.5em; padding:.55em .9em; border-radius: var(--ma-radius-1);
             border:1px solid var(--ma-border); background: var(--ma-surface); color:var(--ma-ink); box-shadow: var(--ma-shadow-1);
             transition: transform .06s ease, box-shadow .2s ease, background .2s ease; }
  .ma .btn:hover { transform: translateY(-1px); box-shadow: var(--ma-shadow-2); }
  .ma .btn:active { transform: translateY(0); box-shadow: var(--ma-shadow-1); }
  .ma .btn--primary { background: var(--ma-brand); color: var(--ma-on-brand); border-color: color-mix(in oklab, var(--ma-brand) 45%, var(--ma-border)); }
  .ma .btn--soft { background: color-mix(in oklab, var(--ma-brand) 12%, var(--ma-bg)); color: var(--ma-brand-ink); border-color: color-mix(in oklab, var(--ma-brand) 25%, var(--ma-border)); }
  .ma .btn--ghost { background: transparent; color: var(--ma-brand); border-color: color-mix(in oklab, var(--ma-brand) 35%, var(--ma-border)); }
  .ma .btn--danger { background: var(--ma-danger); color: var(--ma-on-danger); border-color: color-mix(in oklab, var(--ma-danger) 45%, var(--ma-border)); }
  .ma .btn[disabled], .ma .btn:disabled { opacity:.6; filter: saturate(.7); pointer-events:none; }

  /* Cards */
  .ma .card { background: var(--ma-surface); border:1px solid var(--ma-border); border-radius: var(--ma-radius-1); box-shadow: var(--ma-shadow-1); overflow: clip; display:flex; flex-direction: column; }
  .ma .card__header { padding: var(--ma-sp-4); border-bottom:1px solid var(--ma-border); font-weight:700; }
  .ma .card__body { padding: var(--ma-sp-4); }
  .ma .card__footer { padding: var(--ma-sp-3) var(--ma-sp-4); border-top:1px solid var(--ma-border); background: var(--ma-surface); }

  .ma .form-field { display: flex; flex-direction: column; gap: var(--ma-sp-2); }
  .ma .form-label { font-weight: 600; }
  .ma .input {
    width: 100%;
    padding: var(--ma-sp-3);
    border-radius: var(--ma-radius-1);
    border: 1px solid var(--ma-border);
    background: var(--ma-bg);
    color: var(--ma-ink);
    box-shadow: var(--ma-shadow-1);
    transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
  }
  .ma .input:focus {
    border-color: var(--ma-brand);
    box-shadow: var(--ma-focus-ring);
    outline: none;
  }
  .ma .form-actions { display: flex; justify-content: flex-end; gap: var(--ma-sp-2); }
  .ma .support-text { font-size: var(--ma-fs-1); color: var(--ma-muted); }
  .ma .support-text[data-tone="success"] { color: var(--ma-success); }
  .ma .support-text[data-tone="error"] { color: var(--ma-danger); }
  .ma .support-text[data-tone="warning"] { color: var(--ma-warning); }
  .ma .support-text[data-tone="info"] { color: var(--ma-muted); }

  /* Toolbar / Header interno */
  .ma .toolbar { display:flex; align-items:center; gap: var(--ma-sp-2); padding: var(--ma-sp-3) 0; border-bottom:1px solid var(--ma-border); background: transparent; margin-bottom: var(--ma-sp-3); }
  .ma .toolbar .title { font-weight:700; }

  /* Tabelas */
  .ma .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .ma .table { width:100%; min-width: 720px; border-collapse: separate; border-spacing: 0; font-size: .96em; }
  .ma .table :where(th, td){ padding: .65rem .75rem; border-bottom:1px solid var(--ma-border); text-align:left; white-space: nowrap; }
  .ma .table th { color: var(--ma-muted); font-weight:600; position: sticky; top: 0; background: var(--ma-bg); }
  .ma .table tr:hover { background: color-mix(in oklab, var(--ma-brand) 6%, var(--ma-bg)); }

  /* Badges */
  .ma .badge { display:inline-block; border-radius: 999px; padding:.25em .6em; font-weight:600; font-size: .82em; border:1px solid color-mix(in oklab, var(--ma-brand) 35%, var(--ma-border)); color: var(--ma-brand-ink); background: color-mix(in oklab, var(--ma-brand) 14%, var(--ma-bg)); }

  /* Painel embutido (iframe) */
  .ma .panel { width:100%; height:70vh; border:0; border-radius: var(--ma-radius-2); box-shadow: var(--ma-shadow-1); }

  /* Catálogo embutido */
  .ma .catalog {
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    background: var(--ma-surface);
  }

  .ma .catalog__container {
    width: min(1120px, 100%);
    margin: 0 auto;
    padding: var(--ma-sp-5);
    display: flex;
    flex-direction: column;
    gap: var(--ma-sp-5);
  }

  .ma .catalog__header {
    display: flex;
    flex-direction: column;
    gap: var(--ma-sp-4);
    padding: var(--ma-sp-5);
    border: 1px solid var(--ma-border);
    border-radius: var(--ma-radius-2);
    background: var(--ma-bg);
    box-shadow: var(--ma-shadow-1);
  }

  .ma .catalog__heading h2 {
    margin-bottom: var(--ma-sp-2);
  }

  .ma .catalog__subtitle {
    color: var(--ma-muted);
    margin: 0;
  }

  .ma .catalog__controls {
    display: flex;
    flex-wrap: wrap;
    gap: var(--ma-sp-3);
  }

  .ma .catalog__search,
  .ma .catalog__filter {
    flex: 1 1 240px;
    display: flex;
  }

  .ma .catalog__search input,
  .ma .catalog__filter select {
    width: 100%;
    border: 1px solid var(--ma-border);
    border-radius: var(--ma-radius-1);
    padding: var(--ma-sp-3);
    background: var(--ma-surface);
    color: var(--ma-ink);
    box-shadow: var(--ma-shadow-1);
    transition: border-color .2s ease, box-shadow .2s ease;
  }

  .ma .catalog__search input:focus,
  .ma .catalog__filter select:focus {
    border-color: var(--ma-brand);
    box-shadow: var(--ma-focus-ring);
    outline: none;
  }

  .ma .catalog__status {
    margin: 0;
    font-size: var(--ma-fs-1);
    color: var(--ma-muted);
  }

  .ma .catalog__grid {
    display: grid;
    gap: var(--ma-sp-4);
    padding-bottom: var(--ma-sp-6);
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .ma .catalog-empty {
    margin: 0;
    padding: var(--ma-sp-5);
    text-align: center;
    border: 1px dashed var(--ma-border);
    border-radius: var(--ma-radius-1);
    background: color-mix(in oklab, var(--ma-border) 20%, transparent);
    color: var(--ma-muted);
  }

  .ma .catalog-card {
    display: flex;
    flex-direction: column;
    gap: var(--ma-sp-3);
    border: 1px solid var(--ma-border);
    border-radius: var(--ma-radius-1);
    padding: var(--ma-sp-4);
    background: var(--ma-bg);
    box-shadow: var(--ma-shadow-1);
    transition: transform .18s ease, box-shadow .18s ease;
    min-height: 220px;
  }

  .ma .catalog-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--ma-shadow-2);
  }

  .ma .catalog-card__header {
    display: flex;
    gap: var(--ma-sp-3);
    align-items: center;
  }

  .ma .catalog-card__icon {
    width: 48px;
    height: 48px;
    border-radius: var(--ma-radius-1);
    border: 1px solid var(--ma-border);
    object-fit: cover;
  }

  .ma .catalog-card__title h4 {
    margin: 0;
  }

  .ma .catalog-card__category {
    margin: 0;
    font-size: var(--ma-fs-1);
    color: var(--ma-muted);
  }

  .ma .catalog-card__description {
    margin: 0;
    color: var(--ma-muted);
  }

  .ma .catalog-card__footer {
    margin-top: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--ma-sp-3);
  }

  .ma .catalog-card__badge {
    display: inline-flex;
    align-items: center;
    gap: var(--ma-sp-2);
    border-radius: 999px;
    padding: calc(var(--ma-sp-2) / 1.1) var(--ma-sp-3);
    font-size: var(--ma-fs-1);
    font-weight: 600;
    background: color-mix(in oklab, var(--ma-brand) 18%, transparent);
    color: var(--ma-brand-ink);
  }

  .ma .catalog-card__badge--essential { background: color-mix(in oklab, var(--ma-brand) 25%, transparent); color: var(--ma-brand-ink); }
  .ma .catalog-card__badge--available { background: color-mix(in oklab, var(--ma-success) 22%, transparent); color: var(--ma-success); }
  .ma .catalog-card__badge--beta,
  .ma .catalog-card__badge--maintenance { background: color-mix(in oklab, var(--ma-warning) 25%, transparent); color: var(--ma-warning); }
  .ma .catalog-card__badge--deprecated { background: color-mix(in oklab, var(--ma-danger) 20%, transparent); color: var(--ma-danger); }
  .ma .catalog-card__badge--default { background: color-mix(in oklab, var(--ma-brand) 12%, transparent); color: var(--ma-brand); }

  .ma .catalog-card__link {
    font-weight: 600;
    color: var(--ma-brand);
    display: inline-flex;
    align-items: center;
    gap: var(--ma-sp-2);
  }

  .ma .catalog-card__link:hover,
  .ma .catalog-card__link:focus {
    text-decoration: underline;
  }

  .ma .catalog-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--ma-sp-3);
    padding: var(--ma-sp-6);
    color: var(--ma-muted);
  }

  .ma .catalog-loading__spinner {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 3px solid color-mix(in oklab, var(--ma-border) 70%, transparent);
    border-top-color: var(--ma-brand);
    animation: ma-spin 1s linear infinite;
  }

  /* Vega/Vega-Lite: tooltip e ações */
  .ma .vega-actions { display:none !important; }
  .ma .vega-tooltip { position: absolute; z-index: 10; padding:.5rem .65rem; background: var(--ma-bg); color: var(--ma-ink); border:1px solid var(--ma-border); border-radius: var(--ma-radius-1); box-shadow: var(--ma-shadow-2); font-size: var(--ma-fs-1); pointer-events: none; }
}

/* ========================
   UTILITÁRIOS
   ======================== */
@layer utilities {
  .ma { overflow-x: hidden; } /* sem rolagem horizontal no app */

  .ma .mt-0{margin-top:0} .ma .mb-0{margin-bottom:0} .ma .pt-0{padding-top:0} .ma .pb-0{padding-bottom:0}
  .ma .mt-1{margin-top:var(--ma-sp-1)} .ma .mb-1{margin-bottom:var(--ma-sp-1)}
  .ma .mt-2{margin-top:var(--ma-sp-2)} .ma .mb-2{margin-bottom:var(--ma-sp-2)}
  .ma .mt-3{margin-top:var(--ma-sp-3)} .ma .mb-3{margin-bottom:var(--ma-sp-3)}
  .ma .mt-4{margin-top:var(--ma-sp-4)} .ma .mb-4{margin-bottom:var(--ma-sp-4)}

  .ma .stack { display:flex; flex-direction:column; gap: var(--ma-sp-3); }
  .ma .cluster { display:flex; flex-wrap:wrap; align-items:center; gap: var(--ma-sp-2); }
  .ma .grid { display:grid; gap: var(--ma-sp-3); grid-template-columns: repeat(12, minmax(0,1fr)); }
  /* Grid auto seguro (sem overflow): */
  .ma .grid--auto { grid-template-columns: repeat(auto-fit, minmax(min(260px, 100%), 1fr)); }
  .ma .center { margin-inline:auto; }

  .ma .maxw-sm{ max-width: 480px; } .ma .maxw-md{ max-width: 720px; } .ma .maxw-lg{ max-width: 960px; } .ma .maxw-xl{ max-width: 1120px; }

  .ma .muted{ color: var(--ma-muted); }
  .ma .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
}

/* ========================
   COMPAT (apelidos antigos)
   ======================== */
@layer compat {
  /* Mapeie aliases antigos aqui se necessário */
}

/* ========================
   BREAKPOINTS
   ======================== */
@media (max-width: 480px) {
  .ma .wrap { padding: 12px; }
  .ma h1 { font-size: clamp(20px, 6vw, 28px); }
  .ma .app-header { flex-direction: column; align-items: flex-start; gap: var(--ma-sp-2); }
  .ma .app-header__branding { width: 100%; align-items: flex-start; gap: var(--ma-sp-2); }
  .ma .app-header__actions { margin-left: 0; width: 100%; justify-content: flex-start; }
  .ma .app-logo { height: 24px; }
  .ma .app-view__card { width: 100%; padding: var(--ma-sp-4); gap: var(--ma-sp-3); }
  .ma .form-actions { flex-direction: column; align-items: stretch; width: 100%; }
  .ma .form-actions .btn { width: 100%; justify-content: center; }
}
@media (width >= 640px){ .ma .wrap{ padding: var(--ma-sp-6); } }
@media (width >= 1024px){ .ma .container{ width: min(1280px, 100% - 2*var(--ma-sp-6)); } }
@media (prefers-reduced-motion: reduce) { .ma * { animation: none !important; transition: none !important; } }
