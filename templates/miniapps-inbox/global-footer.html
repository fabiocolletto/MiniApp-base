<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Ajustes Estéticos - Rodapé Global</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega o Material Icons Sharp (usado para os ícones no seu código) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <style>
        /* Variável de Cor Ativa - Laranja 5 Horas */
        :root {
            --color-5horas-active: #FF7F50; /* Um tom de laranja/coral para destaque */
        }

        /* Configurações Globais e Fontes */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Cor de fundo leve para contraste */
            margin: 0;
            padding: 0;
            /* Garante que o body ocupa a tela inteira, subtraindo o rodapé */
            min-height: 100vh;
        }

        /* Classes Customizadas do Rodapé (Para ajustes estéticos) */
        .app-footer {
            /* Fundo principal do rodapé */
            background-color: #ffffff; 
            /* Sombra para destacar */
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05); 
            /* Transição para expansão/recolhimento */
            transition: height 0.3s ease-in-out, padding 0.3s ease-in-out;
            /* Garante que ocupe a largura total e fique no fundo */
            width: 100%;
            position: fixed;
            bottom: 0;
            z-index: 1000;
        }

        /* Estilo para o estado 'collapsed' */
        .app-footer[data-footer-state="collapsed"] {
            height: 60px; /* Altura reduzida quando recolhido */
            overflow: hidden;
            /* Padroniza o padding superior e inferior para 0.5rem (8px) */
            padding-bottom: 0.5rem; 
            padding-top: 0.5rem;     
        }

        /* Estilo para o estado 'expanded' */
        .app-footer[data-footer-state="expanded"] {
            height: auto; /* Altura automática para mostrar os detalhes */
        }

        /* Iframe para o conteúdo principal */
        #contentIframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: transparent;
        }

        /* Ajusta o padding do body para que o conteúdo não fique escondido atrás do rodapé */
        .body-padding-bottom {
            padding-bottom: 76px; /* Altura mínima do rodapé (60px) + margem de segurança */
        }

        /* Oculta os rótulos de texto de navegação quando o rodapé está recolhido (collapsed) */
        .app-footer[data-footer-state="collapsed"] .nav-link-label {
            display: none;
        }

        /* Estilo dos Links de Navegação */
        .nav-link {
            color: #6b7280; /* Cor padrão do ícone e texto (Cinza/Inativo) */
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: color 0.2s, background-color 0.2s;
        }

        .nav-link:hover, .footer-toggle-nav-item:hover {
            color: #1f2937; /* Cor ao passar o mouse */
            background-color: #f3f4f6;
        }
        
        /* Estilo do link ativo */
        .nav-link.active {
            color: var(--color-5horas-active); /* COR ATIVA (Laranja 5 Horas) */
            /* REMOVIDO: font-weight para evitar mudança de tamanho/alinhamento */
        }
        
        /* Estilo do botão de toggle na navegação */
        .footer-toggle-nav-item {
            color: #6b7280; /* Cor padrão */
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: color 0.2s, background-color 0.2s;
        }

        /* Estilo do Ponto de Status (status-dot) */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* Cores dos Status */
        .status-offline {
            background-color: #f87171; /* Vermelho */
        }
        .status-online {
            background-color: #34d399; /* Verde */
        }
        .status-syncing {
            background-color: #fbbf24; /* Amarelo */
        }

        /* Estilo do botão de toggle (antigo - apenas para garantir) */
        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            color: #9ca3af;
            padding: 0.25rem;
            border-radius: 9999px;
            transition: color 0.2s, background-color 0.2s;
        }
        .icon-button:hover {
            color: #1f2937;
            background-color: #e5e7eb;
        }

        /* Estilo para o texto legal no modo expandido (oculto no compact/collapsed meta) */
        .footer-legal-collapsed {
             /* Esconder se estiver expandido */
            display: block; 
        }

        .app-footer[data-footer-state="expanded"] .footer-legal-collapsed {
            display: none;
        }
        .app-footer[data-footer-state="collapsed"] .footer-legal-expanded {
            display: none;
        }

        /* Classes de Botões */
        .button-primary {
            background-color: #1d4ed8;
            color: white;
        }
        .button-primary:hover {
            background-color: #1e40af;
        }

        .button-muted {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        .button-muted:hover {
            background-color: #d1d5db;
        }

        .button-outline {
            border: 1px solid #d1d5db;
            color: #1f2937;
        }
        .button-outline:hover {
            background-color: #f3f4f6;
        }

        /* Estilo para o contêiner de mensagens (simulado) */
        .message-box {
            background-color: #fffbe6;
            border: 1px solid #fcd34d;
            color: #92400e;
            margin-top: 1rem;
            text-align: center;
        }

        /* Estilo para o Rodapé em Modo Compacto (Mobile) */
        @media (max-width: 768px) {
            .app-footer {
                /* No mobile, o modo compacto é o padrão e deve ser totalmente dedicado à navegação rápida. */
                padding: 0.5rem 0.25rem;
            }
            .app-footer[data-footer-state="collapsed"] .footer-collapsed-meta {
                display: none; /* Esconde a meta info de status no modo mobile/compacto */
            }
            .nav-link {
                padding: 0.5rem 0.25rem;
            }
        }
    </style>
</head>
<body class="body-padding-bottom">
    <main class="h-full w-full absolute top-0 left-0 right-0 bottom-0">
        <!-- Iframe que carregará o conteúdo da mini-aplicação -->
        <iframe id="contentIframe" src="" title="Conteúdo da Mini-Aplicação"></iframe>
    </main>

    <!-- O Web Component do Rodapé -->
    <!-- MUDANÇA: active-tab agora é 'account' para iniciar no painel de usuário -->
    <app-shared-footer id="globalFooter" active-tab="account" variant="full" state="expanded"></app-shared-footer>

    <script>
        // Funções auxiliares para mudar os atributos do rodapé
        function setTab(tab) {
            document.getElementById('globalFooter').setAttribute('active-tab', tab);
            // Atualiza o iframe ao mudar a aba (simulando a navegação)
            document.getElementById('globalFooter').navigateTo(tab);
        }
        function setVariant(variant) {
            document.getElementById('globalFooter').setAttribute('variant', variant);
        }
        function toggleState() {
            const footer = document.getElementById('globalFooter');
            const currentState = footer.getAttribute('state');
            const newState = currentState === 'expanded' ? 'collapsed' : 'expanded';
            // setAttribute aciona o attributeChangedCallback que chama render() e atualiza o componente
            footer.setAttribute('state', newState); 
        }

        // Seus dados e classe AppSharedFooter, replicados do arquivo JS
        const NAV_ITEMS = [
            { key: "home", icon: "home", label: "Home" },
            { key: "alerts", icon: "notifications", label: "Alertas" },
            { key: "catalog", icon: "grid_view", label: "Catálogo" },
            { key: "settings", icon: "settings", label: "Configurações" },
            { key: "account", icon: "person", label: "Conta" },
        ];

        const DEFAULT_ACTIVE_TAB = "catalog";
        const DEFAULT_STATE = "expanded";

        class AppSharedFooter extends HTMLElement {
            static get observedAttributes() {
                return ["active-tab", "variant", "state"];
            }

            connectedCallback() {
                this.render();
                // Adiciona o listener de toggle após a renderização inicial
                this.setupToggle();
                // Carrega o conteúdo inicial ao conectar
                this.navigateTo(this.activeTab, { initialLoad: true });
            }

            attributeChangedCallback() { 
                this.render();
                // Re-adiciona o listener de toggle após a re-renderização
                this.setupToggle(); 
            }

            get activeTab() {
                const tab = (this.getAttribute("active-tab") || "").toLowerCase();
                return NAV_ITEMS.some((item) => item.key === tab) ? tab : DEFAULT_ACTIVE_TAB;
            }

            get variant() {
                const variant = (this.getAttribute("variant") || "").toLowerCase();
                return variant === "compact" ? "compact" : "full"; 
            }

            get footerState() {
                const state = (this.getAttribute("state") || "").toLowerCase();
                // Garante que o estado seja 'collapsed' se for 'compact'
                if (this.variant === "compact") return "collapsed";
                return state === "collapsed" ? "collapsed" : DEFAULT_STATE;
            }

            renderNavLinks({ isCompact }) {
                let navHtml = NAV_ITEMS.map((item) => {
                    const isActive = item.key === this.activeTab;
                    const baseClasses = [
                        "nav-link",
                        "flex",
                        "flex-col",
                        "items-center",
                        "transition",
                        "duration-150",
                    ];
                    if (isActive) {
                        baseClasses.push("active");
                    }
                    const label = isCompact
                        ? ""
                        : `<span class="nav-link-label text-xs mt-1">${item.label}</span>`;
                    return `
                        <a href="#" class="${baseClasses.join(" ")}" aria-label="${item.label}" data-nav-key="${item.key}">
                            <span class="material-icons-sharp text-3xl" aria-hidden="true">${item.icon}</span>
                            ${label}
                        </a>
                    `;
                }).join("");
                
                // Adicionar o botão de toggle como um ícone de navegação se não for compact
                if (!isCompact) {
                    const toggleIcon = this.footerState === "expanded" ? 'unfold_less' : 'unfold_more';
                    const toggleLabel = this.footerState === "expanded" ? 'Recolher' : 'Expandir';
                    const ariaExpanded = this.footerState === "expanded" ? 'true' : 'false';

                    // O botão usa o mesmo estilo base 'nav-link' para manter a consistência estética
                    navHtml += `
                        <button id="footerToggleButton" 
                                class="footer-toggle-nav-item flex flex-col items-center transition duration-150" 
                                type="button" 
                                aria-expanded="${ariaExpanded}" 
                                aria-controls="footerDetails">
                            <span class="material-icons-sharp text-3xl footer-toggle-icon" aria-hidden="true">${toggleIcon}</span>
                            <span class="nav-link-label text-xs mt-1">${toggleLabel}</span>
                        </button>
                    `;
                }
                
                return navHtml;
            }

            // Função de navegação SIMPLES (RAW) atualizada para manipular o iframe
            navigateTo(key, { initialLoad = false } = {}) { 
                const iframe = document.getElementById('contentIframe');
                let destination = '';

                // Conexão RAW: Define o caminho direto baseado na chave
                if (key === 'account') {
                    // Caminho para o painel do usuário (como nos seus arquivos)
                    destination = `miniapps/gestao-de-conta-do-usuario/index.html`; 
                } else {
                    // Placeholder simples para as outras abas, usando data URL
                    const title = NAV_ITEMS.find(item => item.key === key)?.label || 'Página';
                    destination = `data:text/html,<html><head><style>body{font-family:'Inter',sans-serif;background-color:#f0f4f8;padding:20px;text-align:center;}</style></head><body><h1 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">${title}</h1><p>Conteúdo simulado da aba ${title}.</p></body></html>`;
                }

                if (iframe) {
                    iframe.src = destination;

                    // Define o 'active-tab' no componente Web para refletir a navegação
                    if (!initialLoad) {
                        this.setAttribute('active-tab', key);
                    }
                } else {
                    console.error("Iframe #contentIframe não encontrado.");
                }
            }
            
            setupNavigation() {
                const navLinks = this.querySelectorAll(".nav-link[data-nav-key]");
                navLinks.forEach((link) => {
                    link.addEventListener("click", (event) => {
                        event.preventDefault();
                        const key = link.getAttribute("data-nav-key");
                        if (key) {
                            this.navigateTo(key);
                        }
                    });
                });
            }
            
            setupToggle() {
                const toggleButton = this.querySelector("#footerToggleButton");
                if (toggleButton) {
                    // Importante: toggleState está definido no escopo global do <script>
                    toggleButton.removeEventListener("click", toggleState); 
                    toggleButton.addEventListener("click", toggleState);
                }
            }


            renderCollapsedMeta({ isCompact }) {
                if (isCompact) {
                    return "";
                }
                /* REMOVIDO: O bloco footer-legal-collapsed era redundante e causava o vazamento de texto. */
                return ""; 
            }

            renderDetails({ isCompact }) {
                if (isCompact) {
                    return "";
                }
                // Aplica classe Tailwind para esconder/mostrar dinamicamente
                const detailsDisplay = this.footerState === "expanded" ? "" : "hidden"; 

                // NOVO TEXTO DE COPYRIGHT
                const legalText = `
                    &copy; 2024 5 Horas Pesquisa e Análise Ltda. CNPJ: 50.455.262/0001-19 | Curitiba, PR.
                `;

                return `
                    <div id="footerDetails" class="footer-details w-full mt-3 ${detailsDisplay}">
                        
                        <!-- A Linha de Ações (Botões: Conectar Google e Sincronizar) foi removida daqui -->

                        <div id="messageContainer" class="message-box p-3 rounded-lg shadow-xl hidden"></div>

                        <!-- Nova Linha Combinada: Status e Copyright (Antiga Linha 2 e 3 Combinadas) -->
                        <div class="footer-meta-bottom flex items-center justify-between text-xs text-gray-500 mt-2 px-1">
                            
                            <!-- Status Indicators + Sync Status (Esquerda) -->
                            <div class="status-indicators-group flex items-center space-x-4">
                                <div class="flex items-center space-x-2">
                                    <span id="connectionDot" class="status-dot status-offline inline-block"></span>
                                    <span id="connectionLabel" class="text-gray-600">Offline</span>
                                </div>
                                <!-- Sync Status Label (Mantida no centro/direita desta linha combinada) -->
                                <span id="syncStatusLabel" class="text-gray-500 hidden sm:inline">Sincronização não iniciada</span>
                            </div>

                            <!-- Expanded Legal Text (Direita, escondida no mobile para priorizar status) -->
                            <div class="footer-legal footer-legal-expanded text-right hidden sm:block">
                                <img src="https://5horas.com.br/wp-content/uploads/2025/10/Icone-Light-Transparente-500x500px.webp" 
                                     alt="Ícone 5Horas" 
                                     class="h-3 w-3 inline-block align-text-top mr-1" onerror="this.style.display='none';">
                                ${legalText}
                            </div>
                            
                        </div>
                        
                        <!-- Copyright para Mobile (Aparece se houver pouco espaço na linha combinada) -->
                        <div class="footer-legal footer-legal-expanded text-center text-xs text-gray-500 mx-auto mt-1 sm:hidden">
                            <img src="https://5horas.com.br/wp-content/uploads/2025/10/Icone-Light-Transparente-500x500px.webp" 
                                 alt="Ícone 5Horas" 
                                 class="h-3 w-3 inline-block align-text-top mr-1" onerror="this.style.display='none';">
                            ${legalText}
                        </div>

                    </div>
                `;
            }

            render() {
                const isCompact = this.variant === "compact";
                const footerState = this.footerState; // O getter já gerencia se é compact
                const navLinks = this.renderNavLinks({ isCompact });
                const collapsedMeta = this.renderCollapsedMeta({ isCompact });
                const details = this.renderDetails({ isCompact });

                this.innerHTML = `
                    <footer class="app-footer p-3 ${isCompact ? "rounded-t-xl" : "flex flex-col justify-center rounded-t-xl"}" data-footer-state="${footerState}">
                        <div class="footer-top w-full">
                            <div class="footer-quick-nav flex justify-around w-full">
                                ${navLinks}
                            </div>
                            ${collapsedMeta}
                        </div>
                        ${details}
                    </footer>
                `;

                this.setupNavigation();
                this.setupToggle();
            }
        }

        if (!customElements.get("app-shared-footer")) {
            customElements.define("app-shared-footer", AppSharedFooter);
        }
    </script>
</body>
</html>
