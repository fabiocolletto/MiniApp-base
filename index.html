<!doctype html>
<html lang="pt-BR" data-miniapp-base="/miniapp-base/">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MiniApps — Shell</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" data-asset-path="manifest.webmanifest" />
  <link
    rel="icon"
    type="image/png"
    sizes="192x192"
    data-icon-light="./miniapp-base/icons/icon-192.png"
    data-icon-dark="./miniapp-base/icons/icon-192.png"
    data-asset-path="miniapp-base/icons/icon-192.png"
  />
  <link
    rel="apple-touch-icon"
    data-icon-light="./miniapp-base/icons/icon-192.png"
    data-icon-dark="./miniapp-base/icons/icon-192.png"
    data-asset-path="miniapp-base/icons/icon-192.png"
  />
  <link
    id="miniapp-shell-style"
    rel="stylesheet"
    data-asset-path="miniapp-base/style/styles.css"
  />
  <script id="miniapp-shell-bootstrap">
    (function bootstrapMiniAppShell() {
      var doc = document;
      var globalConfig = (window.__APP_CONFIG__ = window.__APP_CONFIG__ || {});
      var origin = window.location.origin || (window.location.protocol + '//' + window.location.host);

      function ensureTrailingSlash(value) {
        return value.endsWith('/') ? value : value + '/';
      }

      function normalizeBase(candidate) {
        if (typeof candidate !== 'string' || !candidate.trim()) {
          return ensureTrailingSlash(origin + window.location.pathname.replace(/[^/]*$/, ''));
        }

        var trimmed = candidate.trim();
        try {
          var asUrl = new URL(trimmed, origin);
          return ensureTrailingSlash(asUrl.href);
        } catch (error) {
          var prefixed = trimmed.startsWith('/') ? trimmed : '/' + trimmed;
          return ensureTrailingSlash(origin + prefixed);
        }
      }

      var declaredBase = doc.documentElement.getAttribute('data-miniapp-base');
      var fallbackPath = (window.location.pathname || '/').replace(/[^/]*$/, '');
      var assetBaseUrl = normalizeBase(globalConfig.assetBaseUrl || declaredBase || fallbackPath);

      globalConfig.assetBaseUrl = assetBaseUrl;
      globalConfig.resolveAsset = function resolveAsset(relativePath) {
        if (typeof relativePath !== 'string' || !relativePath.trim()) {
          return relativePath;
        }
        try {
          return new URL(relativePath, assetBaseUrl).href;
        } catch (error) {
          return relativePath;
        }
      };

      function upgradeAsset(element, attribute, relativePath) {
        if (!element || !relativePath) {
          return;
        }
        var resolved = globalConfig.resolveAsset(relativePath);
        if (!resolved || element.getAttribute(attribute) === resolved) {
          return;
        }
        element.setAttribute(attribute, resolved);
      }

      doc.querySelectorAll('[data-asset-path]').forEach(function (element) {
        var attribute = element.hasAttribute('data-asset-attr')
          ? element.getAttribute('data-asset-attr')
          : element.tagName === 'LINK'
          ? 'href'
          : 'src';
        upgradeAsset(element, attribute, element.getAttribute('data-asset-path'));
      });

      doc.querySelectorAll('link[data-icon-light], link[data-icon-dark]').forEach(function (element) {
        if (element.dataset.iconLight) {
          element.dataset.iconLight = globalConfig.resolveAsset(element.dataset.iconLight);
        }
        if (element.dataset.iconDark) {
          element.dataset.iconDark = globalConfig.resolveAsset(element.dataset.iconDark);
        }
      });

      function ensureStylesheet() {
        var styleLink = doc.getElementById('miniapp-shell-style');
        if (!styleLink) {
          styleLink = doc.createElement('link');
          styleLink.id = 'miniapp-shell-style';
          styleLink.rel = 'stylesheet';
          styleLink.dataset.assetPath = 'miniapp-base/style/styles.css';
          doc.head.appendChild(styleLink);
        }
        upgradeAsset(styleLink, 'href', styleLink.getAttribute('data-asset-path'));
      }

      function loadScript(url, attributes) {
        return new Promise(function (resolve, reject) {
          if (!url) {
            resolve();
            return;
          }

          var selectorParts = [];
          if (attributes) {
            Object.keys(attributes).forEach(function (key) {
              selectorParts.push('[' + key + ']');
            });
          }

          if (selectorParts.length) {
            var selector = 'script[src="' + url + '"]' + selectorParts.join('');
            if (doc.querySelector(selector)) {
              resolve();
              return;
            }
          }

          var script = doc.createElement('script');
          script.src = url;
          if (attributes) {
            Object.entries(attributes).forEach(function ([key, value]) {
              if (value !== null && value !== undefined) {
                script.setAttribute(key, value);
              }
            });
          }
          script.onload = function () { resolve(script); };
          script.onerror = function (event) { reject(event); };
          doc.head.appendChild(script);
        });
      }

      ensureStylesheet();

      loadScript(globalConfig.resolveAsset('config/app-config.js'), { 'data-app-config': 'true' })
        .catch(function (error) {
          console.warn('MiniApp Shell: não foi possível carregar config/app-config.js.', error);
        })
        .finally(function () {
          loadScript(globalConfig.resolveAsset('js/app.js'), { type: 'module', 'data-app-entry': 'true' }).catch(function (error) {
            console.error('MiniApp Shell: falha ao carregar o módulo principal.', error);
          });
        });
    })();
  </script>
</head>
<body data-theme="light">
  <div id="miniapp-root" class="ma" data-theme="light">
    <div class="app" role="application">
      <header class="app-header" aria-live="polite">
        <div class="cluster app-header__branding">
          <div>
            <h1 data-header-title>Catálogo de MiniApps</h1>
            <p data-header-subtitle class="muted">Escolha um MiniApp para abrir</p>
          </div>
        </div>
        <div class="cluster app-header__actions">
          <button id="openCatalog" class="btn btn--ghost" type="button" title="Abrir catálogo">Catálogo</button>
          <button
            id="downloadMiniApp"
            class="btn btn--ghost"
            type="button"
            title="Baixar MiniApp"
            aria-label="Baixar MiniApp"
            hidden
          >
            <span data-download-label>Baixar MiniApp</span>
          </button>
          <button id="languageToggle" class="btn btn--ghost" type="button" aria-haspopup="true" aria-expanded="false" title="Alterar idioma">
            <span data-language-toggle-label>Português</span>
          </button>
          <button id="themeToggle" class="btn btn--ghost" type="button" aria-pressed="false" title="Ativar tema escuro">
            <span data-theme-toggle-label>Ativar tema escuro</span>
          </button>
        </div>
      </header>
      <main>
        <section id="catalog-view" class="app-view" hidden>
          <div id="catalog-app" class="app-panel catalog" data-catalog-root>
            <div class="catalog__container">
              <header class="catalog__header">
                <div class="catalog__heading">
                  <h2 data-catalog-title>Seu Catálogo de MiniApps</h2>
                  <p data-catalog-subtitle class="catalog__subtitle">Explore os aplicativos disponíveis para uso.</p>
                </div>
                <div class="catalog__controls">
                  <label class="catalog__search">
                    <span class="sr-only">Buscar</span>
                    <input
                      type="search"
                      data-catalog-search
                      placeholder="Buscar por nome, categoria ou descrição..."
                      autocomplete="off"
                    />
                  </label>
                  <label class="catalog__filter">
                    <span class="sr-only">Filtrar por categoria</span>
                    <select data-catalog-filter>
                      <option value="" data-default-option>Todas as Categorias</option>
                    </select>
                  </label>
                </div>
                <p data-catalog-status class="catalog__status">Inicializando...</p>
              </header>
              <div data-catalog-list class="catalog__grid" aria-live="polite">
                <div class="catalog-loading">
                  <span class="catalog-loading__spinner" aria-hidden="true"></span>
                  <span>Carregando catálogo…</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="app-view" class="app-view" hidden>
          <iframe id="miniapp-panel" name="miniapp-panel" class="app-panel" src="about:blank" title="MiniApp selecionado" loading="lazy"></iframe>
        </section>
      </main>
      <footer class="app-footer">
        <div class="cluster app-footer__branding">
          <span class="app-footer__logo" aria-hidden="true">
            <img
              src="https://5horas.com.br/wp-content/uploads/2025/10/Logo-Light-Transparente-2000x500px.webp"
              class="app-logo"
              data-theme-logo="light"
              alt=""
              loading="eager"
            />
            <img
              src="https://5horas.com.br/wp-content/uploads/2025/10/Logo-Dark-Transparente-2000x500px.webp"
              class="app-logo"
              data-theme-logo="dark"
              alt=""
              loading="eager"
            />
          </span>
          <span class="sr-only">5 Horas</span>
          <small>5 Horas — MiniApp Base</small>
        </div>
        <a class="btn btn--soft" href="#" id="installPWA" hidden>Instalar</a>
      </footer>
    </div>
  </div>
  <script type="module" src="js/app.js"></script>
</body>
</html>
