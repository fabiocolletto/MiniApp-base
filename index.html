<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>App 5 Horas ‚Äì MiniApps</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200" rel="stylesheet"/>
<!-- 1. Carregar Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- 2. Carregar Flowbite CDN CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.1.1/flowbite.min.css" rel="stylesheet" />

<style>
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
body, html { background-color: #f8fafc; color: #0f172a; }

/* Base de Estilo do Card */
.card-base {
    position: relative;
    border-radius: 1rem;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    transition: all 300ms;
    border-width: 1px;
    cursor: pointer;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    min-height: 200px;
    max-width: 320px; 
}
.card-base:hover {
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    transform: translateY(-0.25rem);
}
.card-base h2 { font-size: 1.25rem; font-weight: 600; }

.icon-xxl { font-size: 7rem; opacity: 0.3; }
@media (min-width: 640px) { .icon-xxl { font-size: 8rem; } }
@media (min-width: 1024px) { .icon-xxl { font-size: 9rem; } }

/* Grid System */
.app-grid-container { display: flex; justify-content: center; }
.app-grid-base { display: grid; gap: 1.5rem; width: 100%; }

/* Classe para <= 3 itens (Coluna √önica Estrita) */
.grid-1-col-app { grid-template-columns: repeat(1, minmax(0, 1fr)); max-width: 320px; }

/* Classe para > 3 itens (Grid Responsivo) */
.grid-3-col-app { grid-template-columns: repeat(1, minmax(0, 1fr)); }
@media (min-width: 640px) { .grid-3-col-app { grid-template-columns: repeat(2, minmax(0, 1fr)); max-width: 664px; } }
@media (min-width: 1200px) { .grid-3-col-app { grid-template-columns: repeat(3, minmax(0, 1fr)); max-width: 1008px; } }

/* Bot√µes Chip (Estilo Base Unificado) */
.chip-button {
    background-color: transparent !important;
    border-width: 1px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
    color: var(--chip-color-text) !important;
    transition: all 0.2s ease-in-out;
}
.chip-button:hover {
    background-color: var(--chip-color-hover) !important;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); 
}

/* Cores Espec√≠ficas dos Bot√µes */
#user-btn { --chip-color-text: #0891b2; border-color: #0891b2; --chip-color-hover: rgba(8, 145, 178, 0.1); }
#alert-btn { --chip-color-text: #d97706; border-color: #d97706; --chip-color-hover: rgba(217, 119, 6, 0.1); }
#home-btn { --chip-color-text: #4f46e5; border-color: #4f46e5; --chip-color-hover: rgba(79, 70, 229, 0.1); }

/* --- REGRAS GLOBAIS PARA BOT√ïES FLUTUANTES (Voltar e Fechar) --- */

/* Bot√£o Voltar Global (Azul) */
#back-btn-float button { 
    --chip-color-text: #2563eb; 
    border-color: #bfdbfe; /* Azul claro suave na borda */
    --chip-color-hover: rgba(37, 99, 235, 0.1); 
    background-color: white !important;
}

/* Bot√£o Fechar Global (Vermelho) */
#close-btn-float button {
    --chip-color-text: #ef4444; 
    border-color: #fecaca; /* Vermelho claro suave na borda */
    --chip-color-hover: rgba(254, 202, 202, 0.3);
    background-color: white !important;
}
</style>
</head>
<body class="min-h-screen antialiased">

<main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 pt-8 min-h-screen flex flex-col">

    <!-- 1. TELA: PORTF√ìLIO PRINCIPAL -->
    <div id="portfolio-view">
        <section class="mt-4 text-center">
            <h1 class="text-3xl font-bold tracking-tight">Portf√≥lio de Aplica√ß√µes</h1>
            <p class="mt-1 text-sm text-gray-500">Selecione o sistema que deseja acessar:</p>
        </section>
        <div class="app-grid-container">
            <section id="portfolio-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>

    <!-- 2. TELAS DE CATEGORIAS (Educa√ß√£o, Finan√ßas, Sa√∫de, Tarefas) -->
    <div id="education-categories-view" class="hidden">
        <section class="mt-4 text-center">
            <h1 id="education-title" class="text-3xl font-bold tracking-tight">Educa√ß√£o: Categorias</h1>
            <p class="mt-1 text-sm text-gray-500">Selecione uma √°rea para iniciar.</p>
        </section>
        <div class="app-grid-container">
            <section id="education-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>
    
    <div id="finance-menu-view" class="hidden">
        <section class="mt-4 text-center">
            <h1 class="text-3xl font-bold tracking-tight">Finan√ßas: Gest√£o</h1>
            <p class="mt-1 text-sm text-gray-500">Ferramentas para seu controle financeiro.</p>
        </section>
        <div class="app-grid-container">
            <section id="finance-menu-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>

    <div id="health-menu-view" class="hidden">
        <section class="mt-4 text-center">
            <h1 class="text-3xl font-bold tracking-tight">Sa√∫de: Categorias</h1>
            <p class="mt-1 text-sm text-gray-500">Ferramentas de bem-estar e monitoramento.</p>
        </section>
        <div class="app-grid-container">
            <section id="health-menu-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>

    <div id="tasks-menu-view" class="hidden">
        <section class="mt-4 text-center">
            <h1 class="text-3xl font-bold tracking-tight">Tarefas e Produtividade</h1>
            <p class="mt-1 text-sm text-gray-500">Gerencie seus compromissos e foco.</p>
        </section>
        <div class="app-grid-container">
            <section id="tasks-menu-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>


    <!-- 3. TELA: MENU DO ALUNO -->
    <div id="student-menu-view" class="hidden">
        <section class="mt-4 text-center">
            <h1 class="text-3xl font-bold tracking-tight">√Årea do Aluno</h1>
            <p class="mt-1 text-sm text-gray-500">Selecione o servi√ßo desejado.</p>
        </section>
        <div class="app-grid-container">
            <section id="student-menu-grid" class="mt-6 app-grid-base"></section>
        </div>
    </div>
    
</main>

<!-- BOT√ÉO VOLTAR (FLUTUANTE ESQUERDA - GLOBAL) -->
<div id="back-btn-float" class="fixed top-4 left-4 z-[60] hidden">
    <button onclick="showPortfolio()" class="chip-button font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center shadow-md transition-transform hover:scale-105">
        <span class="material-symbols-rounded text-xl mr-2">arrow_back</span>
        <span>Voltar</span>
    </button>
</div>

<!-- BOT√ÉO FECHAR (FLUTUANTE DIREITA - GLOBAL) -->
<div id="close-btn-float" class="fixed top-4 right-4 z-[60] hidden">
    <button onclick="closeCurrentMiniApp()" class="chip-button font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center shadow-md transition-transform hover:scale-105">
        <span class="material-symbols-rounded text-xl mr-2">close</span>
        <span>Fechar</span>
    </button>
</div>

<!-- ================= MODAIS (VISUALIZA√á√ÉO IMERSIVA) ================= -->

<!-- 1. PAINEL DE USU√ÅRIO -->
<div id="user-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-cyan-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="user-panel-frame" class="w-full h-full border-0" title="Painel do Usu√°rio"></iframe>
    </div>
</div>

<!-- 2. PAINEL DE ALERTAS -->
<div id="alert-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-amber-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="alert-panel-frame" class="w-full h-full border-0" title="Painel de Alertas"></iframe>
    </div>
</div>

<!-- 3. SIMULADOS -->
<div id="simulados-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-pink-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="simulados-frame" class="w-full h-full border-0" title="App Simulados"></iframe>
    </div>
</div>

<!-- NOVO: MODAL PADR√ÉO DE PLACEHOLDER (EST√ÅTICO) -->
<div id="placeholder-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-300 flex flex-col overflow-hidden animate-fade-in-up p-8 text-center">
        <span class="material-symbols-rounded text-6xl text-gray-500 mx-auto mb-4">construction</span>
        <h3 class="text-xl font-bold text-gray-800">Recurso em Desenvolvimento</h3>
        <p class="text-gray-600 mt-2">Esta funcionalidade estar√° dispon√≠vel em breve. Agradecemos sua paci√™ncia!</p>
        <button onclick="closeCurrentMiniApp()" class="chip-button mt-6 bg-gray-50 text-gray-700 border-gray-300 hover:bg-gray-100 font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center mx-auto transition">
            <span class="material-symbols-rounded text-xl mr-2">check</span>
            <span>Entendido</span>
        </button>
    </div>
</div>

<!-- 5. MODAL DE TAREFAS (FUNCIONAL) -->
<div id="tasks-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-red-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="tasks-frame" class="w-full h-full border-0" title="App Lista de Tarefas"></iframe>
    </div>
</div>

<!-- 6. MODAL DE PLANEJAMENTO SEMANAL (FUNCIONAL) -->
<div id="weekly-planner-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-indigo-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="weekly-planner-frame" class="w-full h-full border-0" title="App Planejamento Semanal"></iframe>
    </div>
</div>

<!-- 7. MODAL: CALEND√ÅRIO MENSAL (FUNCIONAL) -->
<div id="monthly-calendar-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-blue-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="monthly-calendar-frame" class="w-full h-full border-0" title="App Agenda Mensal"></iframe>
    </div>
</div>

<!-- 8. MODAL: ACOMPANHAMENTO (FUNCIONAL) -->
<div id="tracking-dashboard-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-purple-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="tracking-dashboard-frame" class="w-full h-full border-0" title="App Acompanhamento"></iframe>
    </div>
</div>

<!-- NOVO MODAL: CADASTRO INSTITUI√á√ÉO -->
<div id="institution-registration-modal-overlay" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex justify-center items-center w-full h-full bg-black/60 backdrop-blur-sm p-4">
    <div class="relative w-full max-w-5xl min-h-full h-full bg-white rounded-2xl shadow-2xl border border-purple-500 flex flex-col overflow-hidden animate-fade-in-up">
        <iframe id="institution-registration-frame" class="w-full h-full border-0" title="App Cadastro Institui√ß√£o"></iframe>
    </div>
</div>

<!-- LOADING GLOBAL -->
<div id="loading-modal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-[60] flex justify-center items-center w-full h-full bg-black/30 backdrop-blur-sm">
    <div class="bg-white rounded-2xl p-6 shadow-2xl flex flex-col items-center">
        <svg aria-hidden="true" class="w-10 h-10 text-gray-200 animate-spin fill-blue-600 mb-3" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/><path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9171 97.0079 33.5532C95.2932 28.8223 92.871 24.3692 89.8167 20.348C85.8318 15.352 80.8878 11.238 75.2124 7.95925C69.3789 4.47169 63.0454 2.19507 56.5135 1.07246C53.5136 0.514332 50.4131 0.473551 47.4653 0.999784C43.3421 1.77636 39.399 3.25708 35.8458 5.41995C33.454 6.94273 31.543 8.87895 30.0163 11.1397C28.4896 13.4005 27.3503 15.8996 26.6521 18.5273C25.9538 21.1551 25.6174 23.8821 25.6174 26.6346Z" fill="current-fill"/></svg>
        <p class="text-sm font-semibold text-gray-700">Carregando...</p>
    </div>
</div>

<!-- NAVEGA√á√ÉO INFERIOR -->
<div id="main-nav-buttons" class="fixed left-6 bottom-8 z-30 flex flex-col space-y-2 transition-opacity duration-300">
    <!-- Ordem visual: In√≠cio (Topo) -> Alertas (Meio) -> Usu√°rio (Base) -->
    <button id="home-btn" type="button" onclick="showPortfolio()" class="chip-button font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center">
        <span class="material-symbols-rounded text-xl mr-2">home</span><span class="hidden sm:inline">In√≠cio</span>
    </button>
    <button id="alert-btn" type="button" onclick="loadAlertPanel()" class="chip-button font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center">
        <span class="material-symbols-rounded text-xl mr-2">notifications</span><span class="hidden sm:inline">Alertas</span>
    </button>
    <button id="user-btn" type="button" onclick="loadUserPanel()" class="chip-button font-medium rounded-full text-sm px-4 py-2.5 inline-flex items-center">
        <span class="material-symbols-rounded text-xl mr-2">account_circle</span><span class="hidden sm:inline">Usu√°rio</span>
    </button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.1.1/flowbite.min.js"></script>

<script>
    // --- VARI√ÅVEIS DE ESTADO ---
    let currentOpenModalId = null; 

    // --- DADOS ---
    const PORTFOLIO_ITEMS = [
        { title: "Educa√ß√£o", href: "javascript:showEducationCategories()", color: "pink", icon: "cast_for_education" },
        { title: "Financeiro", href: "javascript:showFinanceMenu()", color: "emerald", icon: "account_balance" }, 
        { title: "Sa√∫de", href: "javascript:showHealthMenu()", color: "sky", icon: "health_and_safety" }, 
        { title: "Tarefas", href: "javascript:showTasksMenu()", color: "amber", icon: "calendar_month" }, 
    ];
    
    const EDUCATION_CATEGORIES = [
        { title: "Alunos", href: "javascript:showStudentMenu()", color: "sky", icon: "person" },
        { title: "Tutores", href: "javascript:showPlaceholder()", color: "emerald", icon: "supervisor_account", status: "Em breve" }, 
        { title: "Professores", href: "javascript:showPlaceholder()", color: "amber", icon: "person_pin", status: "Em breve" }, 
        // NOVO: Institui√ß√µes agora carrega o MiniApp
        { title: "Institui√ß√µes", href: "javascript:loadInstitutionRegistrationApp()", color: "purple", icon: "apartment" }, 
    ];
    
    // --- DADOS FINANCEIRO ---
    const FINANCE_MENU_ITEMS = [
        // Voltando para placeholder est√°tico
        { title: "Gest√£o de Despesas", href: "javascript:showPlaceholder()", color: "emerald", icon: "payments", status: "Em breve" }, 
        { title: "Metas e Economia", href: "javascript:showPlaceholder()", color: "teal", icon: "savings", status: "Em breve" },
        { title: "Contas a Pagar", href: "javascript:showPlaceholder()", color: "red", icon: "event_busy", status: "Em breve" },
        { title: "Calculadora de Juros", href: "javascript:showPlaceholder()", color: "cyan", icon: "calculate", status: "Em breve" },
    ];

    // --- DADOS SA√öDE ---
    const HEALTH_MENU_ITEMS = [
        // Voltando para placeholder est√°tico
        { title: "Monitoramento de Sinais", href: "javascript:showPlaceholder()", color: "sky", icon: "monitor_heart", status: "Em breve" }, 
        { title: "Exerc√≠cios e Treino", href: "javascript:showPlaceholder()", color: "red", icon: "fitness_center", status: "Em breve" },
        { title: "Alimenta√ß√£o e Nutri√ß√£o", href: "javascript:showPlaceholder()", color: "green", icon: "local_dining", status: "Em breve" },
        { title: "Di√°rio de Corrida", href: "javascript:showPlaceholder()", color: "amber", icon: "directions_run", status: "Em breve" },
    ];

    const TASKS_MENU_ITEMS = [
        { title: "Planejamento Semanal", href: "javascript:loadWeeklyPlannerApp()", color: "amber", icon: "event_note" }, 
        { title: "Lista de Tarefas", href: "javascript:loadTasksApp()", color: "red", icon: "check_box" }, 
        { title: "Agenda (Mensal)", href: "javascript:loadMonthlyCalendarApp()", color: "blue", icon: "calendar_month" }, 
        { title: "Acompanhamento", href: "javascript:loadTrackingDashboardApp()", color: "purple", icon: "timeline" },
    ];

    const STUDENT_MENU_ITEMS = [
        { title: "Simulados", href: "javascript:startSimuladosFlow()", color: "pink", icon: "edit_square" },
        { title: "Provas", href: "javascript:showPlaceholder()", color: "red", icon: "assignment", status: "Em breve" },
        { title: "Tarefas", href: "javascript:showPlaceholder()", color: "indigo", icon: "task", status: "Em breve" },
        { title: "Avisos", href: "javascript:showPlaceholder()", color: "blue", icon: "campaign", status: "Em breve" }
    ];

    // --- CONTROLE DE INTERFACE ---
    function toggleMainInterface(show) {
        const navButtons = document.getElementById('main-nav-buttons');
        const backBtn = document.getElementById('back-btn-float');
        
        if (show) {
            navButtons.classList.remove('hidden');
            if (document.getElementById('portfolio-view').classList.contains('hidden')) {
                backBtn.classList.remove('hidden');
            }
        } else {
            navButtons.classList.add('hidden');
            backBtn.classList.add('hidden');
        }
    }

    function closeCurrentMiniApp() {
        if (currentOpenModalId) {
            document.getElementById(currentOpenModalId).classList.add('hidden');
            document.getElementById('close-btn-float').classList.add('hidden'); 
            toggleMainInterface(true); 
            currentOpenModalId = null;
        }
    }
    
    // FUN√á√ÉO PARA O PLACEHOLDER EST√ÅTICO
    function showPlaceholder() {
        toggleMainInterface(false);
        document.getElementById('placeholder-modal-overlay').classList.remove('hidden');
        document.getElementById('close-btn-float').classList.remove('hidden'); 
        currentOpenModalId = 'placeholder-modal-overlay';
    }


    // --- FUN√á√ïES DE NAVEGA√á√ÉO ---
    function showPortfolio() {
        switchView('portfolio-view');
        renderGridSection("portfolio-grid", PORTFOLIO_ITEMS, true);
        document.getElementById("back-btn-float").classList.add('hidden');
    }

    function showEducationCategories() {
        switchView('education-categories-view');
        renderGridSection("education-grid", EDUCATION_CATEGORIES, false);
        updateBackButton(showPortfolio);
    }
    
    function showFinanceMenu() {
        switchView('finance-menu-view');
        renderGridSection("finance-menu-grid", FINANCE_MENU_ITEMS, false);
        updateBackButton(showPortfolio);
    }

    function showHealthMenu() {
        switchView('health-menu-view');
        renderGridSection("health-menu-grid", HEALTH_MENU_ITEMS, false);
        updateBackButton(showPortfolio);
    }
    
    function showTasksMenu() { 
        switchView('tasks-menu-view'); 
        renderGridSection("tasks-menu-grid", TASKS_MENU_ITEMS, false); 
        updateBackButton(showPortfolio);
    }


    function showStudentMenu() {
        switchView('student-menu-view');
        renderGridSection("student-menu-grid", STUDENT_MENU_ITEMS, false);
        updateBackButton(showEducationCategories);
    }
    
    // --- RENDERIZA√á√ÉO DO GRID ---
    function renderGridSection(id, data, isMain) {
        const container = document.getElementById(id);
        if (container) {
            container.className = "mt-6 app-grid-base";
            if (data.length <= 3) {
                container.classList.add('grid-1-col-app');
            } else {
                container.classList.add('grid-3-col-app');
            }
            container.innerHTML = data.map(item => getCardTemplate(item, isMain)).join('');
        }
    }
    
    // --- FUN√á√ÉO PARA CONTROLAR VISIBILIDADE DO LOADING ---
    function showLoading(show) {
        const loading = document.getElementById('loading-modal');
        if (loading) {
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }
    }

    // --- FERRAMENTA PADR√ÉO DE CARREGAMENTO (MANTIDA PARA APPS FUNCIONAIS) ---
    async function loadMiniApp(iframeId, url, basePath, modalIdToOpen) {
        const frame = document.getElementById(iframeId);
        
        toggleMainInterface(false); 
        showLoading(true); 
        
        document.getElementById(modalIdToOpen).classList.remove('hidden'); 
        document.getElementById('close-btn-float').classList.remove('hidden'); 
        
        currentOpenModalId = modalIdToOpen;
        
        if (frame.srcdoc && !frame.srcdoc.includes("Carregando...")) {
             showLoading(false); 
             return; 
        }

        frame.srcdoc = `<div style="display:flex;justify-content:center;align-items:center;height:100%;font-family:sans-serif;color:#666;">Carregando...</div>`;

        try {
            console.log(`Carregando MiniApp [${iframeId}]`);
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            let htmlContent = await response.text();

            htmlContent = htmlContent.replace(/class="[^"]*dark[^"]*"/g, 'class=""');
            htmlContent = htmlContent.replace(/data-theme="dark"/g, 'data-theme="light"');
            htmlContent = htmlContent.replace(/<header[\s\S]*?<\/header>/gi, ''); 

            const baseTag = `<base href="${basePath}">`;

            const styleClean = `
            <style>
                ::-webkit-scrollbar { width: 6px; }
                ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
                ::-webkit-scrollbar-track { background: transparent; }

                html, body {
                    width: 100%; 
                    height: auto; 
                    min-height: 100%; 
                    margin: 0; 
                    padding: 0;
                    padding-bottom: 120px !important; 
                    background: transparent !important; 
                    overflow-x: hidden;
                    overflow-y: auto;
                    box-sizing: border-box;
                }
                header, footer, nav, .navbar, .header-bar, h1 { display: none !important; }
                
                main, .container, .card, .bg-white {
                    box-shadow: none !important; border: none !important;
                    background-color: transparent !important;
                    width: 100% !important; max-width: 100% !important;
                    padding: 1.5rem !important; margin: 0 !important;
                }
            </style>
            `;
            
            frame.srcdoc = htmlContent.replace('<head>', `<head>${baseTag}${styleClean}`);

        } catch (error) {
            console.error(`Falha ao carregar ${iframeId}:`, error);
            // Mensagem de Fallback autom√°tica mantida para MiniApps futuros (que podem ser implementados)
            frame.srcdoc = `<div style="text-align:center; padding:2rem; font-family:sans-serif;">
                <div style="font-size:3rem; margin-bottom:1rem; opacity:0.5;">üöß</div>
                <h3 style="color:#4b5563; margin:0;">M√≥dulo em Implanta√ß√£o</h3>
                <p style="color:#9ca3af; font-size:0.9rem;">O arquivo <code>${url.split('/').pop()}</code> ainda n√£o est√° dispon√≠vel.</p>
            </div>`;
        } finally {
             showLoading(false);
        }
    }

    // --- IMPLEMENTA√á√ÉO ---

    function startSimuladosFlow() {
        showSimuladosIframe();
    }

    function showSimuladosIframe() {
        loadMiniApp(
            'simulados-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/simulados.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/',
            'simulados-modal-overlay'
        );
    }

    function loadUserPanel() {
        loadMiniApp(
            'user-panel-frame',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/src/components/user-panel.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/src/components/',
            'user-modal-overlay'
        );
    }

    function loadAlertPanel() {
        loadMiniApp(
            'alert-panel-frame',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/src/components/alert-panel.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/src/components/',
            'alert-modal-overlay'
        );
    }

    // NOVO: Fun√ß√£o de carregamento para o Cadastro da Institui√ß√£o
    function loadInstitutionRegistrationApp() {
        loadMiniApp(
            'institution-registration-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/institution-registration.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/',
            'institution-registration-modal-overlay' 
        );
    }

    // --- FUN√á√ïES DE TAREFAS/PRODUTIVIDADE (MANTIDAS) ---
    function loadTasksApp() {
        loadMiniApp(
            'tasks-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/tasks.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/',
            'tasks-modal-overlay' 
        );
    }
    
    function loadWeeklyPlannerApp() {
        loadMiniApp(
            'weekly-planner-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/weekly-planner.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/',
            'weekly-planner-modal-overlay' 
        );
    }
    
    function loadMonthlyCalendarApp() {
        loadMiniApp(
            'monthly-calendar-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/monthly-calendar.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/',
            'monthly-calendar-modal-overlay' 
        );
    }
    
    function loadTrackingDashboardApp() {
        loadMiniApp(
            'tracking-dashboard-frame', 
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/tracking-dashboard.html',
            'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/tarefas/',
            'tracking-dashboard-modal-overlay' 
        );
    }

    // --- HELPER FUNCTIONS ---
    function switchView(viewId) {
        ['portfolio-view', 'education-categories-view', 'student-menu-view', 'finance-menu-view', 'health-menu-view', 'tasks-menu-view'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        });
        const target = document.getElementById(viewId);
        if (target) target.classList.remove('hidden');
    }

    function updateBackButton(action) {
        const btnDiv = document.getElementById("back-btn-float");
        const btnEl = btnDiv.querySelector('button');
        
        btnEl.onclick = action; 
        btnDiv.classList.remove('hidden');
    }

    function getCardTemplate(item, isMain) {
        // Gera o HTML do chip de status se o item.status existir
        let statusChipHtml = '';
        if (item.status === "Em breve") {
            // Estilo discreto no canto superior direito
            statusChipHtml = `
                <div class="absolute top-3 right-3 z-20">
                    <span class="bg-gray-400 text-white text-xs font-semibold px-2 py-0.5 rounded-full shadow-md">
                        ${item.status}
                    </span>
                </div>
            `;
        }

        const opacity = item.opacity ? 'opacity-50' : '';
        return `
            <div onclick="${item.href}" role="button" class="card-base border-${item.color}-500 bg-${item.color}-500/20 ${opacity}">
                ${statusChipHtml} <!-- CHIP DE STATUS ADICIONADO AQUI -->
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
                    <span class="material-symbols-rounded leading-none icon-xxl text-${item.color}-500">${item.icon}</span>
                </div>
                <div class="relative z-10 flex flex-col justify-end h-full text-center">
                    <h2 class="text-${item.color}-700">${item.title}</h2>
                </div>
            </div>`;
    }

    document.addEventListener("DOMContentLoaded", showPortfolio);
</script>
</body>
</html>
