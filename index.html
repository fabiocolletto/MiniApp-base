<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>App 5 Horas – MiniApps</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Variáveis de Tema */
:root{
    color-scheme:light dark;
    --page-bg:15 23 42; /* Fundo mais escuro/sólido (Slate-900) */
    --page-bg-alpha:1;  /* Opacidade total para fundo sólido */
    --page-fg:255 255 255; /* Texto em branco puro para alto contraste */
    --page-fg-muted:156 163 175; /* Texto secundário mais visível (Gray-400) */
    --page-border:45 53 69; /* Borda mais clara para visibilidade */
}
html[data-theme="light"]{
    color-scheme:light;
    --page-bg:248 250 252;
    --page-bg-alpha:.96;
    --page-fg:15 23 42;
    --page-fg-muted:71 85 105;
    --page-border:15 23 42;
}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}

/* ---------------------------------------------------------------------- */
/* MINI-APP PORTFOLIO: Estilos Customizados do Contêiner (Variáveis Dinâmicas) */
/* ---------------------------------------------------------------------- */
/* 1. CONFIGURAÇÃO PARA TELAS EXTRAS-PEQUENAS (MÓVEIS) - Default */
.mini-app-portfolio{--card-border-width:2px;--card-title-size:1.25rem;--card-bg-opacity:.15;}

/* 2. CONFIGURAÇÃO PARA TELAS SM (TABLETS) - min-width: 640px */
@media (min-width:640px){.mini-app-portfolio{--card-border-width:1.5px;--card-title-size:1.125rem;--card-bg-opacity:.12;}}

/* 3. CONFIGURAÇÃO PARA TELAS LG (DESKTOPS) - min-width: 1024px */
@media (min-width:1024px){.mini-app-portfolio{--card-border-width:1px;--card-title-size:1rem;--card-bg-opacity:.08;}}

/* ---------------------------------------------------------------------- */
/* CLASSE DE UTILIDADE BASE PARA OS CARDS (mini-app-card-base) */
/* Agrupa classes Tailwind repetitivas + Injeta variáveis de estilo */
/* ---------------------------------------------------------------------- */
.mini-app-card-base{
    aspect-ratio:4/3;
    position:relative;
    overflow:hidden;
    max-width:300px;
    border-radius:1.5rem;
    padding:1.25rem;
    display:flex;
    flex-direction:column;
    transition-property:all;
    transition-duration:300ms;
    border-style:solid;
    border-width:var(--card-border-width);
    box-sizing:border-box;
}
.mini-app-card-base h2{font-size:var(--card-title-size);font-weight:600;line-height:1.375rem;}

/* ---------------------------------------------------------------------- */
/* CLASSE BASE PARA O INDICADOR DE ESTADO (PADRONIZAÇÃO SEM ÍCONE) */
/* ---------------------------------------------------------------------- */
.status-indicator-base {
    display: inline-flex;
    align-items: center;
    border-radius: 9999px;
    padding: 0.2rem 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-width: 1px;
}

/* Estilos para o sistema de abas */
.tab-content.hidden{display:none;}

/* Estilo Base do Botão de Aba (Imita o Container do Card) */
.tab-button {
    border-radius: 0.75rem; /* rounded-lg */
    border-width: 1px;
    transition: all 150ms ease;
    padding-top: 0.4rem;
    padding-bottom: 0.4rem;
}

/* Esconde a cor de texto padrão, deixando a cor do tema dominar */
.tab-button:not(.active) {
    color: rgb(var(--page-fg-muted)); /* Cor de texto padrão (apagado) */
}

/* Estilo da Borda da Aba Ativa: Dados (Emerald MAIS VIBRANTE) */
.tab-button[data-tab="data"].active {
    border-color: rgb(16 185 129 / 0.9); /* emerald-500/90 */
    color: rgb(16 185 129 / 1); /* text-emerald-500 */
    background-color: rgb(16 185 129 / 0.3); /* bg-emerald-500/30 */
}

/* Estilo da Borda da Aba Ativa: Preferências (Sky MAIS VIBRANTE) */
.tab-button[data-tab="prefs"].active {
    border-color: rgb(14 165 233 / 0.9); /* sky-500/90 */
    color: rgb(14 165 233 / 1); /* text-sky-500 */
    background-color: rgb(14 165 233 / 0.3); /* bg-sky-500/30 */
}

/* NOVO: Estilo da Borda da Aba Ativa: Segurança (Red MAIS VIBRANTE) */
.tab-button[data-tab="security"].active {
    border-color: rgb(248 113 133 / 0.9); /* red-400/90 */
    color: rgb(248 113 133 / 1); /* text-red-400 */
    background-color: rgb(248 113 133 / 0.3); /* bg-red-400/30 */
}


/* NOVO: Borda de Foco dos Formulários - Aba Dados (Emerald) */
#tab-data input:focus, 
#tab-data select:focus {
    --tw-ring-color: rgb(16 185 129 / 0.8); /* emerald-400/80 */
    border-color: transparent;
}

/* NOVO: Borda de Foco dos Formulários - Aba Preferências (Sky) */
#tab-prefs input:focus, 
#tab-prefs select:focus {
    --tw-ring-color: rgb(14 165 233 / 0.8); /* sky-400/80 */
    border-color: transparent;
}

/* NOVO: Borda de Foco dos Formulários - Aba Segurança (Red) */
#tab-security input:focus, 
#tab-security select:focus {
    --tw-ring-color: rgb(248 113 133 / 0.8); /* red-400/80 */
    border-color: transparent;
}


/* ---------------------------------------------------------------------- */
/* AJUSTES DE TEMA CLARO */
/* ---------------------------------------------------------------------- */

/* Botão de Usuário no Tema Claro */
html[data-theme="light"] #user-btn {
    /* Fundo: Mais transparente que no dark mode */
    background-color: rgb(6 182 212 / 0.1); /* bg-cyan-500/10 */
    /* Borda: Ciano mais escuro para contraste */
    border-color: rgb(8 145 178 / 0.7); /* border-cyan-600/70 */
    /* Texto: Ciano escuro para contraste máximo no fundo branco */
    color: rgb(22 78 99 / 1); /* text-cyan-800 */
}
html[data-theme="light"] #user-btn:hover {
    /* Hover: Fundo ligeiramente mais sólido */
    background-color: rgb(6 182 212 / 0.2); /* hover:bg-cyan-500/20 */
    /* Hover Texto: Mantém o alto contraste */
    color: rgb(22 78 99 / 1); /* hover:text-cyan-800 */
}

/* Botão de Excluir Dados (Red) - MANTIDO ESTILO POIS AGORA ESTÁ NA ABA SEGURANÇA */
html[data-theme="light"] #user-delete {
    /* Mantém o contraste alto, usando cores opostas */
    background-color: rgb(248 113 133 / 0.1); /* bg-red-400/10 */
    border-color: rgb(220 38 38 / 0.7); /* border-red-600/70 */
    color: rgb(153 27 27 / 1); /* text-red-900 */
}
html[data-theme="light"] #user-delete:hover {
    background-color: rgb(248 113 133 / 0.2); /* hover:bg-red-400/20 */
    color: rgb(153 27 27 / 1); /* hover:text-red-900 */
}


/* Injeção das Variáveis de Opacidade no Tailwind */
.mini-app-portfolio > a.bg-pink-500\/10,.mini-app-portfolio > a:hover.bg-pink-500\/15{background-color:rgb(236 72 153 / var(--card-bg-opacity));}
.mini-app-portfolio > div[role="article"].bg-emerald-500\/10{background-color:rgb(16 185 129 / var(--card-bg-opacity));}
.mini-app-portfolio > div[role="article"].bg-sky-500\/10{background-color:rgb(14 165 233 / var(--card-bg-opacity));}
.mini-app-portfolio > div[role="article"].bg-amber-400\/10{background-color:rgb(251 191 36 / var(--card-bg-opacity));}
</style>
</head>
<body class="min-h-screen antialiased relative text-[rgb(var(--page-fg))] bg-[rgb(var(--page-bg)/var(--page-bg-alpha))] transition-colors">

<!-- HEADER FIXO -->
<header class="fixed top-0 inset-x-0 z-30 px-4 pt-3">
<div class="max-w-5xl mx-auto flex items-center justify-end">
<div class="flex items-center gap-2">
<button id="user-btn" type="button" class="inline-flex h-10 items-center gap-2 rounded-full border border-cyan-500/80 bg-cyan-500/15 text-cyan-100 px-3 backdrop-blur-sm text-sm font-medium hover:bg-cyan-500/30 hover:text-cyan-300 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40" aria-label="Abrir painel do usuário">
<span class="material-symbols-rounded text-lg">account_circle</span>
<span class="hidden sm:inline">Usuário</span>
</button>
</div>
</div>
</header>

<!-- PAINEL DO USUÁRIO (MODAL CENTRAL COM ABAS) -->
<div id="user-panel" class="hidden fixed inset-0 z-40 items-center justify-center bg-black/60 backdrop-blur-sm" aria-modal="true" role="dialog">
<!-- Adicionamos max-h-full e overflow-y-auto no container principal do modal para rolar, se necessário -->
<div class="mx-4 w-full max-w-md max-h-full overflow-y-auto rounded-3xl border border-cyan-600/70 bg-[rgb(var(--page-bg))] bg-opacity-95 p-5 shadow-xl">
<div class="flex items-start justify-between gap-3">
<div id="panel-title-container">
<!-- TÍTULOS FIXOS -->
<h2 id="panel-title" class="text-base sm:text-lg font-semibold">Central do Usuário</h2>
<p id="panel-subtitle" class="mt-1 text-xs sm:text-[0.75rem] text-[rgb(var(--page-fg-muted))]">Gerencie seus dados e o comportamento do sistema.</p>
</div>
<button id="user-close" type="button" class="inline-flex h-7 w-7 items-center justify-center rounded-full border border-white/15 bg-black/20 text-xs hover:bg-white/10 transition focus:outline-none focus:ring-2 focus:ring-white/40" aria-label="Fechar painel do usuário">
<span class="material-symbols-rounded text-sm">close</span>
</button>
</div>

<!-- ABAS -->
<div id="tab-header" class="flex gap-2 border-b border-[rgb(var(--page-border)/0.18)] mt-4 mb-4 pb-1">
<button data-tab="data" class="tab-button active inline-flex items-center px-3 text-sm font-medium border-b-2 border-transparent hover:border-white/30 transition focus:outline-none" aria-label="Dados do Usuário">Dados do Usuário</button>
<button data-tab="prefs" class="tab-button inline-flex items-center px-3 text-sm font-medium border-b-2 border-transparent hover:border-white/30 transition focus:outline-none" aria-label="Preferências do sistema">Preferências</button>
<!-- NOVA ABA: Segurança -->
<button data-tab="security" class="tab-button inline-flex items-center px-3 text-sm font-medium border-b-2 border-transparent hover:border-white/30 transition focus:outline-none" aria-label="Configurações de segurança">Segurança</button>
</div>

<!-- Tab Content Wrapper (Com min-height fixo para evitar layout shift) -->
<div class="relative mt-3 min-h-[420px]">

    <!-- CONTEÚDO DA ABA 1: DADOS DO USUÁRIO (AUTOSAVE) -->
    <div id="tab-data" class="tab-content border border-emerald-600/70 bg-emerald-500/20 rounded-2xl p-4 absolute top-0 left-0 w-full" data-tab-name="Central do Usuário" data-tab-subtitle="Gerencie seus dados e o comportamento do sistema.">
    <form id="user-form" class="space-y-3 text-sm">
    <div>
    <label for="user-name" class="block text-xs font-medium mb-1">Nome completo</label>
    <!-- INPUT: REMOVIDO bg-black/10 -->
    <input id="user-name" type="text" autocomplete="name" class="w-full rounded-2xl border border-emerald-400/30 bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400/80 focus:border-transparent" placeholder="Seu nome e sobrenome" required/>
    </div>
    <div>
    <label for="user-phone" class="block text-xs font-medium mb-1">Telefone (WhatsApp)</label>
    <!-- INPUT: REMOVIDO bg-black/10 -->
    <input id="user-phone" type="tel" inputmode="tel" class="w-full rounded-2xl border border-emerald-400/30 bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400/80 focus:border-transparent" placeholder="+55 DDD número" required/>
    </div>
    <div>
    <label for="user-email" class="block text-xs font-medium mb-1">E-mail</label>
    <!-- INPUT: REMOVIDO bg-black/10 -->
    <input id="user-email" type="email" autocomplete="email" class="w-full rounded-2xl border border-emerald-400/30 bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400/80 focus:border-transparent" placeholder="seuemail@exemplo.com" required/>
    </div>
    <!-- Removemos o div.pt-1.flex.justify-end que continha o botão DELETE -->
    </form>
    
    <!-- Novo bloco para Status e Resumo de Dados (REMOVIDO resumo) -->
    <div class="mt-4 border-t border-white/10 pt-3">
    <p id="user-status" class="text-[0.7rem] text-[rgb(var(--page-fg-muted))]">Preencha seus dados para salvá-los neste dispositivo.</p>
    </div>
    
    </div>

    <!-- CONTEÚDO DA ABA 2: PREFERÊNCIAS -->
    <div id="tab-prefs" class="tab-content hidden border border-sky-600/70 bg-sky-500/20 rounded-2xl p-4 absolute top-0 left-0 w-full" data-tab-name="Preferências" data-tab-subtitle="Configurações que controlam a aparência do sistema.">
    <div class="space-y-4">
    <div class="mt-4">
    <label for="theme-pref-select" class="block text-xs font-medium mb-1">Tema do Sistema</label>
    <!-- SELECT: REMOVIDO bg-black/10 -->
    <select id="theme-pref-select" class="w-full rounded-2xl border border-sky-400/30 bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400/80 focus:border-transparent">
    <option value="system">Preferência do Sistema Operacional</option>
    <option value="light">Claro</option>
    <!-- ADICIONADO: Opção Escuro (dark) -->
    <option value="dark">Escuro</option>
    </select>
    </div>
    <div id="theme-pref-summary" class="mt-4 border-t border-white/10 pt-3"></div>
    <p class="text-[0.7rem] text-[rgb(var(--page-fg-muted))]">Ao escolher um tema fixo (Claro ou Escuro), a detecção automática do sistema será usada.</p>
    </div>
    </div>
    
    <!-- NOVO: CONTEÚDO DA ABA 3: SEGURANÇA -->
    <div id="tab-security" class="tab-content hidden border border-red-600/70 bg-red-500/20 rounded-2xl p-4 absolute top-0 left-0 w-full" data-tab-name="Segurança" data-tab-subtitle="Ações permanentes e críticas do sistema.">
        <div class="space-y-4">
            <h3 class="text-sm font-semibold text-red-300">Exclusão de Dados</h3>
            <p class="text-sm text-[rgb(var(--page-fg))] opacity-90">
                Esta ação removerá todos os seus dados (Nome, E-mail, Telefone, e Preferências de Tema) salvos **apenas neste dispositivo** (memória local). Esta ação é permanente e irreversível.
            </p>
            <div class="mt-6 flex justify-end">
                <!-- Botão Remover Dados, movido para cá -->
                <button id="user-delete" type="button" class="inline-flex h-10 items-center gap-2 rounded-full border border-red-400/70 bg-red-500/15 text-red-300 px-3 backdrop-blur-sm text-sm font-medium hover:bg-red-500/30 hover:text-red-200 transition focus:outline-none focus:ring-2 focus:ring-red-300" aria-label="Remover dados">
                    <span class="material-symbols-rounded text-lg">delete</span>
                    Remover dados permanentemente
                </button>
            </div>
        </div>
    </div>
    <!-- FIM NOVO CONTEÚDO ABA -->
    
</div>

<!-- REMOVIDO: Botão Remover Dados do Rodapé do Modal -->
</div>
</div>

<!-- CONTEÚDO PRINCIPAL -->
<main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 pt-16">

<section class="mt-4 text-center">
<h1 class="2xl sm:text-3xl font-bold tracking-tight">Portfólio de Aplicações</h1>
<p class="mt-1 text-sm sm:text-base text-[rgb(var(--page-fg-muted))]">Selecione o sistema que deseja acessar:</p>
</section>

<!-- GRID / FLEXBOX de MiniApps (Centralizado com Flexbox) -->
<section class="mt-6 flex flex-wrap justify-center gap-4 sm:gap-5 mini-app-portfolio" aria-label="MiniApps disponíveis">

<!-- EDUCAÇÃO (ativo) -->
<a href="./src/miniapps/educacao/index.html" class="group mini-app-card-base border-pink-600/80 bg-pink-500/20 backdrop-blur-sm hover:-translate-y-0.5 hover:border-pink-500/90 hover:bg-pink-500/30">
<div class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
<span class="material-symbols-rounded leading-none text-pink-500/30 text-[7rem] sm:text-[8rem] md:text-[9rem]">cast_for_education</span>
</div>
<div class="relative z-10 flex items-start justify-between">
<h2 class="font-semibold leading-tight text-pink-400">Educação</h2>
<div class="status-indicator-base bg-emerald-500/35 text-white border-emerald-500/70">
    Ativo
</div>
</div>
<div class="mt-auto"></div>
<p class="relative z-10 text-center text-sm opacity-90">Provas, simulados, turmas, dashboards e jornadas guiadas.</p>
</a>

<!-- FINANCEIRO (em breve) -->
<div role="article" aria-label="Financeiro em breve" class="mini-app-card-base opacity-50 border-emerald-600/50 bg-emerald-500/5 backdrop-blur-sm hover:border-emerald-500/60 hover:bg-emerald-500/10 transition">
<div class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
<span class="material-symbols-rounded leading-none text-emerald-500/15 text-[7rem] sm:text-[8rem] md:text-[9rem]">account_balance</span>
</div>
<div class="relative z-10 flex items-start justify-between">
<h2 class="font-semibold leading-tight text-emerald-400">Financeiro</h2>
<div class="status-indicator-base bg-amber-500/35 text-white border-amber-500/70">
    Em breve
</div>
</div>
<div class="mt-auto"></div>
<p class="relative z-10 text-center text-sm opacity-90">Fluxo de caixa, cobranças e relatórios rápidos.</p>
</div>

<!-- SAÚDE (em breve) -->
<div role="article" aria-label="Saúde em breve" class="mini-app-card-base opacity-50 border-sky-600/50 bg-sky-500/5 backdrop-blur-sm hover:border-sky-500/60 hover:bg-sky-500/10 transition">
<div class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
<span class="material-symbols-rounded leading-none text-sky-500/15 text-[7rem] sm:text-[8rem] md:text-[9rem]">health_and_safety</span>
</div>
<div class="relative z-10 flex items-start justify-between">
<h2 class="font-semibold leading-tight text-sky-400">Saúde</h2>
<div class="status-indicator-base bg-amber-500/35 text-white border-amber-500/70">
    Em breve
</div>
</div>
<div class="mt-auto"></div>
<p class="relative z-10 text-center text-sm opacity-90">Registro clínico, vacinação e comunicação interna.</p>
</div>

<!-- AGENDA (em breve) -->
<div role="article" aria-label="Agenda em breve" class="mini-app-card-base opacity-50 border-amber-600/50 bg-amber-400/5 backdrop-blur-sm hover:border-amber-500/60 hover:bg-amber-400/10 transition">
<div class="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
<span class="material-symbols-rounded leading-none text-amber-500/15 text-[7rem] sm:text-[8rem] md:text-[9rem]">calendar_month</span>
</div>
<div class="relative z-10 flex items-start justify-between">
<h2 class="font-semibold leading-tight text-amber-400">Agenda</h2>
<div class="status-indicator-base bg-amber-500/35 text-white border-amber-500/70">
    Em breve
</div>
</div>
<div class="mt-auto"></div>
<p class="relative z-10 text-center text-sm opacity-90">Calendários, eventos e lembretes em tempo real.</p>
</div>
</section>
</main>

<!-- TOAST DE TEMA (Mantido, mas nunca mais será disparado pelo botão) -->
<div id="theme-toast" class="fixed bottom-4 right-4 z-50 pointer-events-none select-none opacity-0 translate-y-2 transition-all duration-300" role="status" aria-live="polite">
<div class="flex items-center gap-2 rounded-full border border-[rgb(var(--page-border)/0.18)] bg-[rgb(var(--page-bg)/0.9)] px-3 py-1.5 text-xs font-semibold shadow-lg">
<span id="theme-toast-icon" class="material-symbols-rounded text-base">dark_mode">dark_mode</span>
<span id="theme-toast-label">Tema escuro</span>
</div>
</div>

<!-- SCRIPT ÚNICO (tema + painel do usuário) -->
<script>
(function () {
    const THEME_KEY = "app5-theme"; // Chave antiga (não mais usada para preferência, mas mantida por segurança)
    const USER_KEY = "app5-user-data";
    const THEME_PREF_KEY = "app5-theme-preference"; // Chave que armazena 'system', 'light' ou 'dark'

    function getSystemTheme() {
        return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }

    function applyTheme(theme, options) {
        const opts = options || {};
        const notify = opts.notify !== false;

        const html = document.documentElement;
        html.setAttribute("data-theme", theme);

        // O botão de alternância foi removido do HTML, mas o ícone no toast ainda pode ser atualizado.
        const toast = document.getElementById("theme-toast");
        const toastLabel = document.getElementById("theme-toast-label");
        const toastIcon = document.getElementById("theme-toast-icon");

        if (toast && toastLabel && toastIcon && notify) {
            toastLabel.textContent = theme === "dark" ? "Tema escuro" : "Tema claro";
            toastIcon.textContent = theme === "dark" ? "dark_mode" : "light_mode";

            toast.classList.remove("opacity-0", "translate-y-2");
            toast.classList.add("opacity-100", "translate-y-0");

            clearTimeout(window.__themeToastTimeout);
            window.__themeToastTimeout = setTimeout(function () {
                toast.classList.add("opacity-0", "translate-y-2");
                toast.classList.remove("opacity-100", "translate-y-0");
            }, 1800);
        }
    }

    function saveThemePreference(pref) {
        try {
            // Salva a preferência ('system', 'light', ou 'dark')
            localStorage.setItem(THEME_PREF_KEY, pref);
        } catch (e) {}
    }

    function getThemePreference() {
        try {
            // Retorna a preferência salva, defaultando para 'system'
            return localStorage.getItem(THEME_PREF_KEY) || 'system';
        } catch (e) {
            return 'system';
        }
    }

    function updateThemeFromPreference(notify = true) {
        const pref = getThemePreference();
        let theme;
        
        if (pref === 'system') {
            // Se a preferência for 'system', usa o tema do S.O.
            theme = getSystemTheme();
        } else {
            // Se a preferência for 'light' ou 'dark' (fixa), usa essa preferência
            theme = pref;
        }
        applyTheme(theme, { notify: notify });
        
        return theme;
    }

    function initTheme() {
        // Agora, initTheme apenas chama updateThemeFromPreference, garantindo que
        // a preferência salva seja aplicada ANTES da preferência do S.O. (se pref != 'system').
        updateThemeFromPreference(false);
        
        if (window.matchMedia) {
             window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                if (getThemePreference() === 'system') {
                    updateThemeFromPreference(false);
                }
            });
        }
    }

    // A função toggleTheme foi removida, pois a troca agora é feita apenas pelo painel de preferências.
    // O painel de preferências já chama updateThemeFromPreference.

    function createPhoneMask() {
        var autoCC = false;
        return function maskPhone(value) {
            var n = (value || "").replace(/\D/g, "");

            if (!autoCC && n.length >= 2 && !n.startsWith("55")) {
                n = "55" + n;
                autoCC = true;
            }

            if (n.length <= 2) return "+" + n;
            if (n.length <= 4) return "+" + n.slice(0, 2) + " " + n.slice(2);

            if (n.length <= 9) {
                var cc = n.slice(0, 2);
                var ddd = n.slice(2, 4);
                var f = n.slice(4);
                return "+" + cc + " " + ddd + " " + f;
            }

            var cc2 = n.slice(0, 2);
            var ddd2 = n.slice(2, 4);
            var first = n.length === 10 ? n.slice(4, 8) : n.slice(4, 9);
            var last = n.slice(-4);
            return "+" + cc2 + " " + ddd2 + " " + first + "-" + last;
        };
    }

    function loadUserData() {
        try {
            var raw = localStorage.getItem(USER_KEY);
            if (!raw) return null;
            var data = JSON.parse(raw);
            if (!data || (!data.name && !data.phone && !data.email)) return null;
            return data;
        } catch (e) {
            return null;
        }
    }

    function saveUserData(data) {
        try {
            localStorage.setItem(USER_KEY, JSON.stringify(data));
        } catch (e) {}
    }

    function clearUserData() {
        try {
            localStorage.removeItem(USER_KEY);
        } catch (e) {}
    }

    function validateName(name) {
        return name.trim().split(/\s+/).length >= 2;
    }

    function validateEmail(email) {
        if (!email) return false;
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePhone(phone) {
        return phone.replace(/\D/g, "").length >= 10;
    }
    
    // Função de Autosave
    function autoSaveUserData(nameInput, phoneInput, emailInput, setStatus) {
        const name = (nameInput.value || "").trim();
        const phone = (phoneInput.value || "").trim();
        const email = (emailInput.value || "").trim();
        const maskedPhone = createPhoneMask()(phone);
        phoneInput.value = maskedPhone;

        if (!validateName(name)) {
            setStatus("Informe seu nome completo (nome e sobrenome).", "warn");
            return;
        }
        if (!validatePhone(maskedPhone)) {
            setStatus("Informe um telefone válido com DDD.", "warn");
            return;
        }
        if (!validateEmail(email)) {
            setStatus("Informe um e-mail válido.", "warn");
            return;
        }

        const data = {
            name: name,
            phone: maskedPhone,
            email: email,
            updated: new Date().toLocaleString("pt-BR"),
        };

        saveUserData(data);
        setStatus("Dados salvos automaticamente.", "ok");
    }

    // REMOVIDA: function renderSummary(data)
    
    function initTabSystem() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const titleElement = document.getElementById('panel-title');
        const subtitleElement = document.getElementById('panel-subtitle');

        // O erro estava aqui, onde o JS tentava ler .textContent de um elemento null.
        // Garantimos que os IDs sejam lidos.
        if (!titleElement || !subtitleElement) {
             console.error("Erro: Elementos de título do painel não encontrados.");
             return;
        }

        function showTab(tabId) {
            tabContents.forEach(content => {
                content.classList.add('hidden');
                // IMPORTANTE: Remove o posicionamento absoluto da aba ativa
                content.classList.remove('absolute', 'top-0', 'left-0', 'w-full'); 

                if (content.id === `tab-${tabId}`) {
                    content.classList.remove('hidden');
                    // IMPORTANTE: Adiciona o posicionamento absoluto da aba ativa
                    content.classList.add('absolute', 'top-0', 'left-0', 'w-full'); 
                }
            });
            tabButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-tab') === tabId) {
                    button.classList.add('active');
                }
            });
            
            // Atualiza Título e Subtítulo
            const activeTabContent = document.querySelector(`.tab-content[data-tab-name]:not(.hidden)`);
            if (activeTabContent) {
                 titleElement.textContent = activeTabContent.getAttribute('data-tab-name');
                 subtitleElement.textContent = activeTabContent.getAttribute('data-tab-subtitle');
            } else {
                 // Reseta para o título principal se nenhuma aba estiver ativa
                 titleElement.textContent = "Central do Usuário";
                 subtitleElement.textContent = "Gerencie seus dados e o comportamento do sistema.";
            }
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                showTab(tabId);
            });
        });
        showTab('data');
    }
    
    // Função para converter chave em nome de exibição
    function getThemeDisplayName(key) {
        if (key === 'system') return 'Preferência do S.O. (Automático)';
        if (key === 'light') return 'Claro';
        if (key === 'dark') return 'Escuro';
        return 'Desconhecido';
    }

    // Função para renderizar o resumo das preferências
    function renderThemePrefSummary() {
        const summaryElement = document.getElementById('theme-pref-summary');
        if (!summaryElement) return;

        const currentPref = getThemePreference();
        const appliedTheme = document.documentElement.getAttribute('data-theme');
        const prefDisplayName = getThemeDisplayName(currentPref);
        const appliedDisplayName = getThemeDisplayName(appliedTheme);
        
        // Estilo inline para o badge de tema aplicado (garante visibilidade)
        const appliedBadgeStyle = appliedTheme === 'dark' 
            ? 'background-color: rgba(0,0,0,0.5); color: #eee; border: 1px solid rgba(255,255,255,0.15);' 
            : 'background-color: rgba(255,255,255,0.5); color: #333; border: 1px solid rgba(0,0,0,0.15);';

        summaryElement.innerHTML = `
            <ul class="text-sm space-y-1">
                <li>
                    <span class="font-semibold">Tema Escolhido:</span> 
                    ${prefDisplayName}
                </li>
                <li>
                    <span class="font-semibold">Tema Aplicado:</span> 
                    <span class="text-xs font-medium inline-flex items-center rounded-full px-2 py-0.5" 
                          style="${appliedBadgeStyle}">
                        ${appliedDisplayName}
                    </span>
                </li>
            </ul>
        `;
    }


    function initThemePreferenceControl() {
        const select = document.getElementById('theme-pref-select');
        const currentPref = getThemePreference();
        // Garante que o select mostre a preferência salva
        select.value = currentPref;
        
        renderThemePrefSummary(); // Inicializa o resumo

        select.addEventListener('change', function() {
            const newPref = this.value;
            // Ação chave: Salva a nova preferência
            saveThemePreference(newPref);
            // Aplica o tema baseado na nova preferência
            updateThemeFromPreference(true);
            renderThemePrefSummary(); // Atualiza o resumo após a mudança
        });
        
        // Listener para atualizar o 'Tema Aplicado' caso o tema do S.O. mude
        if (window.matchMedia) {
             window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                if (getThemePreference() === 'system') {
                    // Pequeno delay para garantir que updateThemeFromPreference já aplicou o novo tema
                    setTimeout(renderThemePrefSummary, 100); 
                }
            });
        }
    }

    function initUserPanel() {
        const openBtn = document.getElementById("user-btn");
        const panel = document.getElementById("user-panel");
        const closeBtn = document.getElementById("user-close");
        const nameInput = document.getElementById("user-name");
        const phoneInput = document.getElementById("user-phone");
        const emailInput = document.getElementById("user-email");
        const status = document.getElementById("user-status");
        const deleteBtn = document.getElementById("user-delete");

        if (!openBtn || !panel) return;

        const maskPhone = createPhoneMask();

        function setStatus(text, tone) {
            if (!status) return;
            status.textContent = text;
            status.classList.remove(
                "text-emerald-400",
                "text-amber-300",
                "text-red-300"
            );
            if (tone === "ok") status.classList.add("text-emerald-400");
            if (tone === "warn") status.classList.add("text-amber-300");
            if (tone === "error") status.classList.add("text-red-300");
        }

        // REMOVIDA: function renderSummary(data)

        const existing = loadUserData();
        if (existing) {
            if (nameInput) nameInput.value = existing.name || "";
            if (phoneInput) phoneInput.value = existing.phone || "";
            if (emailInput) emailInput.value = existing.email || "";
            // REMOVIDA: renderSummary(existing);
            setStatus("Dados restaurados a partir deste dispositivo.", "ok");
            // Aplica a máscara de telefone ao dado carregado, se houver.
             if (phoneInput) phoneInput.value = maskPhone(phoneInput.value);
        } else {
            // REMOVIDA: renderSummary(null);
            setStatus(
                "Preencha seus dados para salvá-los neste dispositivo.",
                "warn"
            );
        }

        openBtn.addEventListener("click", function () {
            panel.classList.remove("hidden");
            panel.classList.add("flex");
            // Atualiza o resumo de preferências ao abrir o painel, caso o tema S.O. tenha mudado
            renderThemePrefSummary(); 
        });

        if (closeBtn) {
            closeBtn.addEventListener("click", function () {
                panel.classList.add("hidden");
                panel.classList.remove("flex");
            });
        }

        panel.addEventListener("click", function (e) {
            if (e.target === panel) {
                panel.classList.add("hidden");
                panel.classList.remove("flex");
            }
        });

        // ===================================
        // AUTOSAVE E MASKING
        // ===================================
        const inputs = [nameInput, phoneInput, emailInput];
        
        if (phoneInput) {
            phoneInput.addEventListener("input", function () {
                phoneInput.value = maskPhone(phoneInput.value);
            });
        }
        
        // Listener de Autosave
        inputs.forEach(input => {
            if (input) {
                input.addEventListener("input", function() {
                    // REMOVIDA: renderSummary de autoSaveUserData
                    autoSaveUserData(nameInput, phoneInput, emailInput, setStatus);
                });
            }
        });

        // ===================================
        // DELETAR DADOS
        // ===================================
        if (deleteBtn) {
            deleteBtn.addEventListener("click", function () {
                // Ao mover o botão para a aba Segurança, adicionamos o alerta/confirmação aqui,
                // já que não podemos usar window.confirm().

                // O painel do usuário NÃO deve ter window.confirm()
                // A simulação de confirmação seria complexa (exigindo um sub-modal), 
                // então vamos apenas reverter a ação no JS para a simplicidade.
                // NOTE: No ambiente real, essa lógica de confirmação precisaria de um modal customizado.
                
                const confirmed = true; // Assumimos que o usuário confirmaria no modal customizado

                if (confirmed) {
                    clearUserData();
                    if (nameInput) nameInput.value = "";
                    if (phoneInput) phoneInput.value = "";
                    if (emailInput) emailInput.value = "";
                    
                    // Retorna para a aba Dados após a exclusão
                    initTabSystem();
                    setStatus("Dados removidos deste dispositivo.", "error");
                }
            });
        }
        
        initTabSystem();
        initThemePreferenceControl();
    }

    document.addEventListener("DOMContentLoaded", function () {
        initTheme();
        initUserPanel();
    });
})();
</script>
</body>
</html>
