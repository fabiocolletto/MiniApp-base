<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniApp - Shell React</title>
    <link rel="stylesheet" href="https://unpkg.com/open-props@1.6.18/open-props.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/docs/miniapp-global.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/docs/miniapp-card.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="./docs/components/app-shared-header.js"></script>
    <script src="./docs/components/app-shared-footer.js"></script>
    <link rel="manifest" href="https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/pwa/manifest.webmanifest">
    <meta name="theme-color" content="#f3f4f6">
    <style>
        app-shared-footer .icon-button:hover,
        app-shared-footer .icon-button:focus-visible {
            background-color: transparent !important;
            box-shadow: none !important;
        }
    </style>
</head>
<body class="body-with-fixed-footer" style="margin: 0; padding: 0; width: 100%; height: 100%; overflow-x: hidden;">
    <div id="root"></div>
    <script>
        const h = React.createElement;
        const { useCallback, useEffect, useMemo, useState } = React;
        const HeaderComponent = window.AppSharedHeader;
        const FooterComponent = window.AppSharedFooter;

        if (!HeaderComponent || !FooterComponent) {
            throw new Error('Componentes compartilhados não foram carregados para o shell React.');
        }

        const NAV_STAGE_DEFINITIONS = {
            catalog: {
                key: 'catalog',
                title: 'MiniApp de Catálogo',
                description: 'Lista oficial de miniapps em preparo.',
                icon: 'grid_view',
                sourceId: 'catalog',
                isCore: true,
                launchUrl: './miniapps/catalog/index.html'
            },
            favorites: {
                key: 'favorites',
                title: 'MiniApp de Favoritos',
                description: 'Painel para organizar atalhos favoritos.',
                icon: 'star',
                sourceId: 'favorites',
                isCore: true,
                launchUrl: './miniapps/favorites/index.html'
            },
            recents: {
                key: 'recents',
                title: 'MiniApp de Recentes',
                description: 'Histórico de miniapps acessados recentemente.',
                icon: 'history',
                sourceId: 'recents',
                isCore: true,
                launchUrl: './miniapps/recents/index.html'
            },
            settings: {
                key: 'settings',
                title: 'MiniApp de Configurações',
                description: 'Preferências globais do usuário.',
                icon: 'settings',
                sourceId: 'settings',
                isCore: true,
                launchUrl: './miniapps/settings/index.html'
            }
        };

        function IframeStage({ stageDefinition }) {
            return h(
                'section',
                { id: `iframe-stage-${stageDefinition.key}`, className: 'stage-panel iframe-stage', style: { padding: '0' } },
                h('iframe', {
                    src: stageDefinition.launchUrl,
                    title: stageDefinition.title,
                    style: { width: '100%', height: '100%', border: 'none' }
                })
            );
        }

        function App() {
            const navDefinitions = useMemo(() => NAV_STAGE_DEFINITIONS, []);
            const resolveStageDefinition = useCallback(
                (key) => {
                    const normalizedKey = (key || '').toLowerCase();
                    if (Object.prototype.hasOwnProperty.call(navDefinitions, normalizedKey)) {
                        return navDefinitions[normalizedKey];
                    }
                    return navDefinitions.catalog;
                },
                [navDefinitions]
            );
            const [activeStageKey, setActiveStageKey] = useState(() => resolveStageDefinition('catalog').key);
            const [footerState, setFooterState] = useState('expanded');

            const handleNavigate = useCallback(
                (key) => {
                    setActiveStageKey(resolveStageDefinition(key).key);
                },
                [resolveStageDefinition]
            );

            const handleFooterStateChange = useCallback((nextState) => {
                setFooterState(nextState);
            }, []);

            useEffect(() => {
                const stageDefinition = resolveStageDefinition(activeStageKey);
                if (stageDefinition.launchUrl) {
                    window.dispatchEvent(
                        new CustomEvent('app:notify', {
                            detail: {
                                message: `Navegando para Iframe: ${stageDefinition.title}`,
                                type: 'info'
                            }
                        })
                    );
                }
            }, [activeStageKey, resolveStageDefinition]);

            const activeStageDefinition = resolveStageDefinition(activeStageKey);
            const mainContent = activeStageDefinition.launchUrl
                ? h(IframeStage, { stageDefinition: activeStageDefinition })
                : h('section', { className: 'stage-panel' },
                    h('div', { className: 'placeholder-card' },
                        h('div', { className: 'placeholder-icon', 'aria-hidden': 'true' },
                            h('span', { className: 'material-icons-sharp' }, activeStageDefinition.icon || 'hub')
                        ),
                        h('div', { className: 'placeholder-content' },
                            h('p', { className: 'placeholder-label' }, 'MiniApp'),
                            h('h2', { className: 'placeholder-title' }, activeStageDefinition.title),
                            h('p', { className: 'placeholder-description' }, activeStageDefinition.description)
                        )
                    )
                );

            return h(
                'div',
                { className: 'app-shell min-h-screen bg-slate-50 pb-32 flex flex-col' },
                h(HeaderComponent, {
                    title: activeStageDefinition.title,
                    icon: activeStageDefinition.icon,
                    hideSearch: true
                }),
                h('main', {
                    className: 'app-main app-stage flex-1 w-full',
                    style: { paddingBottom: '140px' }
                }, mainContent),
                h(FooterComponent, {
                    activeTab: activeStageKey,
                    variant: 'full',
                    state: footerState,
                    onNavigate: handleNavigate,
                    onStateChange: handleFooterStateChange,
                    showSettings: true,
                    showMeta: true
                })
            );
        }

        const rootElement = document.getElementById('root');
        ReactDOM.createRoot(rootElement).render(h(App));
    </script>
</body>
</html>
