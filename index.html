<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App 5 Horas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200" rel="stylesheet"/>
    <style>
        /* Variáveis de Tema (Claro é o padrão) */
        :root, html {
            --page-bg: 248 250 252; /* Slate-50 Light */
            --page-bg-alpha: 0.96;
            --page-fg: 15 23 42; /* Slate-900 Dark */
            --page-fg-muted: 71 85 105; /* Slate-600 */
            --page-border: 15 23 42; /* Slate-900 */
            color-scheme: light;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        }
        
        [data-theme="dark"] {
            --page-bg: 15 23 42; /* Slate-900 Dark */
            --page-bg-alpha: 1; /* Opacidade total para fundo sólido */
            --page-fg: 248 250 252; /* Slate-50 Light */
            --page-fg-muted: 156 163 175; /* Gray-400 */
            --page-border: 248 250 252; /* Slate-50 Light */
            color-scheme: dark;
        }

        body {
            min-height: 100vh;
            background-color: rgb(var(--page-bg) / var(--page-bg-alpha));
            color: rgb(var(--page-fg));
            transition: background-color 0.3s, color 0.3s;
        }
        .mini-app-portfolio { 
            --card-border-width: 2px;
        }
        .mini-app-card-base {
            width: 200px; 
            max-width: 200px;
            min-width: 180px;
            aspect-ratio: 4/3;
            border-style: solid;
            border-width: var(--card-border-width);
        }
        .status-pending {
            opacity: 0.45;
            cursor: default;
            pointer-events: none;
            transform: none !important;
            box-shadow: none !important;
        }
        .mini-app-card-base.selected {
            border-width: 3px !important;
            box-shadow: 0 0 0 4px rgb(var(--page-bg)), 0 0 0 6px var(--selection-color) !important;
        }
        #action-modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #action-modal.hidden #action-modal-content {
            transform: scale(0.95);
            opacity: 0;
        }
        #action-modal:not(.hidden) #action-modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .mini-app-card-base .icon-large {
            font-size: 5rem;
        }
        .tab-content.hidden{display:none;}
        .tab-button {
            border-radius: 0.75rem;
            transition: all 150ms ease;
            padding-top: 0.4rem;
            padding-bottom: 0.4rem;
            color: rgb(var(--page-fg-muted));
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 21px;
            width: 21px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #8B5CF6;
        }
        input:checked + .slider:before {
            transform: translateX(25px);
        }
        @keyframes roll-in-up {
            0% { transform: translateY(100%); opacity: 0; }
            5% { opacity: 1; }
            100% { transform: translateY(0%); opacity: 1; }
        }
        .toast-message-roll-mask {
            height: 1.25rem;
            overflow: hidden;
        }
        .toast-message-roll-wrapper {
            display: inline-block;
            animation: roll-in-up 400ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-origin: bottom; 
        }

        /* 5. Impedir Giro (Aviso CSS) */
        @media screen and (orientation: landscape) and (max-width: 500px) {
            #app-container, header, main, .fab-container {
                display: none;
            }
            body::before {
                content: "Gire o dispositivo para a posição vertical (retrato).";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgb(var(--page-bg));
                color: rgb(var(--page-fg));
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.25rem;
                z-index: 9999;
                text-align: center;
                padding: 20px;
            }
        }

        /* 3. Cards em Lista para Mobile */
        @media (max-width: 500px) {
             .card-grid-container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        }
        /* 4. Telas Sobrepostas (Modal com Afastamento) */
        @media (max-width: 500px) {
            .mobile-modal-overlay {
                padding: 1rem; /* Afastamento de 16px */
            }
            .mobile-modal-content {
                max-width: 100%;
                height: auto;
                max-height: calc(100vh - 2rem); /* Altura máxima com afastamento */
                margin-top: auto; /* Ancorar na parte inferior (opcional, mas limpa) */
                margin-bottom: auto;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
    </div>
    <script>
        const USER_KEY="app5-user-data";let userData={};let appState={currentScreen:'catalog',isModalOpen:false,modalContent:{title:'',id:'',color:'pink'},isUserPanelOpen:false,isAccessibilityPanelOpen:false,isNotificationPanelOpen:false,colorMap:{pink:{base:'pink-500',rgb:'236 72 153',icon:'pink-500/30',label:'Rosa'},emerald:{base:'emerald-500',rgb:'16 185 129',icon:'emerald-500/30',label:'Verde Esmeralda'},cyan:{base:'cyan-500',rgb:'6 182 212',icon:'cyan-500/30',label:'Ciano'},amber:{base:'amber-500',rgb:'245 158 11',icon:'amber-500/30',label:'Âmbar'},violet:{base:'violet-500',rgb:'139 92 246',icon:'violet-500/30',label:'Violeta'},sky:{base:'sky-500',rgb:'14 165 233',icon:'sky-500/30',label:'Sky'},red:{base:'red-500',rgb:'239 68 68',icon:'red-500/30',label:'Vermelho'}},SCREENS:{CATALOG:'catalog',PERSONA_SELECTION:'persona-selection',STUDENT_MENU:'student-menu'},tabs:[{id:'data',label:'Dados do Usuário',title:'Central do Usuário',subtitle:'Gerencie seus dados e o comportamento do sistema.',base:'emerald-500',icon:'badge'},{id:'prefs',label:'Preferências',title:'Preferências',subtitle:'Configurações que controlam a aparência do sistema.',base:'sky-500',icon:'settings'},{id:'security',label:'Segurança',title:'Segurança',subtitle:'Ações permanentes e críticas do sistema.',base:'red-500',icon:'lock'}],currentPanelTab:'data'};
        function loadUserData(){try{const raw=localStorage.getItem(USER_KEY);const data=raw?JSON.parse(raw):{};userData={...data,themePref:data.themePref||'light',showAccessibilityFab:data.showAccessibilityFab===undefined?true:data.showAccessibilityFab,showNotificationFab:data.showNotificationFab===undefined?true:data.showNotificationFab,persona:data.persona||'aluno',uniqueId:data.uniqueId||'',cep:data.cep||'',birthDate:data.birthDate||'',country:data.country||'Brasil',hasSeenIntroToasts:data.hasSeenIntroToasts===undefined?false:data.hasSeenIntroToasts,confirmedAlertsIds:data.confirmedAlertsIds||[]};if (userData.country === 'Brasil' && (!userData.phone || userData.phone.replace(/\D/g, '').length === 0)) {userData.phone = '55';}}catch(e){userData={themePref:'light',showAccessibilityFab:true,showNotificationFab:true,persona:'aluno',uniqueId:'',cep:'',birthDate:'',country:'Brasil',hasSeenIntroToasts:false,confirmedAlertsIds:[]};}}
        function saveUserData(){try{localStorage.setItem(USER_KEY,JSON.stringify(userData));}catch(e){}}
        function updateUserData(key,value){userData[key]=value;userData.updated=new Date().toISOString();saveUserData();renderApp();}
        function clearUserData(){userData={themePref:'light',showAccessibilityFab:true,showNotificationFab:true,persona:'aluno',uniqueId:'',cep:'',birthDate:'',country:'Brasil',hasSeenIntroToasts:false,confirmedAlertsIds:[]};try{localStorage.removeItem(USER_KEY);}catch(e){}}
        function setAppState(newState){Object.assign(appState,newState);renderApp();}
        function setAppTheme(theme){if(theme!=='light'&&theme!=='dark')return;document.documentElement.setAttribute('data-theme',theme);updateUserData('themePref',theme);}
        const createPhoneMask=()=>{let autoCC=false;return(value)=>{let n=(value||"").replace(/\D/g,"");if(!autoCC&&n.length>=2&&!n.startsWith("55")){n="55"+n;autoCC=true;}if(n.length<=2)return"+"+n;if(n.length<=4)return"+"+n.slice(0,2)+" "+n.slice(2);if(n.length<=9){let cc=n.slice(0,2);let ddd=n.slice(2,4);let f=n.slice(4);return"+"+cc+" "+ddd+" "+f;}let cc2=n.slice(0,2);let ddd2=n.slice(2,4);let first=n.length===10?n.slice(4,8):n.slice(4,9);let last=n.slice(-4);return"+"+cc2+" "+ddd2+" "+first+"-"+last;};};
        const maskPhone=createPhoneMask();
        const maskCEP=(value)=>{const n=(value||"").replace(/\D/g,"").slice(0,8);if(n.length>5){return n.replace(/^(\d{5})(\d{0,3})$/,'$1-$2');}return n;};
        const maskBirthDate=(value)=>{const n=(value||"").replace(/\D/g,"").slice(0,8);if(n.length>4){return n.replace(/^(\d{2})(\d{2})(\d{0,4})$/,'$1/$2/$3');}else if(n.length>2){return n.replace(/^(\d{2})(\d{0,2})$/,'$1/$2');}return n;};
        function getPersonaLabel(personaId){const labels={'aluno':'Aluno','tutor':'Tutor/Responsável','professor':'Professor','instituicao':'Instituição','administrador':'Administrador','tecnico':'Técnico'};return labels[personaId]||'Usuário';}
        function getColorStyle(color){return appState.colorMap[color]||appState.colorMap.pink;}
        function renderMiniAppCard(app){const isPending=app.status!=='Ativo';const colorStyle=getColorStyle(app.color);const borderClass=`border-${colorStyle.base}/80`;const bgClass=`bg-${colorStyle.base}/10`;const textClass=`text-${colorStyle.base}/90`;const iconClass=`text-${colorStyle.icon}`;const indicatorClasses=isPending?'opacity-100':'opacity-0 pointer-events-none';const indicatorBg=isPending?'bg-amber-500/70 border-amber-600/80 text-white':'';const selectedClass=app.id===userData.persona?'selected':'';const pendingClass=isPending?'status-pending':'';const cardClasses=`mini-app-card-base backdrop-blur-sm ${borderClass} ${bgClass} p-5 rounded-3xl overflow-hidden flex flex-col relative transition-all hover:translate-y-[-0.5rem] hover:shadow-lg ${selectedClass} ${pendingClass}`;const customStyle=`--selection-color: rgb(${colorStyle.rgb});`;const dataEvent=`data-app-id="${app.id}" data-app-type="${app.type||'app'}" data-app-color="${app.color}" data-app-label="${app.label}" data-app-status="${app.status}"`;
        // 1. Título Abaixo do Ícone
        return`<a href="#" class="${cardClasses}" style="${customStyle}" ${dataEvent}><div class="absolute top-3 right-3 z-20 transition-opacity duration-300 ${indicatorClasses}"><span class="inline-flex items-center rounded-full px-1.5 py-0.25 text-[0.55rem] font-semibold border-2 ${indicatorBg}">${app.status}</span></div><div class="absolute inset-x-0 top-0 h-3/5 flex items-center justify-center pointer-events-none select-none"><span class="material-symbols-rounded leading-none ${iconClass} icon-large">${app.icon}</span></div><div class="mt-auto relative z-10 flex flex-col items-center justify-end pb-2"><h2 class="font-semibold text-lg leading-tight ${textClass} text-center">${app.label}</h2></div></a>`;}
        function renderContainer(icon,label,color){const colorStyle=getColorStyle(color);return`<div class="p-4 rounded-xl border-2 border-${colorStyle.base}/50 bg-${colorStyle.base}/10 text-center flex flex-col items-center justify-center min-h-[120px] cursor-pointer transition duration-200 hover:shadow-lg hover:ring-2 hover:ring-${colorStyle.base}/50 hover:scale-[1.01]" role="button" aria-label="${label}"><span class="material-symbols-rounded text-3xl text-${colorStyle.base}-400">${icon}</span><p class="font-medium text-base text-${colorStyle.base}-300 mt-2">${label}</p></div>`;}
        function renderProductContent(actionId){if(actionId==='simulados'){return`<div class="space-y-6"><h3 class="text-xl font-bold text-[rgb(var(--page-fg))]">Menu Principal do Produto: Simulados e Provas</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 rounded-xl border-2 border-white/10 bg-white/5 h-[200px]">${renderContainer("play_circle","Novo Simulado","pink")}${renderContainer("bar_chart","Resultados","cyan")}${renderContainer("assignment","Histórico de Provas","violet")}${renderContainer("trophy","Metas e Ranking","emerald")}</div></div>`;}if(actionId==='notas'){return`<div class="space-y-6"><h3 class="text-xl font-bold text-[rgb(var(--page-fg))]">Menu Principal do Produto: Notas e Frequência</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 rounded-xl border-2 border-white/10 bg-white/5 h-[200px]">${renderContainer("format_list_numbered","Boletim Completo","cyan")}${renderContainer("person_check","Taxa de Presença","pink")}${renderContainer("trending_up","Gráfico de Médias","amber")}${renderContainer("warning","Alertas de Notas","red")}</div></div>`;}return`<div class="p-4 text-center"><p class="text-lg text-white/80 animate-pulse">O conteúdo para esta ação (${actionId}) ainda não foi implementado.</p></div>`;}
        function renderCatalogScreen(){const apps=[{id:'educacao',label:'Educação',icon:'cast_for_education',color:'pink',status:'Ativo',type:'app'},{id:'financeiro',label:'Financeiro',icon:'account_balance',color:'emerald',status:'Em breve',type:'app'},{id:'saude',label:'Saúde',icon:'health_and_safety',color:'sky',status:'Em breve',type:'app'},{id:'agenda',label:'Agenda',icon:'calendar_month',color:'amber',status:'Em breve',type:'app'},];const appCards=apps.map(renderMiniAppCard).join('');
        // 3. Cards em Lista (Mobile)
        return`<section id="screen-catalog" data-screen-id="${appState.SCREENS.CATALOG}" class="mini-app-portfolio mt-8"><div class="card-grid-container grid grid-cols-2 gap-8 max-w-md mx-auto">${appCards}</div></section>`;}
        function renderPersonaSelectionScreen(){const personas=[{id:'aluno',label:'Aluno',icon:'school',color:'pink',status:'Ativo',type:'persona'},{id:'tutor',label:'Tutor/Responsável',icon:'person_raised_hand',color:'cyan',status:'Em breve',type:'persona'},{id:'professor',label:'Professor',icon:'local_library',color:'violet',status:'Em breve',type:'persona'},{id:'instituicao',label:'Instituição',icon:'corporate_fare',color:'emerald',status:'Em breve',type:'persona'},];const personaCards=personas.map(p=>renderMiniAppCard({...p,selected:p.id===userData.persona})).join('');
        // 3. Cards em Lista (Mobile)
        return`<section id="screen-persona" data-screen-id="${appState.SCREENS.PERSONA_SELECTION}" class="mini-app-portfolio mt-8"><div class="card-grid-container grid grid-cols-2 gap-8 max-w-md mx-auto">${personaCards}</div></section>`;}
        function renderStudentMenuScreen(){const studentActions=[{id:'simulados',label:'Simulados e Provas',icon:'quiz',color:'pink',status:'Ativo',type:'action'},{id:'notas',label:'Notas e Frequência',icon:'rate_review',color:'cyan',status:'Ativo',type:'action'},{id:'agenda',label:'Agenda e Tarefas',icon:'calendar_today',color:'amber',status:'Em breve',type:'action'},{id:'conteudo',label:'Conteúdo de Estudo',icon:'book_4',color:'violet',status:'Em breve',type:'action'},];const actionCards=studentActions.map(renderMiniAppCard).join('');
        // 3. Cards em Lista (Mobile)
        return`<section id="screen-aluno" data-screen-id="${appState.SCREENS.STUDENT_MENU}" class="mini-app-portfolio mt-8"><div class="card-grid-container grid grid-cols-2 gap-8 max-w-md mx-auto">${actionCards}</div></section>`;}
        function getStatusText(isCleared=false){if(isCleared)return{text:'Dados removidos e tema redefinido.',tone:'error'};const isDataFilled=!!userData.name||!!userData.email||!!userData.phone;return isDataFilled?{text:'',tone:'ok'}:{text:'',tone:'warn'};}
        function renderUserPanelModal(){if(!appState.isUserPanelOpen)return'';const activeTab=appState.tabs.find(t=>t.id===appState.currentPanelTab);const activeColorClasses=activeTab?{base:activeTab.base,border:`border-${activeTab.base}/70`,bg:`bg-${activeTab.base}/15`}:{};const statusMessage=getStatusText();const showFab=userData.showAccessibilityFab??true;const showAlertFab=userData.showNotificationFab??true;const closeButtonBase="inline-flex h-10 items-center gap-1 rounded-full p-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const closeIconClasses="material-symbols-rounded text-lg text-cyan-500 group-hover:text-cyan-700";const closeTextClasses="text-[rgb(var(--page-fg-muted))] text-sm font-medium";const userPersonaOptions=[{id:'aluno',label:'Aluno'},{id:'tutor',label:'Tutor/Responsável'},{id:'professor',label:'Professor'},{id:'instituicao',label:'Instituição'},{id:'administrador',label:'Administrador'},{id:'tecnico',label:'Técnico'},];let tabContents='';const tabDataContent=`<form id="user-form" class="space-y-4 text-sm"><div><label for="user-name" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">person</span>Nome completo</label><input id="user-name" name="name" type="text" value="${userData.name||''}" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" placeholder="Seu nome e sobrenome" required/></div><div class="grid grid-cols-2 gap-4"><div><label for="user-birthDate" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">cake</span>Data de Nascimento</label><input id="user-birthDate" name="birthDate" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="10" value="${maskBirthDate(userData.birthDate)}" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" placeholder="DD/MM/AAAA" required/></div><div><label for="user-country" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">public</span>País</label><select id="user-country" name="country" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" required><option value="Brasil" ${userData.country==='Brasil'?'selected':''}>Brasil</option><option value="Outro" ${userData.country==='Outro'?'selected':''}>Outro (Especifique)</option></select></div></div><div class="grid grid-cols-2 gap-4"><div><label for="user-persona" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">badge</span>Categoria</label><select id="user-persona" name="persona" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" required>${userPersonaOptions.map(p => `<option value="${p.id}" ${userData.persona === p.id ? 'selected' : ''}>${p.label}</option>`).join('')}</select></div><div><label for="user-id" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">key</span>ID Único</label><input id="user-id" name="uniqueId" type="text" value="${userData.uniqueId||''}" readonly class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))] bg-gray-100/50 cursor-default" placeholder="A ser definido" /></div></div><div class="grid grid-cols-2 gap-4"><div><label for="user-phone" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">phone</span>Telefone (WhatsApp)</label><input id="user-phone" name="phone" type="tel" inputmode="tel" value="${maskPhone(userData.phone)}" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" placeholder="+55 DDD número" required/></div><div><label for="user-cep" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">location_on</span>CEP</label><input id="user-cep" name="cep" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="9" value="${maskCEP(userData.cep)}" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" placeholder="00000-000" required/></div></div><div><label for="user-email" class="block text-xs font-medium mb-1 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base} mr-1">mail</span>E-mail</label><input id="user-email" name="email" type="email" value="${userData.email||''}" class="w-full rounded-xl border-2 border-${activeColorClasses.base}/40 bg-white/70 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-${activeColorClasses.base}/80 focus:border-transparent text-[rgb(var(--page-fg))]" placeholder="seuemail@exemplo.com" required/></div></form>`;const tabPrefsContent=`<div class="space-y-4 pt-1"><div class="p-3 rounded-xl border border-sky-300/70 bg-sky-500/5 transition duration-150 ease-in-out hover:shadow-md"><div class="flex justify-between items-center"><div class="flex flex-col"><h3 class="font-semibold text-base text-sky-700 flex items-center"><span class="material-symbols-rounded text-lg text-sky-500 align-middle mr-2">contrast</span>Customização de Tema</h3><p class="mt-1 text-xs text-[rgb(var(--page-fg))] opacity-80">Alterne entre o modo Claro e Escuro.</p></div><div class="flex gap-2"><button type="button" onclick="setAppTheme('light')" class="px-3 py-1 rounded-full text-sm font-medium transition ${userData.themePref==='light'?'bg-sky-500 text-white':'bg-white text-sky-700 hover:bg-sky-100'}" aria-pressed="${userData.themePref==='light'}"><span class="material-symbols-rounded text-base">light_mode</span> Claro</button><button type="button" onclick="setAppTheme('dark')" class="px-3 py-1 rounded-full text-sm font-medium transition ${userData.themePref==='dark'?'bg-sky-700 text-white':'bg-white text-sky-700 hover:bg-sky-100'}" aria-pressed="${userData.themePref==='dark'}"><span class="material-symbols-rounded text-base">dark_mode</span> Escuro</button></div></div></div><div class="p-3 rounded-xl border border-amber-300/70 bg-amber-500/5 transition duration-150 ease-in-out hover:shadow-md"><div class="flex justify-between items-center"><div class="flex flex-col"><h3 class="font-semibold text-base text-amber-700 flex items-center"><span class="material-symbols-rounded text-lg text-amber-500 align-middle mr-2">notifications</span>Botão de Avisos (FAB)</h3><p class="mt-1 text-xs text-[rgb(var(--page-fg))] opacity-80">Exibe o botão flutuante de Avisos no canto inferior esquerdo.</p></div><label class="toggle-switch ml-4 flex-shrink-0"><input type="checkbox" id="alert-fab-toggle" ${showAlertFab?'checked':''} onclick="handleToggle('showNotificationFab', event)" aria-label="Ativar/desativar botão de avisos"/><span class="slider"></span></label></div></div><div class="p-3 rounded-xl border border-violet-300/70 bg-violet-500/5 transition duration-150 ease-in-out hover:shadow-md"><div class="flex justify-between items-center"><div class="flex flex-col"><h3 class="font-semibold text-base text-violet-700 flex items-center"><span class="material-symbols-rounded text-lg text-violet-500 align-middle mr-2">accessibility_new</span>Botão de Acessibilidade (FAB)</h3><p class="mt-1 text-xs text-[rgb(var(--page-fg))] opacity-80">Exibe o botão flutuante de Acessibilidade no canto inferior esquerdo.</p></div><label class="toggle-switch ml-4 flex-shrink-0"><input type="checkbox" id="fab-toggle" ${showFab?'checked':''} onclick="handleToggle('showAccessibilityFab', event)" aria-label="Ativar/desativar botão de acessibilidade"/><span class="slider"></span></label></div></div></div>`;const tabSecurityContent=`<div class="space-y-4"><h3 class="text-sm font-semibold text-${activeColorClasses.base}/90 flex items-center"><span class="material-symbols-rounded text-base text-${activeColorClasses.base}/90 mr-1">warning</span>Exclusão de Dados</h3 ><p class="text-sm text-[rgb(var(--page-fg))] opacity-90">Esta ação removerá todos os seus dados (Nome, E-mail, Telefone, e Preferências de Tema) salvos **apenas neste dispositivo** (memória local). Esta ação é permanente e irreversível.</p><div class="mt-6 flex justify-end"><button id="user-delete-btn" type="button" onclick="handleClearData()" class="inline-flex h-10 items-center gap-2 rounded-full p-2 transition focus:outline-none focus:ring-2 focus:ring-red-300/40 hover:bg-red-500/10 group" aria-label="Remover dados"><span class="material-symbols-rounded text-lg text-red-500 group-hover:text-red-700">delete</span><span class="text-red-500 group-hover:text-red-700 text-sm font-medium">Remover dados permanentemente</span></button></div></div>`;appState.tabs.forEach(tab=>{let content='';if(tab.id==='data')content=tabDataContent;if(tab.id==='prefs')content=tabPrefsContent;if(tab.id==='security')content=tabSecurityContent;const hiddenClass=appState.currentPanelTab!==tab.id?'hidden':'';tabContents+=`<div id="tab-${tab.id}" class="tab-content border-2 ${activeColorClasses.border} bg-${activeColorClasses.base}/10 rounded-2xl p-4 absolute top-0 left-0 w-full ${hiddenClass}">${content}</div>`;});return`<div id="user-panel" class="fixed inset-0 z-40 items-center justify-center bg-black/60 backdrop-blur-sm flex mobile-modal-overlay" aria-modal="true" role="dialog" onclick="setAppState({isUserPanelOpen:false})"><div class="mx-4 w-full max-w-md max-h-full overflow-y-auto rounded-3xl border-2 ${activeColorClasses.border} bg-[rgb(var(--page-bg))] bg-opacity-95 p-5 shadow-xl mobile-modal-content" onclick="event.stopPropagation()"><div class="flex items-start justify-between gap-3"><div id="panel-title-container"><h2 id="panel-title" class="text-base sm:text-lg font-semibold">${activeTab.title}</h2><p id="panel-subtitle" class="mt-1 text-xs sm:text-[0.75rem] text-[rgb(var(--page-fg-muted))]">${activeTab.subtitle}</p></div><button id="user-close" type="button" onclick="setAppState({isUserPanelOpen:false,currentPanelTab:'data'})" class="${closeButtonBase} ${closeTextClasses} px-3" aria-label="Fechar painel do usuário"><span class="${closeIconClasses}">close</span><span class="hidden sm:inline">Fechar</span></button></div><div id="tab-header" class="flex gap-2 mt-4 mb-4 pb-1">${appState.tabs.map(tab=>{const isCurrent=appState.currentPanelTab===tab.id;const tabBase=tab.base;const activeClasses=isCurrent?`border-b-2 text-${tabBase}/90 bg-${tabBase}/10 font-bold`:'border-b-2 border-transparent hover:border-[rgb(var(--page-fg-muted))] hover:hover:text-[rgb(var(--page-fg))]';const iconColorClass=`text-${tabBase}/80`;return`<button key="${tab.id}" data-tab-id="${tab.id}" class="tab-button inline-flex items-center px-3 text-sm transition focus:outline-none gap-1 ${activeClasses}" onclick="setAppState({currentPanelTab:'${tab.id}'})"><span class="material-symbols-rounded text-base ${iconColorClass}">${tab.icon}</span>${tab.label}</button>`;}).join('')}</div><div class="relative mt-3 min-h-[420px]">${tabContents}</div><div id="panel-status-footer" class="mt-4 pt-3"><p id="user-status-text" class="text-[0.8rem] text-center ${statusMessage.tone==='ok'?'text-emerald-600':statusMessage.tone==='error'?'text-red-500':'text-amber-500'}">${statusMessage.text}</p></div></div></div>`;}
        function renderAccessibilityPanelModal(){if(!appState.isAccessibilityPanelOpen)return'';const title='Acessibilidade e Ajuda';const subtitle='Painel de Configurações do App 5 Horas.';const colorBase='violet-500';const icon='accessibility_new';const colorClasses={border:`border-${colorBase}/70`,};const accessibilityActions=[{label:'Alto Contraste',icon:'contrast',color:'cyan'},{label:'Ajuste de Fonte',icon:'text_fields',color:'emerald'},{label:'Leitura de Tela',icon:'volume_up',color:'pink'},{label:'Comandos de Voz',icon:'mic',color:'amber'},];const closeButtonBase="inline-flex h-10 items-center gap-1 rounded-full p-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const closeIconClasses="material-symbols-rounded text-lg text-cyan-500 group-hover:text-cyan-700";const closeTextClasses="text-[rgb(var(--page-fg-muted))] text-sm font-medium";const actionCards=accessibilityActions.map(action=>renderContainer(action.icon,action.label,action.color)).join('');return`<div id="accessibility-panel" class="fixed inset-0 z-40 items-center justify-center bg-black/60 backdrop-blur-sm flex mobile-modal-overlay" aria-modal="true" role="dialog" onclick="setAppState({isAccessibilityPanelOpen:false})"><div class="mx-4 w-full max-w-md max-h-full overflow-y-auto rounded-3xl border-2 ${colorClasses.border} bg-[rgb(var(--page-bg))] bg-opacity-95 p-5 shadow-xl mobile-modal-content" onclick="event.stopPropagation()"><div class="flex items-start justify-between gap-3 pb-4 mb-4"><div id="panel-title-container"><div class="flex items-center mb-1"><span class="material-symbols-rounded text-lg text-${colorBase} mr-2">${icon}</span><h2 id="panel-title" class="text-base sm:text-lg font-semibold">${title}</h2></div><p id="panel-subtitle" class="mt-1 text-xs sm:text-[0.75rem] text-[rgb(var(--page-fg-muted))]">${subtitle}</p></div><button id="help-close" type="button" onclick="setAppState({isAccessibilityPanelOpen:false})" class="${closeButtonBase} ${closeTextClasses} px-3" aria-label="Fechar painel de acessibilidade"><span class="${closeIconClasses}">close</span><span class="hidden sm:inline">Fechar</span></button></div><div class="relative mt-3 space-y-6"><div class="space-y-3"><h3 class="text-base font-semibold text-[rgb(var(--page-fg))] flex items-center gap-2 mb-3"><span class="material-symbols-rounded text-lg text-violet-500">settings_accessibility</span>Ferramentas de Customização (Em breve)</h3><div class="grid grid-cols-2 gap-3">${actionCards}</div></div></div></div></div>`;}
        function renderNotificationPanelModal(){if(!appState.isNotificationPanelOpen)return'';const title='Avisos e Notificações';const subtitle='Central de status e alertas da aplicação.';const colorBase='amber-500';const icon='notifications';const colorClasses={border:`border-${colorBase}/70`,};const closeButtonBase="inline-flex h-10 items-center gap-1 rounded-full p-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const closeIconClasses="material-symbols-rounded text-lg text-cyan-500 group-hover:text-cyan-700";const closeTextClasses="text-[rgb(var(--page-fg-muted))] text-sm font-medium";const alerts=[{id:'aviso_empresa',title:'Aviso da Empresa',message:'Produto desenvolvido pela App 5 Horas - Soluções Digitais.',color:'cyan',isSpecial:false,icon:'rocket_launch'},{id:'dica_educacao',title:'Dica de Navegação',message:'Clique em Educação para iniciar sua jornada.',color:'amber',isSpecial:false,icon:'info'},{id:'beta_test',title:'Beta: Feedback',message:'Este app está em fase Beta. Envie feedback para ajudar no desenvolvimento.',color:'red',isSpecial:false,icon:'bug_report'},];const noticeCards=alerts.filter(alert=>!userData.confirmedAlertsIds.includes(alert.id)).map(alert=>{const colorStyle=getColorStyle(alert.color);const isConfirmed=userData.confirmedAlertsIds.includes(alert.id);const checkIcon=alert.icon;const cardBodyClasses=`p-4 rounded-xl border-2 border-${colorStyle.base}/50 bg-${colorStyle.base}/10 text-left transition duration-300`;const actionButton=isConfirmed?'':`<button type="button" onclick="confirmAlert('${alert.id}')" class="flex-shrink-0 p-2 rounded-full transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-emerald-300/50 hover:bg-emerald-100/50" aria-label="Marcar como lido" title="Marcar como lido"><span class="material-symbols-rounded text-xl text-emerald-600">done_all</span></button>`;return`<div class="space-y-3"><h3 class="text-base font-semibold text-[rgb(var(--page-fg))] flex items-center gap-2"><span class="material-symbols-rounded text-lg text-${colorStyle.base}">${checkIcon}</span>${alert.title}${isConfirmed?' (Lido)':''}</h3><div class="${cardBodyClasses}"><div class="flex justify-between items-start gap-4"><p class="text-sm opacity-90 leading-relaxed text-[rgb(var(--page-fg))]">${alert.message}</p>${actionButton}</div></div></div>`;}).join('');return`<div id="notification-panel" class="fixed inset-0 z-40 items-center justify-center bg-black/60 backdrop-blur-sm flex mobile-modal-overlay" aria-modal="true" role="dialog" onclick="setAppState({isNotificationPanelOpen:false})"><div class="mx-4 w-full max-w-md max-h-full overflow-y-auto rounded-3xl border-2 ${colorClasses.border} bg-[rgb(var(--page-bg))] bg-opacity-95 p-5 shadow-xl mobile-modal-content" onclick="event.stopPropagation()"><div class="flex items-start justify-between gap-3 pb-4 mb-4"><div id="panel-title-container"><div class="flex items-center mb-1"><span class="material-symbols-rounded text-lg text-${colorBase} mr-2">${icon}</span><h2 id="panel-title" class="text-base sm:text-lg font-semibold">${title}</h2></div><p id="panel-subtitle" class="mt-1 text-xs sm:text-[0.75rem] text-[rgb(var(--page-fg-muted))]">${subtitle}</p></div><button id="alert-close" type="button" onclick="setAppState({isNotificationPanelOpen:false})" class="${closeButtonBase} ${closeTextClasses} px-3" aria-label="Fechar painel de notificações"><span class="${closeIconClasses}">close</span><span class="hidden sm:inline">Fechar</span></button></div><div class="relative mt-3 space-y-6">${noticeCards}</div></div></div>`;}
        function renderAlertFAB(){if(!userData.showNotificationFab)return'';const unreadAlertCount=3-userData.confirmedAlertsIds.length;const isActive=unreadAlertCount>0;const activeClasses="bg-amber-500 hover:bg-amber-600 text-white shadow-lg shadow-amber-500/50";const inactiveClasses="bg-transparent hover:bg-amber-500/10 text-amber-500 border-2 border-amber-300/60 shadow-none";const fabClasses=`fixed bottom-16 left-4 z-40 w-10 h-10 rounded-full transition-all duration-300 flex items-center justify-center focus:outline-none focus:ring-4 focus:ring-amber-300/50 ${isActive?activeClasses:inactiveClasses}`;const iconClass=isActive?"text-white":"text-amber-500";const ariaLabel=`Abrir Painel de Avisos. ${unreadAlertCount>0?`Você tem ${unreadAlertCount} avisos novos.`:''}`;const badge=isActive?`<span class="absolute top-0 right-0 transform translate-x-1/4 -translate-y-1/4 inline-flex items-center justify-center w-5 h-5 text-xs font-bold leading-none text-white bg-red-600 rounded-full border-2 border-[rgb(var(--page-bg))]">${unreadAlertCount}</span>`:``;return`<button id="alert-fab" type="button" onclick="setAppState({isNotificationPanelOpen:true})" class="${fabClasses}" aria-label="${ariaLabel}"><span class="material-symbols-rounded text-xl ${iconClass}">notifications</span>${badge}</button>`;}
        function renderAccessibilityFAB(){if(!userData.showAccessibilityFab)return'';const colorClass="bg-violet-500 hover:bg-violet-600 text-white";const shadowClass="shadow-lg shadow-violet-500/50";return`<button id="accessibility-fab" type="button" onclick="setAppState({isAccessibilityPanelOpen:true})" class="fixed bottom-4 left-4 z-40 w-10 h-10 rounded-full transition-all duration-200 flex items-center justify-center ${colorClass} ${shadowClass} focus:outline-none focus:ring-4 focus:ring-violet-300/50" aria-label="Abrir Painel de Acessibilidade e Ajuda"><span class="material-symbols-rounded text-xl">accessibility_new</span></button>`;}
        function navigateTo(screen,personaId=null){if(personaId){updateUserData('persona',personaId);}if(screen===appState.SCREENS.PERSONA_SELECTION){updateUserData('persona',null);}setAppState({currentScreen:screen});}
        function handleBack(){const{SCREENS,currentScreen}=appState;if(currentScreen===SCREENS.STUDENT_MENU){updateUserData('persona',null);navigateTo(SCREENS.PERSONA_SELECTION);}else if(currentScreen===SCREENS.PERSONA_SELECTION){updateUserData('persona',null);navigateTo(SCREENS.CATALOG);}}
        function handleAppCardClick(e){e.preventDefault();const card=e.currentTarget;const status=card.getAttribute('data-app-status');const id=card.getAttribute('data-app-id');const type=card.getAttribute('data-app-type');const label=card.getAttribute('data-app-label');const color=card.getAttribute('data-app-color');if(status!=='Ativo'){return;}if(type==='app'){if(id==='educacao'){navigateTo(appState.SCREENS.PERSONA_SELECTION);}}else if(type==='persona'){if(id==='aluno'){navigateTo(appState.SCREENS.STUDENT_MENU,id);}}else if(type==='action'){setAppState({isModalOpen:true,modalContent:{title:label,id:id,color:color}});}}
        function handleToggle(key, event){const newValue=event.target.checked;updateUserData(key,newValue);}
        function handleClearData(){clearUserData();setAppState({isUserPanelOpen:false,currentPanelTab:'data'});}
        function handleFormChange(e){const{name,value}=e.target;let valueToSave=value;if(name==='cep'||name==='birthDate'){valueToSave=value.replace(/\D/g,'');}else if (name === 'phone') {valueToSave = value;}if (name === 'country') {const phoneInput = document.getElementById('user-phone');if (phoneInput) {let currentPhoneDigits = phoneInput.value.replace(/\D/g, '');if (value === 'Brasil') {if (!currentPhoneDigits.startsWith('55')) {let localNumber = currentPhoneDigits.length > 2 && !currentPhoneDigits.startsWith('55') ? currentPhoneDigits.substring(2) : currentPhoneDigits;currentPhoneDigits = '55' + localNumber.substring(0, 11);}} else {if (currentPhoneDigits.startsWith('55')) {currentPhoneDigits = currentPhoneDigits.substring(2);}}phoneInput.value = maskPhone(currentPhoneDigits.substring(0, 13));updateUserData('phone', phoneInput.value.trim());}updateUserData(name, valueToSave.trim());return;}updateUserData(name,valueToSave.trim());}
        function confirmAlert(alertId){let newConfirmedIds=[...userData.confirmedAlertsIds];if(!newConfirmedIds.includes(alertId)){newConfirmedIds.push(alertId);}updateUserData('confirmedAlertsIds',newConfirmedIds);}
        function renderHeader(){const personaLabel=getPersonaLabel(userData.persona);let title="Catálogo de Aplicações";let subtitle="Selecione o sistema que deseja acessar:";let showBackButton=false;let backText="Voltar";if(appState.currentScreen===appState.SCREENS.PERSONA_SELECTION){title="MiniApp: Educação";subtitle="Selecione seu perfil de acesso para customizar a experiência.";showBackButton=true;}else if(appState.currentScreen===appState.SCREENS.STUDENT_MENU){title=`Dashboard - ${personaLabel}`;subtitle="Selecione a funcionalidade que deseja acessar.";showBackButton=true;}const iconClasses="material-symbols-rounded text-2xl text-cyan-500";const userButtonBase="inline-flex h-10 items-center gap-1 rounded-full px-3 py-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const backButtonBase="inline-flex h-10 items-center gap-1 rounded-full px-3 py-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const iconHover="group-hover:text-cyan-700";const userLabel=personaLabel||"Usuário";const userLabelClasses="text-base font-medium text-[rgb(var(--page-fg))] group-hover:text-cyan-700 transition duration-200 hidden sm:inline";const backLabelClasses="text-base font-medium text-[rgb(var(--page-fg))] group-hover:text-cyan-700 transition duration-200 hidden sm:inline";return`<header class="fixed top-0 inset-x-0 z-30 px-4 pt-3 pb-2 bg-[rgb(var(--page-bg)/0.95)] backdrop-blur-sm"><div class="max-w-5xl mx-auto flex items-center justify-between h-14"><div class="flex items-center gap-1"><button id="back-btn" type="button" onclick="handleBack()" class="${backButtonBase} ${showBackButton?'opacity-100 pointer-events-auto':'opacity-0 pointer-events-none'}" aria-label="${backText}"><span class="${iconClasses} ${iconHover}">arrow_back</span><span class="${backLabelClasses}">${backText}</span></button></div><div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center w-full sm:max-w-xs transition-opacity duration-300"><div class="inline-flex items-center justify-center gap-2"><span class="material-symbols-rounded text-2xl text-cyan-500">apps</span><h1 class="text-2xl font-bold text-[rgb(var(--page-fg))] truncate max-w-full leading-none">${title}</h1></div></div><div class="flex items-center gap-2 ml-auto"><button id="user-btn" type="button" onclick="setAppState({isUserPanelOpen:true,showUserStatusToast:true})" class="${userButtonBase}" aria-label="Abrir painel do usuário"><span class="${iconClasses} ${iconHover}">account_circle</span><span class="${userLabelClasses}">${userLabel}</span></button></div></div></header><div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-2 text-center"><p class="text-sm sm:text-base text-[rgb(var(--page-fg-muted))]">${subtitle}</p></div>`;}
        function renderActionModal(){if(!appState.isModalOpen)return'';const{title,id,color}=appState.modalContent;const colorRgb=getColorStyle(color).rgb||'255 255 255';const borderStyle=`border-color: rgb(${colorRgb}/0.8);`;const closeButtonBase="inline-flex h-10 items-center gap-1 rounded-full p-2 transition focus:outline-none focus:ring-2 focus:ring-cyan-300/40 hover:bg-[rgb(var(--page-fg-muted)/0.1)] group";const closeIconClasses="material-symbols-rounded text-lg text-cyan-500 group-hover:text-cyan-700";const contentHTML=renderProductContent(id);return`<div id="action-modal" class="flex fixed inset-0 z-50 items-center justify-center bg-black/60 backdrop-blur-sm mobile-modal-overlay" aria-modal="true" role="dialog" onclick="setAppState({isModalOpen:false})"><div id="action-modal-content" class="mx-4 w-full overflow-y-auto rounded-3xl border-2 p-6 shadow-xl bg-[rgb(var(--page-bg))] bg-opacity-95 max-w-2xl mobile-modal-content" style="${borderStyle}" onclick="event.stopPropagation()"><div class="flex items-start justify-between gap-3 pb-4"><h2 id="action-modal-title" class="text-xl sm:text-2xl font-bold text-[rgb(var(--page-fg))]">${title}</h2><button type="button" onclick="setAppState({isModalOpen:false})" class="${closeButtonBase} h-7 w-7" aria-label="Fechar janela"><span class="${closeIconClasses}">close</span></button></div><div id="action-modal-body" class="mt-4 space-y-4">${contentHTML}</div></div></div>`;}
        function renderApp(){const appContainer=document.getElementById('app-container');if(!appContainer)return;let mainContent='';if(appState.currentScreen===appState.SCREENS.CATALOG){mainContent=renderCatalogScreen();}else if(appState.currentScreen===appState.SCREENS.PERSONA_SELECTION){mainContent=renderPersonaSelectionScreen();}else if(appState.currentScreen===appState.SCREENS.STUDENT_MENU){mainContent=renderStudentMenuScreen();}appContainer.innerHTML=`${renderHeader()}<main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10 pt-24">${mainContent}</main>${renderActionModal()}${renderUserPanelModal()}${renderAccessibilityPanelModal()}${renderNotificationPanelModal()}${renderAlertFAB()}${renderAccessibilityFAB()}`;attachEvents();}
        function attachEvents(){const cards=document.querySelectorAll('.mini-app-card-base');cards.forEach(card=>{card.removeEventListener('click',handleAppCardClick);card.addEventListener('click',handleAppCardClick);});if(appState.isUserPanelOpen){const formInputs=document.querySelectorAll('#user-form input,#user-form select');formInputs.forEach(input=>{input.removeEventListener('input',handleFormChange);input.removeEventListener('change',handleFormChange);input.addEventListener('input',(e)=>{if(e.target.name==='phone'){e.target.value=maskPhone(e.target.value);}else if(e.target.name==='cep'){e.target.value=maskCEP(e.target.value);}else if(e.target.name==='birthDate'){e.target.value=maskBirthDate(e.target.value);}handleFormChange(e);});if(input.tagName==='SELECT'){input.addEventListener('change',handleFormChange);}});}}
        function init(){loadUserData();setAppTheme(userData.themePref);renderApp();}
        document.addEventListener('DOMContentLoaded',init);
    </script>
</body>
</html>
