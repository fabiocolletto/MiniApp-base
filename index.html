<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniApps - Local & Cloud Backup</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Dexie.js para Banco de Dados Local -->
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200" rel="stylesheet"/>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400..700,0..1,-50..200');

        /* REMOÇÃO DE SVH/DVH: Usando unidades padrão de ecrã (vh/screen) */
        /* O h-screen é reintroduzido nos modais, e o body é deixado fluído */

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
            /* Garantir altura mínima para a cor de fundo funcionar */
            min-height: 100vh;
        }
        
        .dark body {
            background-color: #1f2937; 
            color: #f3f4f6; 
        }
        
        .card-base {
            position: relative;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            transition: all 300ms;
            border-width: 1px;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); 
            width: 7rem;
            height: 7rem;
            padding: 0.5rem; 
        }
        
        @media (min-width: 768px) {
            .card-base {
                width: 8rem;
                height: 8rem;
            }
        }
        
        .card-base:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateY(-0.25rem);
        }
        
        .app-grid-base-flexible { 
            display: grid; 
            gap: 1rem;
            width: 100%; 
            max-width: 1008px;
            grid-template-columns: repeat(auto-fit, 8rem); 
            justify-content: center;
            justify-items: center;
            padding: 0; 
        }

        @media (min-width: 768px) {
             .app-grid-base-flexible {
                gap: 4rem; 
                grid-template-columns: repeat(auto-fit, 8rem); 
            }
        }
        
        .chip-button {
            border-width: 1px;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .chip-button.no-shadow {
            box-shadow: none !important;
        }

        .chip-button:hover {
            box-shadow: 0 6px 10px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); 
        }
        .dark .chip-button.no-shadow:hover {
             box-shadow: none !important;
        }
        
        .accordion-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .menu-column-flow {
            flex-direction: column;
        }
    </style>
</head>
<body class="antialiased hide-scrollbar">
    <div id="root" class="flex flex-col min-h-screen">
        <div class="fixed inset-0 flex items-center justify-center bg-slate-100 text-gray-500">
            Carregando aplicação...
        </div>
    </div>

    <!-- SCRIPT AUXILIAR -->
    <script>
        var db = new Dexie("MiniAppsDB");
        db.version(2).stores({
            user: 'id, name, phone, school, email, createdAt', 
            logs: '++id, date, action, details',
            settings: 'key, value' 
        });

        window.prepareMiniAppHtml = function(htmlContent, appId, basePath) {
            let cleanHtml = htmlContent
                .replace(/<header[\s\S]*?<\/header>/gi, '') 
                .replace(/data-theme="dark"/g, 'data-theme="light"'); 

            var scriptTagOpen = '<script>';
            var scriptTagClose = '<' + '/script>'; 
            var styleTagOpen = '<style>';
            var styleTagClose = '<' + '/style>';
            var configScript = scriptTagOpen + 'window.__app_id = "' + appId + '";' + scriptTagClose;
            var baseTag = '<base href="' + basePath + '">';
            var styleCleanContent = 'html, body {padding-bottom: 120px !important; background: transparent !important;} main {box-shadow: none !important; border: none !important; background-color: transparent !important; padding: 1.5rem !important; margin: 0 !important;}';
            var styleClean = styleTagOpen + styleCleanContent + styleTagClose;

            if (cleanHtml.indexOf('<head>') !== -1) {
                return cleanHtml.replace('<head>', '<head>' + configScript + baseTag + styleClean);
            } else {
                return configScript + baseTag + styleClean + cleanHtml;
            }
        };
    </script>

    <!-- CÓDIGO REACT/BABEL -->
    <script type="text/babel">
    const { useState, useEffect, useCallback, useMemo, useRef } = React;

    const APP_ID = 'miniapps-app-id'; 
    const DEFAULT_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzcxdROcnZID-bkrmhZ7kPBz_2fcVWv8JQBsWiYIlz38n0IyRjHrrvz7YAX9iKhHCQopQ/exec";
    
    // --- DEFINIÇÕES DE DADOS HIERÁRQUICOS SIMPLIFICADAS PARA SUB-MENU ---
    
    // ALTERAÇÃO: Todos os itens do menu Aluno agora são 'placeholder' para ficarem inativos
    const STUDENT_MENU_ITEMS = [
        // Alterado de 'modal' para 'placeholder'
        { id: 'student-profile', title: "Perfil", action: 'placeholder', modalId: 'registration', url: 'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/student-registration.html', basePath: 'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/', color: "emerald", icon: "manage_accounts" },
        // Alterado de 'modal' para 'placeholder'
        { id: 'simulados', title: "Simulados", action: 'placeholder', modalId: 'simulados', url: 'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/simulados.html', basePath: 'https://cdn.jsdelivr.net/gh/fabiocolletto/miniapp@main/products/educacao/', color: "emerald", icon: "edit_note" },
        { id: 'provas', title: "Provas", action: 'placeholder', color: "emerald", icon: "assignment" }, 
        { id: 'agenda-aluno', title: "Agenda", action: 'placeholder', color: "emerald", icon: "event" },
    ];
    
    const EDUCATION_CATEGORIES = [
        { id: 'student', title: "Alunos", view: 'student-menu', color: "sky", icon: "person", submenu: STUDENT_MENU_ITEMS },
        { id: 'responsible', title: "Responsáveis", view: 'responsible-menu', color: "violet", icon: "diversity_3", action: 'placeholder' }, 
        { id: 'tutors', title: "Tutores", view: 'tutor-menu', color: "amber", icon: "supervisor_account", action: 'placeholder' }, 
        { id: 'institution', title: "Instituições", view: 'institution-menu', color: "purple", icon: "apartment", action: 'placeholder' }, 
    ];

    const MAIN_MENU_PORTFOLIO = [
        { id: 'menu-central', title: "Configurações", action: 'modal', modalId: 'central-menu-modal', color: "indigo", icon: "settings" },
        { id: 'notifications', title: "Notificações", action: 'modal', modalId: 'alerts-panel', color: "amber", icon: "notifications" },
        { id: 'education', title: "Educação", action: 'modal', modalId: 'education-menu-modal', color: "emerald", icon: "cast_for_education" },
        { id: 'finance', title: "Financeiro", action: 'placeholder', color: "lime", icon: "account_balance" }, 
        { id: 'health', title: "Saúde", action: 'placeholder', color: "sky", icon: "health_and_safety" }, 
        { id: 'tasks', title: "Tarefas", action: 'placeholder', color: "amber", icon: "calendar_month" }, 
    ];

    const VIEW_MAP = {
        'portfolio': { title: "Portfólio", data: MAIN_MENU_PORTFOLIO },
        'education-categories': { title: "Educação", data: EDUCATION_CATEGORIES, parent: 'portfolio' },
        'finance-menu': { title: "Finanças", data: [], parent: 'portfolio' }, 
        'health-menu': { title: "Saúde", data: [], parent: 'portfolio' }, 
        'tasks-menu': { title: "Tarefas", data: [], parent: 'portfolio' },
        'student-menu': { title: "Aluno", data: STUDENT_MENU_ITEMS, parent: 'education-categories' },
    };
    
    const SUB_MENU_MAP = {
        'portfolio-root': { title: 'Portfólio', items: MAIN_MENU_PORTFOLIO },
        'education-categories': { title: 'Educação', items: EDUCATION_CATEGORIES, parentId: 'portfolio-root' },
        'student-menu': { title: 'Aluno', items: STUDENT_MENU_ITEMS, parentId: 'education-categories' }
    };

    const AUTH_ITEM_CONFIG = {
        id: 'auth', 
        title: "Entrar/Cadastrar", 
        action: 'modal', 
        modalId: 'auth-modal',
        color: "purple", 
        icon: "lock_open" 
    };
    
    const initializeDarkMode = () => {
        return false;
    };


    // --- COMPONENTES AUXILIARES ---
    const CloseButton = ({ onClick, themeColor = "red" }) => {
        const colorClasses = `border-${themeColor}-500 bg-${themeColor}-100 text-${themeColor}-600 hover:bg-${themeColor}-200`;
        return (
            <button 
                onClick={onClick} 
                className={`absolute top-4 right-4 z-50 h-10 w-10 rounded-lg shadow-md border ${colorClasses} flex items-center justify-center transition-transform duration-200 hover:scale-110`}
                title="Fechar"
            >
                <span className="material-symbols-rounded text-xl">close</span>
            </button>
        );
    };

    const SectionTitle = ({ icon, title, color, isSubMenu = false, onBack }) => (
        <div className={`px-2 flex items-center mt-3 first:mt-0 ${isSubMenu ? 'pb-2 border-b border-indigo-200 mb-2' : ''}`}>
            {isSubMenu && (
                <button onClick={onBack} className="mr-2 p-1 rounded-full hover:bg-indigo-100 transition">
                     <span className={`material-symbols-rounded text-lg text-${color}-600`}>arrow_back</span>
                </button>
            )}
            <span className={`material-symbols-rounded text-lg mr-2 text-${color}-600`}>{icon}</span>
            <span className={`text-[11px] font-bold text-${color}-600 uppercase tracking-wider`}>{title}</span>
        </div>
    );
    
    const RenderNavButton = ({ item, color, onClickOverride }) => {
        const isLogicallyInactive = item.action === 'placeholder';
        const shouldShowInactiveStyle = isLogicallyInactive; 
        
        const isDisabled = isLogicallyInactive; 
        
        const themeColor = item.color || color;
        const visualColor = shouldShowInactiveStyle ? 'slate' : themeColor;
        
        const INACTIVE_CHIP_CLASS = `
            bg-slate-100 border-slate-300 text-slate-500 
            hover:bg-slate-100 hover:border-slate-400
        `;
        
        const ACTIVE_CHIP_CLASS = (c) => `
            chip-button w-full mb-1 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all 
            bg-${c}-50 border border-${c}-200 text-${c}-700 
            hover:bg-${c}-100 hover:border-${c}-300 hover:translate-x-1
        `;

        const classes = shouldShowInactiveStyle ? INACTIVE_CHIP_CLASS : ACTIVE_CHIP_CLASS(visualColor);
        
        const isSubMenuLink = item.action === 'submenu' || (item.submenu && item.submenu.length > 0);
        
        const handleClick = onClickOverride || (isDisabled ? () => {} : undefined); 
        
        const iconColorClass = isDisabled && shouldShowInactiveStyle ? 'text-slate-500' : `text-${visualColor}-600`; 
        const textColorClass = isDisabled && shouldShowInactiveStyle ? 'text-slate-700' : 'text-current';
        
        const opacityClass = '';

        return (
            <button
                onClick={handleClick}
                className={`chip-button w-full mb-1 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all ${classes} ${opacityClass} ${isDisabled ? 'cursor-not-allowed' : ''}`}
                disabled={isDisabled && !onClickOverride}
            >
                <div className="flex items-center">
                    <span className={`material-symbols-rounded text-xl mr-3 ${iconColorClass}`}>{item.icon}</span>
                    <span className={`font-semibold text-sm ${textColorClass} text-left`}>{item.title}</span>
                </div>
                {isSubMenuLink ? (
                    <span className={`material-symbols-rounded text-base ${isDisabled && shouldShowInactiveStyle ? 'text-slate-400' : `text-${visualColor}-500`}`}>chevron_right</span>
                ) : (
                    <span className={`material-symbols-rounded text-base ${isDisabled && shouldShowInactiveStyle ? 'text-slate-400' : `text-${visualColor}-500`}`}>launch</span>
                )}
            </button>
        );
    };

    const EducationMenuModal = ({ closeModal, onAppClick }) => {
        const [activeCategory, setActiveCategory] = useState(null);
        const modalRef = useRef(null);
        
        const THEME_COLOR = "emerald";
        
        const handleCategoryToggle = (id) => {
            setActiveCategory(activeCategory === id ? null : id);
        };
        
        const handleSubItemClick = (item) => {
            if (item.action === "placeholder") {
                return;
            }
            onAppClick(item); 
            closeModal();
        };
        
        const RenderSubMenuCards = ({ submenu }) => (
             <section className="app-grid-base-flexible mx-auto">
                {submenu.map(item => (
                    <AppCard 
                        key={item.id}
                        item={item} 
                        onClick={() => handleSubItemClick(item)} 
                    />
                ))}
            </section>
        );

        const isInactiveModeActive = true; 

        return (
            <div ref={modalRef} className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4">
                <div onClick={(e) => e.stopPropagation()} className={`relative w-screen h-screen sm:w-full sm:max-w-2xl sm:max-h-[90vh] bg-white rounded-none sm:rounded-2xl shadow-2xl border border-${THEME_COLOR}-500 flex flex-col overflow-hidden animate-fade-in-up`}>
                    
                    <CloseButton onClick={closeModal} themeColor={THEME_COLOR} />
                    
                    <div className="p-8 pt-16 px-4 sm:px-8 flex flex-col h-full overflow-y-auto hide-scrollbar">
                        
                        <div className="text-center mb-6">
                            <h2 className={`text-3xl font-bold text-${THEME_COLOR}-700`}>Educação</h2>
                        </div>
                        
                        
                        <div className="space-y-4 flex-1">
                            {EDUCATION_CATEGORIES.map((category) => {
                                const isCategoryLogicallyInactive = category.action === 'placeholder';
                                const shouldCategoryShowInactiveStyle = isCategoryLogicallyInactive;
                                
                                const categoryVisualColor = shouldCategoryShowInactiveStyle ? 'slate' : THEME_COLOR;
                                
                                const headerClasses = shouldCategoryShowInactiveStyle 
                                    ? INACTIVE_ACCORDION_CLASS
                                    : (activeCategory === category.id 
                                        ? `bg-${categoryVisualColor}-100 text-${categoryVisualColor}-800 border border-${categoryVisualColor}-200` 
                                        : `bg-${categoryVisualColor}-50 hover:bg-${categoryVisualColor}-100 text-${categoryVisualColor}-700 border border-${categoryVisualColor}-200`);

                                const categoryIconColor = `text-${categoryVisualColor}-600`;
                                const categoryTextColor = shouldCategoryShowInactiveStyle ? 'text-slate-700' : '';
                                
                                const wrapperBorderClass = `border-${categoryVisualColor}-200`;
                                
                                const isDisabled = isCategoryLogicallyInactive && !category.submenu;
                                
                                const INACTIVE_ACCORDION_CLASS = `
                                    bg-slate-100 border-slate-300 text-slate-500
                                    hover:bg-slate-100 cursor-not-allowed pointer-events-none
                                    border border-slate-300
                                `;

                                return (
                                    <div key={category.id} className={`w-full ${wrapperBorderClass} rounded-xl overflow-hidden shadow-sm`}>
                                        <button
                                            onClick={() => handleCategoryToggle(category.id)}
                                            className={`w-full text-left p-4 flex items-center justify-between transition-colors duration-200 ${headerClasses}`}
                                            disabled={isDisabled}
                                        >
                                            <div className="flex items-center">
                                                <span className={`material-symbols-rounded text-2xl mr-3 ${categoryIconColor}`}>{category.icon}</span>
                                                <span className={`font-bold text-lg ${categoryTextColor}`}>{category.title}</span>
                                            </div>
                                            <span className={`material-symbols-rounded transition-transform duration-200 ${shouldCategoryShowInactiveStyle ? 'text-slate-500' : ''} ${activeCategory === category.id ? 'rotate-90' : 'rotate-0'}`}>chevron_right</span>
                                        </button>

                                        <div 
                                            className="accordion-content transition-all duration-300" 
                                            style={{ 
                                                maxHeight: activeCategory === category.id && category.submenu ? `${modalRef.current?.scrollHeight || 500}px` : '0px', 
                                                transition: `max-height ${activeCategory === category.id ? '0.5s' : '0.3s'} ease-in-out`
                                            }}
                                        >
                                            {category.submenu && (
                                                <div className={`p-4 border-t border-${THEME_COLOR}-100 bg-white`}>
                                                    <RenderSubMenuCards submenu={category.submenu} />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            </div>
        );
    }
    
    const SettingsMenuModal = ({ 
        userData, 
        onAuth, 
        isFloatingBtnVisible, 
        toggleAccessibility, 
        backupToCloud, 
        isSyncing, 
        closeModal, 
        isAlertsFloatingBtnVisible, 
        toggleAlertsFloatingButton 
    }) => {
        const THEME_COLOR = "indigo";
        const PERFIL_COLOR = 'purple';
        const SEGURANCA_COLOR = 'amber';
        const SISTEMA_COLOR = 'cyan'; 
        const ACESSIBILIDADE_COLOR = 'fuchsia';
        
        const isInactiveModeActive = true;

        const getInitials = (name) => {
            if (!name) return 'U';
            const parts = name.trim().split(' ');
            if (parts.length === 1) return parts[0].substring(0, 2).toUpperCase();
            return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
        };

        const INACTIVE_CHIP_CLASS = `
            bg-slate-50 border-slate-300 text-slate-500 
            hover:bg-slate-100 hover:border-slate-400
        `;
        
        const SystemAccessibilityColumn = ({ 
            isFloatingBtnVisible, 
            toggleAccessibility,
            isAlertsFloatingBtnVisible, 
            toggleAlertsFloatingButton 
        }) => { 
            const systemStyle = useMemo(() => {
                const INACTIVE_SLATE_STYLE = {
                    baseClasses: 'bg-slate-50 border border-slate-300 text-slate-500 hover:bg-slate-100 hover:border-slate-400 pointer-events-none cursor-not-allowed',
                    iconColor: 'text-slate-500',
                    textColor: 'text-slate-700',
                    toggleBg: 'bg-slate-400',
                    toggleOffPos: 'left-0.5',
                    isDisabled: true,
                };
                return INACTIVE_SLATE_STYLE;
            }, []);
            
            const accessibilityVisualStyle = useMemo(() => {
                const activeColor = ACESSIBILIDADE_COLOR;
                
                const baseClasses = isFloatingBtnVisible 
                    ? `bg-${activeColor}-100 border-${activeColor}-400 text-${activeColor}-700 hover:bg-${activeColor}-200 hover:border-${activeColor}-500`
                    : `bg-${activeColor}-50 border-${activeColor}-300 text-${activeColor}-700 hover:bg-${activeColor}-100 hover:border-${activeColor}-400`;

                const iconColor = isFloatingBtnVisible ? `text-${activeColor}-600` : 'text-slate-500'; 
                const toggleBg = isFloatingBtnVisible ? `bg-${activeColor}-400` : 'bg-slate-400'; 
                const togglePos = isFloatingBtnVisible ? 'right-0.5' : 'left-0.5'; 
                
                return {
                    base: baseClasses,
                    icon: iconColor,
                    toggleBg: toggleBg,
                    togglePos: togglePos,
                    textColor: 'text-current' 
                };
            
            }, [isFloatingBtnVisible]); 

            const alertsFloatingBtnVisualStyle = useMemo(() => {
                const activeColor = 'amber';
                const isActive = isAlertsFloatingBtnVisible;
                
                const baseClasses = isActive 
                    ? `bg-${activeColor}-100 border-${activeColor}-400 text-${activeColor}-700 hover:bg-${activeColor}-200 hover:border-${activeColor}-500`
                    : `bg-${activeColor}-50 border-${activeColor}-300 text-${activeColor}-700 hover:bg-${activeColor}-100 hover:border-${activeColor}-400`;

                const iconColor = isActive ? `text-${activeColor}-600` : 'text-slate-500'; 
                const toggleBg = isActive ? `bg-${activeColor}-400` : 'bg-slate-400'; 
                const togglePos = isActive ? 'right-0.5' : 'left-0.5'; 
                
                return {
                    base: baseClasses,
                    icon: iconColor,
                    toggleBg: toggleBg,
                    togglePos: togglePos,
                    textColor: 'text-current' 
                };
            
            }, [isAlertsFloatingBtnVisible]);


            return (
                <div className="flex flex-col gap-1 w-full lg:min-w-[12rem] lg:w-auto">
                    {/* SEÇÃO: SISTEMA (CIANO) */}
                    <SectionTitle icon="build" title="Sistema" color={SISTEMA_COLOR} />

                    {/* NOVO BOTÃO: FLUTUANTE ALERTAS (INTEGRAÇÃO NO MENU) */}
                    <button 
                        onClick={() => toggleAlertsFloatingButton(!isAlertsFloatingBtnVisible)} 
                        className={`chip-button w-full mb-1 mt-2 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all ${alertsFloatingBtnVisualStyle.base}`}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${alertsFloatingBtnVisualStyle.icon}`}>notifications</span>
                            <span className={`font-semibold text-sm ${alertsFloatingBtnVisualStyle.textColor}`}>Alertas Flutuante</span>
                        </div>
                        {/* TOGGLE SWITCH */}
                        <div className={`w-8 h-4 rounded-full relative transition-colors ${alertsFloatingBtnVisualStyle.toggleBg}`}>
                            <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all ${alertsFloatingBtnVisualStyle.togglePos}`}></div>
                        </div>
                    </button>
                    
                    {/* Botão Tema (Toggle) - Fixo como PLACEHOLDER */}
                    <button 
                        onClick={() => {}} 
                        className={`chip-button w-full mb-1 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all ${systemStyle.baseClasses}`}
                        disabled={systemStyle.isDisabled}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${systemStyle.iconColor}`}>dark_mode</span>
                            <span className={`font-semibold text-sm ${systemStyle.textColor}`}>Tema</span> 
                        </div>
                        <div className={`w-8 h-4 rounded-full relative transition-colors ${systemStyle.toggleBg}`}>
                            <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all ${systemStyle.toggleOffPos}`}></div>
                        </div>
                    </button>

                    {/* LINGUAGEM (INATIVO, mas mantém o indicador) */}
                    <button 
                        onClick={() => {}} 
                        className={`chip-button w-full mb-1 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all ${systemStyle.baseClasses}`}
                        disabled={systemStyle.isDisabled}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${systemStyle.iconColor}`}>language</span>
                            <span className={`font-semibold text-sm ${systemStyle.textColor}`}>Linguagem</span> 
                        </div>
                        {/* INDICADOR DE SELEÇÃO: PORTUGUÊS (BR) - Estilo cinza (slate) */}
                        <div className="flex items-center">
                             <span className="text-xs font-semibold text-slate-600 bg-white px-2 py-0.5 rounded-full border border-slate-300 shadow-sm">
                                Português (BR)
                            </span>
                        </div>
                    </button>


                    {/* SEÇÃO: ACESSIBILIDADE (FÚCSIA) - Apenas o botão flutuante está ativo */}
                    <SectionTitle icon="accessibility_new" title="Acessibilidade" color={ACESSIBILIDADE_COLOR} />
                    
                    {/* Botão "Botões" (Funcional) - SEMPRE FUCHSIA, ÍCONE MUDA POR ESTADO INTERNO */}
                    <button 
                        onClick={() => toggleAccessibility(!isFloatingBtnVisible)} 
                        className={`chip-button w-full mb-1 mt-2 px-4 py-2.5 rounded-xl flex items-center justify-between border transition-all ${accessibilityVisualStyle.base}`}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${accessibilityVisualStyle.icon}`}>accessibility_new</span>
                            <span className={`font-semibold text-sm ${accessibilityVisualStyle.textColor}`}>Botões Flutuantes</span>
                        </div>
                        {/* TOGGLE SWITCH */}
                        <div className={`w-8 h-4 rounded-full relative transition-colors ${accessibilityVisualStyle.toggleBg}`}>
                            <div className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all ${accessibilityVisualStyle.togglePos}`}></div>
                        </div>
                    </button>
                </div>
            );
        }; 

        const RenderProfileAndRootNavigation = ({ onAuth, backupToCloud, isSyncing, userData }) => {
            const profileColor = PERFIL_COLOR;
            const securityColor = SEGURANCA_COLOR;
            
            const INACTIVE_SLATE_STYLE = {
                baseClasses: 'bg-slate-50 border border-slate-300 text-slate-500 hover:bg-slate-100 hover:border-slate-400 pointer-events-none cursor-not-allowed',
                iconColor: 'text-slate-500',
                textColor: 'text-slate-700',
                isDisabled: true,
            };

            const isBackupDisabled = isSyncing || !userData; 

            return (
                <div className="flex flex-col gap-1 w-full relative">
                    {/* SEÇÃO: PERFIL (ROXO) */}
                    <SectionTitle icon="account_circle" title="Perfil" color={profileColor} />

                    <button 
                        onClick={onAuth} 
                        className={`chip-button w-full mb-1 mt-4 px-3 py-3 rounded-xl flex items-center justify-start bg-${profileColor}-50 border border-${profileColor}-200 text-${profileColor}-700 hover:bg-${profileColor}-100 transition-all text-left group`}>
                        <div className={`w-10 h-10 rounded-full bg-${profileColor}-600 text-white flex items-center justify-center font-bold text-sm shrink-0 mr-3 shadow-sm group-hover:scale-110 transition-transform`}>
                            {userData ? getInitials(userData.name) : <span className="material-symbols-rounded">person</span>}
                        </div>
                        <div className="flex flex-col">
                            <span className="text-sm font-bold leading-tight">
                                {userData ? userData.name.split(' ')[0] : 'Visitante'}
                            </span>
                            <span className="text-xs opacity-80">
                                {userData ? 'Conectado' : 'Login'}
                            </span>
                        </div>
                    </button>
                    
                    {/* SEÇÃO SEGURANÇA (AMBAR) */}
                    <SectionTitle icon="security" title="Segurança" color={securityColor} />
                    
                    {/* BOTÃO 1: BACKUP */}
                    <button 
                        onClick={backupToCloud} 
                        disabled={isBackupDisabled} 
                        className={`chip-button w-full mt-2 px-4 py-2.5 rounded-xl flex items-center justify-start 
                                    ${isBackupDisabled && !isSyncing ? INACTIVE_SLATE_STYLE.baseClasses : `bg-${securityColor}-50 border border-${securityColor}-300 text-${securityColor}-700 hover:bg-${securityColor}-100`} 
                                    transition-all ${isBackupDisabled ? 'cursor-not-allowed' : ''}`}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${isBackupDisabled && !isSyncing ? INACTIVE_SLATE_STYLE.iconColor : `text-${securityColor}-600`} ${isSyncing ? 'animate-spin' : ''}`}>
                                {isSyncing ? 'sync' : 'cloud_upload'}
                            </span>
                            <span className={`font-semibold text-sm ${isBackupDisabled && !isSyncing ? INACTIVE_SLATE_STYLE.textColor : `text-${securityColor}-700`}`}>
                                {isBackupDisabled && !userData ? 'Login para Backup' : (isSyncing ? 'Fazendo Backup' : 'Backup')}
                            </span>
                        </div>
                    </button>

                    {/* BOTÃO 2: TROCAR SENHA (INATIVO) */}
                    <button 
                        onClick={() => {}} 
                        className={`chip-button w-full mb-1 px-4 py-2.5 rounded-xl flex items-center justify-start ${INACTIVE_SLATE_STYLE.baseClasses}`}
                        disabled={INACTIVE_SLATE_STYLE.isDisabled}
                    >
                        <div className="flex items-center">
                            <span className={`material-symbols-rounded mr-3 ${INACTIVE_SLATE_STYLE.iconColor}`}>vpn_key</span>
                            <span className={`font-semibold text-sm ${INACTIVE_SLATE_STYLE.textColor}`}>Senha</span> 
                        </div>
                    </button>
                    
                    {/* SEPARADOR para mobile */}
                    <div className="h-px bg-slate-200 my-4 md:hidden"></div>
                </div>
            );
        };


        return (
            <div id={`central-menu-modal-overlay`} tabIndex="-1" aria-hidden="true" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4">
                <div onClick={(e) => e.stopPropagation()} 
                    className={`
                        relative w-screen h-screen sm:w-full sm:max-w-2xl sm:max-h-[90vh] bg-white rounded-none sm:rounded-2xl shadow-2xl 
                        border border-${THEME_COLOR}-500 flex flex-col overflow-hidden animate-fade-in-up
                    `}
                >
                    
                    <CloseButton onClick={closeModal} themeColor={THEME_COLOR} />

                    <div className="p-8 pt-16 px-4 sm:px-8 flex flex-col h-full overflow-y-auto hide-scrollbar">
                            
                        <div className="text-center mb-6">
                            <h2 className={`text-3xl font-bold text-${THEME_COLOR}-700`}>Configurações</h2>
                        </div>

                        <div className="flex-1 flex flex-col sm:grid sm:grid-cols-2 sm:gap-4">
                            {/* COLUNA 1: Perfil e Segurança */}
                            <RenderProfileAndRootNavigation 
                                userData={userData} 
                                onAuth={onAuth}
                                backupToCloud={backupToCloud} 
                                isSyncing={isSyncing} 
                            />

                            {/* COLUNA 2: Sistemas e Acessibilidade */}
                            <SystemAccessibilityColumn 
                                isFloatingBtnVisible={isFloatingBtnVisible} 
                                toggleAccessibility={toggleAccessibility} 
                                isAlertsFloatingBtnVisible={isAlertsFloatingBtnVisible} 
                                toggleAlertsFloatingButton={toggleAlertsFloatingButton} 
                            />
                        </div>
                    </div>
                </div>
            </div>
        );
    };
    
    const AlertsPanel = ({ userData, closeModal }) => {
        return (
            <div className="p-8 w-full pt-16 sm:p-8 sm:pt-16">
                <div className="text-center mb-8">
                    <h2 className="text-2xl font-bold text-amber-700">Notificações</h2>
                </div>

                <div className="space-y-4">
                    <div className="bg-amber-50 p-4 rounded-xl border border-amber-300 flex items-center">
                         <span className="material-symbols-rounded text-2xl text-amber-500 mr-3">info</span>
                        <div>
                            <h3 className="font-semibold text-amber-800">Boas-vindas</h3>
                            <p className="text-sm text-amber-700">Esta é a sua nova Central de Notificações.</p>
                        </div>
                    </div>
                    
                    <div className="bg-slate-50 p-4 rounded-xl border border-slate-300 flex items-center opacity-70">
                         <span className="material-symbols-rounded text-2xl text-slate-500 mr-3">check_circle</span>
                        <div>
                            <h3 className="font-semibold text-slate-700">Concluído</h3>
                            <p className="text-sm text-slate-600">Último backup salvo na nuvem com sucesso. (2 minutos atrás)</p>
                        </div>
                    </div>

                    <div className="text-center pt-4">
                        <button onClick={closeModal} className="mt-2 text-amber-600 hover:text-amber-800 text-sm underline">Fechar</button>
                    </div>
                </div>
            </div>
        );
    };


    const AuthPanel = ({ onLoginSuccess, onClose }) => {
        const [isRegistering, setIsRegistering] = useState(false);
        const [formData, setFormData] = useState({ phone: '', name: '', password: '' });

        const handleSubmit = async (e) => {
            e.preventDefault();
            if (isRegistering && !formData.name) { 
                console.error("Por favor, preencha o nome."); 
                return; 
            }
            if (!formData.phone || formData.phone.length < 8) { 
                console.error("Telefone inválido."); 
                return; 
            }
            onLoginSuccess({ phone: formData.phone, name: formData.name || 'Usuário', role: 'user' });
        };

        return (
            <div className="p-8 w-full pt-16 sm:p-8 sm:pt-16"> 
                <div className="text-center mb-6">
                    <h2 className="text-2xl font-bold text-purple-700">{isRegistering ? 'Cadastro' : 'Login'}</h2>
                </div>
                <form onSubmit={handleSubmit} className="space-y-4">
                    {isRegistering && (
                        <div>
                            <label className="block text-sm font-medium text-purple-700 mb-1">Nome Completo</label>
                            <input type="text" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} className="w-full rounded-lg border border-purple-300 bg-purple-50 focus:bg-white shadow-sm focus:border-purple-500 focus:ring-purple-500 p-2.5 transition-colors" placeholder="Seu nome" />
                        </div>
                    )}
                    <div>
                        <label className="block text-sm font-medium text-purple-700 mb-1">Telefone (ID)</label>
                            <input type="tel" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} className="w-full rounded-lg border border-purple-300 bg-purple-50 focus:bg-white shadow-sm focus:border-purple-500 focus:ring-purple-500 p-2.5 transition-colors" placeholder="(99) 99999-9999" required />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-purple-700 mb-1">Senha</label>
                        <input type="password" value={formData.password} onChange={(e) => setFormData({...formData, password: e.target.value})} className="w-full rounded-lg border border-purple-300 bg-purple-50 focus:bg-white shadow-sm focus:border-purple-500 focus:ring-purple-500 p-2.5 transition-colors" placeholder="******" required />
                    </div>
                    <button type="submit" className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform hover:scale-[1.02]">{isRegistering ? 'Cadastrar' : 'Entrar'}</button>
                </form>
                <div className="mt-6 text-center">
                    <button onClick={() => setIsRegistering(!isRegistering)} className="text-sm text-purple-600 hover:text-purple-800 font-medium underline">
                        {isRegistering ? 'Já tem conta? Fazer Login' : 'Não tem conta? Cadastre-se'}
                    </button>
                </div>
            </div>
        );
    };

    const SettingsPanel = ({ userData }) => {
        return (
            <div className="p-8 w-full pt-16 sm:p-8 sm:pt-16">
                <div className="text-center mb-8">
                    <h2 className="text-2xl font-bold text-cyan-700">Configurações</h2>
                </div>

                <div className="space-y-6">
                    <div className="bg-cyan-50 p-4 rounded-xl border border-cyan-300">
                        <div className="flex items-center mb-3">
                            <span className="material-symbols-rounded text-cyan-500 mr-2">badge</span>
                            <h3 className="font-semibold text-cyan-800">Meus Dados</h3>
                        </div>
                        <p className="text-sm text-cyan-700"><strong>Nome:</strong> {userData ? userData.name : 'Visitante'}</p>
                        <p className="text-sm text-cyan-700"><strong>ID:</strong> {userData ? userData.phone : '-'}</p>
                        <button className="mt-3 text-xs text-cyan-600 hover:text-cyan-800 font-medium flex items-center bg-white border border-cyan-300 px-3 py-1.5 rounded-full shadow-sm hover:bg-cyan-50 transition-colors">
                            <span className="material-symbols-rounded text-sm mr-1">edit</span> Editar Perfil
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    const AppCard = ({ item, onClick }) => {
        const isInactiveModeActive = true;
        
        const isLogicallyInactive = item.action === 'placeholder';
        const shouldShowInactiveStyle = isLogicallyInactive && isInactiveModeActive;
        
        const visualColor = shouldShowInactiveStyle ? 'slate' : item.color;
        
        const opacity = ''; 
        const pointerEvents = isLogicallyInactive ? 'pointer-events-none cursor-not-allowed' : 'cursor-pointer';
        
        const colorClass = `border-${visualColor}-500 bg-${visualColor}-500/20`;
        const iconColorClass = `text-${visualColor}-500`;
        const textColorClass = `text-${visualColor}-700`;

        const clickHandler = isLogicallyInactive ? (e) => e.preventDefault() : onClick;
        
        return (
            <div 
                data-app-id={item.id} 
                onClick={clickHandler} 
                role="button" 
                className={`card-base w-32 h-32 md:w-36 md:h-36 ${colorClass} ${opacity} ${pointerEvents} hover:ring-2 hover:ring-${visualColor}-500 transition-all duration-300`}
            >
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none select-none">
                    <span 
                        style={{ fontSize: '6.5rem', transform: 'translateY(-0.75rem)' }} 
                        className={`material-symbols-rounded leading-none ${iconColorClass} opacity-30`}
                    >
                        {item.icon}
                    </span>
                </div>
                
                <div className="relative z-10 flex flex-col justify-end h-full text-center pb-2">
                    <h2 className={`text-sm ${textColorClass} font-semibold leading-tight`}>{item.title}</h2>
                </div>
            </div>
        );
    };

    const MiniAppModal = ({ modalConfig, closeModal, loading, setLoading, appId, customClass, dynamicHeight }) => {
        const iframeRef = React.useRef(null);
        const { modalId, url, basePath, color } = modalConfig; 
        
        const borderColorClass = color ? `border-${color}-500` : 'border-indigo-500';
        
        // Uso de h-screen para o overlay e h-full para o iframe
        const containerClasses = customClass || `relative w-screen h-screen sm:w-full sm:max-w-5xl sm:h-full bg-white rounded-none sm:rounded-2xl shadow-2xl ${borderColorClass} flex flex-col overflow-hidden animate-fade-in-up p-0 sm:p-0`;

        const loadMiniAppContent = useCallback(async () => {
            if (!url || !iframeRef.current) return;
            setLoading(true);
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                const htmlContent = await response.text();
                let processedHtml = "";
                if (window.prepareMiniAppHtml) {
                    const isDark = document.documentElement.classList.contains('dark');
                    processedHtml = window.prepareMiniAppHtml(htmlContent, appId, basePath);
                    if (dynamicHeight) processedHtml = processedHtml.replace('padding-bottom: 120px !important;', 'padding-bottom: 1rem !important;');
                    
                    if (isDark) {
                        processedHtml = processedHtml.replace('<html lang="pt-BR">', '<html lang="pt-BR" class="dark">');
                    }
                    
                    iframeRef.current.srcdoc = processedHtml;
                } else {
                    iframeRef.current.srcdoc = htmlContent; 
                }
                iframeRef.current.onload = () => {
                    setLoading(false);
                    if (dynamicHeight && iframeRef.current.contentWindow) {
                        try {
                            const doc = iframeRef.current.contentWindow.document;
                            const height = doc.documentElement.scrollHeight || doc.body.scrollHeight;
                            if (height > 0) iframeRef.current.style.height = (height + 20) + 'px'; 
                        } catch(e) {}
                    }
                };
            } catch (error) {
                iframeRef.current.srcdoc = `<div style="text-align:center; padding:2rem;">Erro de Carregamento</div>`;
                setLoading(false);
            }
        }, [url, basePath, setLoading, appId, dynamicHeight]);

        useEffect(() => { loadMiniAppContent(); }, [loadMiniAppContent]);

        return (
            <div id={`${modalId}-modal-overlay`} tabIndex="-1" aria-hidden="true" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4">
                <div onClick={(e) => e.stopPropagation()} className={containerClasses}>
                    <CloseButton onClick={closeModal} themeColor={color} /> 
                    <iframe ref={iframeRef} className="w-full h-full border-0 hide-scrollbar" title={`App ${modalConfig.title || modalId}`} style={dynamicHeight ? { minHeight: '300px' } : {}}></iframe>
                    {loading && <div className="absolute inset-0 z-30 flex justify-center items-center bg-white/80 backdrop-blur-sm"><p className="ml-3 text-sm font-semibold text-gray-700">Carregando...</p></div>}
                </div>
            </div>
        );
    };

    function App() {
        const [userData, setUserData] = useState(null);
        const [adminConfig, setAdminConfig] = useState({ sheetId: '', sheetTab: '' });
        const [isSyncing, setIsSyncing] = useState(false);
        const [currentView, setCurrentView] = useState('portfolio');
        const [history, setHistory] = useState([]);
        const [modalConfig, setModalConfig] = useState(null);
        const [modalLoading, setModalLoading] = useState(false);
        const [showAuthModal, setShowAuthModal] = useState(false);
        const [showAlertsPanelModal, setShowAlertsPanelModal] = useState(false);
        const [showSettingsModal, setShowSettingsModal] = useState(false);
        
        const isInactiveModeActive = true;
        
        const [isDarkMode, setIsDarkMode] = useState(false); 
        const [isFloatingBtnVisible, setIsFloatingBtnVisible] = useState(true);
        const [isAlertsFloatingBtnVisible, setIsAlertsFloatingBtnVisible] = useState(true); 
        
        const toggleAccessibility = (newState) => {
            setIsFloatingBtnVisible(newState);
        };
        
        const toggleAlertsFloatingButton = (newState) => {
            setIsAlertsFloatingBtnVisible(newState);
        };

        useEffect(() => {
            const rootHtml = document.documentElement;
            rootHtml.classList.remove('dark');
        }, [isDarkMode]);
        
        useEffect(() => {
            const loadData = async () => {
                try {
                    const users = await db.user.toArray();
                    if (users.length > 0) setUserData(users[0]);
                    const sheetId = await db.settings.get('sheetId');
                    const sheetTab = await db.settings.get('sheetTab');
                    if (sheetId && sheetTab) setAdminConfig({ sheetId: sheetId.value, sheetTab: sheetTab.value });
                } catch (error) { console.error("Erro ao carregar dados do Dexie:", error); }
            };
            loadData();
        }, []);

        const saveAdminConfig = async (e) => {
            e.preventDefault();
            const form = e.target;
            const newSheetId = form.sheetId.value;
            const newSheetTab = form.sheetTab.value;
            try {
                await db.settings.put({ key: 'sheetId', value: newSheetId });
                await db.settings.put({ key: 'sheetTab', value: newSheetTab });
                setAdminConfig({ sheetId: newSheetId, sheetTab: newSheetTab });
                console.log("Configurações salvas com sucesso!");
                closeModal();
            } catch (error) { 
                console.error("Erro ao salvar configurações:", error); 
            }
        };

        const backupToCloud = async () => {
            if (!userData) { 
                console.error("ERRO DE BACKUP: Nenhum dado de utilizador para salvar. Por favor, faça login."); 
                return; 
            }
            if (!adminConfig.sheetId) { 
                console.error("ERRO DE BACKUP: Atenção: ID da Planilha não configurado no Painel Admin!"); 
                return; 
            }
            setIsSyncing(true);
            try {
                const payload = { action: 'backup', user: userData, timestamp: new Date().toISOString(), targetSheetId: adminConfig.sheetId, targetTabName: adminConfig.sheetTab || 'users' };
                await fetch(DEFAULT_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                console.log("Backup enviado para a Planilha configurada!");
            } catch (error) { 
                console.error("ERRO DE CONEXÃO: Erro ao conectar:", error); 
            } finally { setIsSyncing(false); }
        };
        
        const handleNativeLogin = async (user) => {
            const newUser = { id: user.phone, phone: user.phone, name: user.name || 'Usuário', createdAt: new Date() };
            try {
                await db.user.put(newUser);
                setUserData(newUser);
                setShowAuthModal(false); 
            } catch (e) { 
                console.error("Erro ao salvar login localmente:", e); 
            }
        };

        const navigateTo = (newView, pushToHistory = true) => {
            if (currentView !== newView && pushToHistory) setHistory(prev => [...prev, currentView]);
            setCurrentView(newView);
        };

        const goBack = () => {
            if (history.length > 0) {
                const previousView = history[history.length - 1];
                setHistory(prev => prev.slice(0, -1));
                setCurrentView(previousView);
            } else { setCurrentView('portfolio'); }
        };
        
        const handleCardClick = (item) => {
            if (item.action === "placeholder") {
                return; 
            }
            if (item.id === 'auth') { setShowAuthModal(true); return; }
            
            if (item.modalId === 'education-menu-modal') {
                setModalConfig({ modalId: 'education-menu-modal', title: 'Educação', color: "emerald" });
                return;
            }
            if (item.modalId === 'central-menu-modal') {
                setModalConfig({ modalId: 'central-menu-modal', title: 'Configurações', color: "indigo" });
                return;
            }
            if (item.modalId === 'alerts-panel') {
                setModalConfig({ modalId: 'alerts-panel', title: 'Notificações', color: "amber" });
                setShowAlertsPanelModal(true);
                return;
            }

            if (item.action === 'modal') { setModalConfig(item); setModalLoading(true); } 
            else if (item.action === 'placeholder') { 
                return; 
            } 
            else if (item.view) { navigateTo(item.view); }
        };
        
        const handleAppClickFromModal = (item) => {
            if (item.modalId === 'auth-modal') {
                setShowAuthModal(true);
            } else if (item.modalId === 'alerts-panel') { 
                setShowAlertsPanelModal(true);
            } else if (item.modalId === 'admin-modal') {
                setModalConfig({ modalId: 'admin-modal', title: 'Admin', color: "slate" });
            } else if (item.modalId === 'alerts') {
                setModalConfig({ modalId: 'alerts', title: 'Alertas', color: "amber" });
            } else if (item.modalId === 'settings-modal') { 
                 setShowSettingsModal(true);
            } else {
                setModalConfig(item); 
                setModalLoading(true);
            }
        };

        const closeModal = () => {
            setModalConfig(null);
            setShowAuthModal(false); 
            setShowSettingsModal(false);
            setShowAlertsPanelModal(false); 
        };
        
        const openAuthModal = () => {
            closeModal(); 
            handleCardClick(AUTH_ITEM_CONFIG); 
        };
        
        const openAlertsPanel = () => handleCardClick({ id: 'notifications', title: "Notificações", action: 'modal', modalId: 'alerts-panel', color: "amber", icon: "notifications" });

        const currentViewData = VIEW_MAP[currentView] || VIEW_MAP['portfolio'];
        const renderedItems = useMemo(() => currentViewData.data || [], [currentViewData.data]);
        
        
        const RenderedView = ({ title, items }) => (
            <div className="flex flex-col items-center">
                <section className="mt-4 text-center w-full">
                    <h1 className="3xl font-bold tracking-tight text-gray-800">{title}</h1>
                </section>
                <div className="app-grid-container w-full max-w-5xl">
                    <section className="mt-6 app-grid-base-flexible mx-auto">
                        {items.map((item, index) => (
                            <AppCard 
                                key={item.id || index} 
                                item={item} 
                                onClick={() => handleCardClick(item)} 
                            />
                        ))}
                    </section>
                </div>
            </div>
        );

        const buttonBaseClasses = "chip-button no-shadow font-medium rounded-lg text-sm inline-flex items-center transition-all duration-300 hover:scale-105 h-10 flex justify-center overflow-hidden";
        const fixedButtonClasses = `${buttonBaseClasses}`;

        const floatingAccessibilityButtonClasses = useMemo(() => {
            const base = `${fixedButtonClasses} animate-fade-in-up no-shadow transition-all duration-300`;
            const color = isInactiveModeActive
                ? `bg-slate-100 border-slate-300 text-slate-500 cursor-not-allowed`
                : `bg-fuchsia-100 border-fuchsia-500 text-fuchsia-600 hover:bg-fuchsia-200 hover:border-fuchsia-600`;
                
            const compactStyle = 'w-auto px-4';
                
            return `${base} ${color} ${compactStyle}`;
        }, [isInactiveModeActive]);
        
        const floatingAlertsButtonClasses = useMemo(() => {
            const base = `${fixedButtonClasses} animate-fade-in-up no-shadow transition-all duration-300`;
            const color = isInactiveModeActive
                ? `bg-slate-100 border-slate-300 text-slate-500 cursor-not-allowed`
                : `bg-amber-100 border-amber-500 text-amber-700 hover:bg-amber-200 hover:border-amber-600`;
                
            const compactStyle = 'w-auto px-4';
                
            return `${base} ${color} ${compactStyle}`;
        }, [isInactiveModeActive]);
        
        
        const floatingAccessibilityClickHandler = isInactiveModeActive ? () => {} : () => toggleAccessibility(!isFloatingBtnVisible);
        const floatingAlertsClickHandler = isInactiveModeActive ? () => {} : openAlertsPanel;


        return (
            <div className="antialiased flex flex-col min-h-screen">
                
                {/* BOTÕES FLUTUANTES DIREITA (ACESSIBILIDADE) */}
                <div className="fixed top-4 right-4 z-40 flex flex-col items-end space-y-2">
                    {isFloatingBtnVisible && ( 
                        <button 
                            onClick={floatingAccessibilityClickHandler} 
                            className={floatingAccessibilityButtonClasses}
                            disabled={isInactiveModeActive}
                        >
                            <span className={`material-symbols-rounded text-xl mr-1`}>accessibility_new</span>
                            <span className={`font-medium whitespace-nowrap overflow-hidden`}>Acessibilidade</span>
                        </button>
                    )}
                </div>

                {/* BOTÃO FLUTUANTE INFERIOR ESQUERDO (ALERTAS) */}
                {/* POSICIONAMENTO SIMPLIFICADO: fixed bottom-4 left-4 */}
                <div className="fixed bottom-4 left-4 z-40 flex flex-col items-start space-y-2">
                    {isAlertsFloatingBtnVisible && ( 
                        <button 
                            onClick={floatingAlertsClickHandler} 
                            className={floatingAlertsButtonClasses}
                            disabled={false} 
                        >
                            <span className={`material-symbols-rounded text-xl mr-1`}>notifications</span>
                            <span className={`font-medium whitespace-nowrap overflow-hidden`}>Alertas</span>
                        </button>
                    )}
                </div>


                <main className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 pb-10 pt-8 flex flex-col w-full justify-center">
                    <RenderedView title={currentViewData.title} items={renderedItems} />
                </main>
                
                {/* MODAIS */}
                
                {/* MODAL: CONFIGURAÇÕES */}
                {modalConfig && modalConfig.modalId === 'central-menu-modal' && (
                    <SettingsMenuModal 
                        closeModal={closeModal} 
                        userData={userData}
                        onAuth={openAuthModal} 
                        isFloatingBtnVisible={isFloatingBtnVisible} 
                        toggleAccessibility={toggleAccessibility} 
                        isAlertsFloatingBtnVisible={isAlertsFloatingBtnVisible} 
                        toggleAlertsFloatingButton={toggleAlertsFloatingButton}
                        backupToCloud={backupToCloud}
                        isSyncing={isSyncing}
                    />
                )}

                {/* MODAL: MENU DE EDUCAÇÃO */}
                {modalConfig && modalConfig.modalId === 'education-menu-modal' && (
                    <EducationMenuModal closeModal={closeModal} onAppClick={handleAppClickFromModal} />
                )}

                {/* MODAL ADMIN */}
                {modalConfig && modalConfig.modalId === 'admin-modal' && (
                    <div id="admin-modal-overlay" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4" onClick={closeModal}>
                        <div className="relative w-screen h-screen sm:w-full sm:max-w-lg sm:h-auto bg-white rounded-none sm:rounded-2xl shadow-2xl border border-slate-500 flex flex-col overflow-hidden animate-fade-in-up" onClick={(e) => e.stopPropagation()}>
                             <CloseButton onClick={closeModal} themeColor="slate" />
                            <div className="p-6 pt-12 px-0 sm:p-6 sm:pt-12 sm:px-6"> 
                                <h2 className="text-2xl font-bold mb-4 text-slate-700 flex items-center justify-center"><span className="material-symbols-rounded mr-2 text-3xl">admin_panel_settings</span>Admin</h2>
                                <form onSubmit={saveAdminConfig} className="space-y-4 max-w-lg mx-auto p-4 sm:p-0">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">ID da Planilha Google</label>
                                        <input type="text" name="sheetId" defaultValue={adminConfig.sheetId} placeholder="Ex: 1aKPEGQcKRzY..." className="w-full rounded-md border border-slate-400 shadow-sm focus:border-slate-500 focus:ring-slate-500 p-2 bg-slate-50 focus:bg-white transition-colors" required />
                                        <p className="text-xs text-slate-500 mt-1">O ID longo encontrado na URL da sua planilha.</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Nome da Aba (Tab)</label>
                                        <input type="text" name="sheetTab" defaultValue={adminConfig.sheetTab} placeholder="Ex: users" className="w-full rounded-md border border-slate-400 shadow-sm focus:border-slate-500 focus:ring-slate-500 p-2 bg-slate-50 focus:bg-white transition-colors" required />
                                    </div>
                                    <div className="pt-4 flex justify-center"><button type="submit" className="bg-slate-600 text-white px-6 py-2 rounded-full hover:bg-slate-700 transition shadow-lg flex items-center"><span className="material-symbols-rounded mr-2">save</span>Salvar Configurações</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                )}
                
                {/* MODAIS DE MINI-APPS (iframe) */}
                {modalConfig && modalConfig.modalId !== 'alerts-panel' && modalConfig.modalId !== 'placeholder' && modalConfig.modalId !== 'auth-modal' && modalConfig.modalId !== 'admin-modal' && modalConfig.modalId !== 'education-menu-modal' && modalConfig.modalId !== 'central-menu-modal' && (
                    <MiniAppModal modalConfig={modalConfig} closeModal={closeModal} loading={modalLoading} setLoading={setModalLoading} appId={APP_ID} />
                )}

                {/* MODAL AUTH */}
                {showAuthModal && (
                    <div id="auth-modal-overlay" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4" onClick={closeModal}>
                        <div className="relative w-screen h-screen sm:w-full sm:max-w-lg sm:h-auto bg-white rounded-none sm:rounded-2xl shadow-2xl border border-purple-500 flex flex-col overflow-hidden animate-fade-in-up" onClick={(e) => e.stopPropagation()}>
                            <CloseButton onClick={closeModal} themeColor="purple" />
                            <AuthPanel onLoginSuccess={handleNativeLogin} onClose={closeModal} />
                        </div>
                    </div>
                )}

                {/* MODAL: PAINEL DE NOTIFICAÇÕES (ALERTSPANEL) */}
                {showAlertsPanelModal && (
                    <div id="alerts-panel-modal-overlay" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4" onClick={closeModal}>
                        <div className="relative w-screen h-screen sm:w-full sm:max-w-lg sm:h-auto bg-white rounded-none sm:rounded-2xl shadow-2xl border border-amber-500 flex flex-col overflow-hidden animate-fade-in-up" onClick={(e) => e.stopPropagation()}>
                            <CloseButton onClick={closeModal} themeColor="amber" />
                            <AlertsPanel userData={userData} closeModal={closeModal} />
                        </div>
                    </div>
                )}


                {/* MODAL CONFIGURAÇÕES (SettingsPanel) */}
                {showSettingsModal && (
                    <div id="settings-modal-overlay" className="fixed inset-0 z-50 flex justify-center items-center w-full h-screen bg-black/60 backdrop-blur-sm p-0 sm:p-4" onClick={closeModal}>
                        <div className="relative w-screen h-screen sm:w-full sm:max-w-lg sm:h-auto bg-white rounded-none sm:rounded-2xl shadow-2xl border border-cyan-500 flex flex-col overflow-hidden animate-fade-in-up" onClick={(e) => e.stopPropagation()}>
                            <CloseButton onClick={closeModal} themeColor="cyan" />
                            <SettingsPanel userData={userData} />
                        </div>
                    </div>
                )}
            </div>
        );
    }

    const rootElement = document.getElementById('root');
    if (rootElement) {
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);
    } else {
        console.error("ERRO: Elemento root não encontrado");
    }
    </script>
</body>
</html>
