<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel do Prefeito — v1.0.0</title>
  <!-- Estilos do miniapp -->
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="appbar">
    <nav class="appbar-left">
      <button class="btn btn-ghost" id="btn-back">
        <i data-lucide="arrow-left"></i>
        <span>Voltar</span>
      </button>
      <span class="badge">v1.0.0</span>
    </nav>
    <nav class="appbar-right">
      <button class="chip" id="toolbar.filters"><i data-lucide="filter"></i><span>toolbar.filters</span></button>
      <button class="chip" id="toolbar.studies"><i data-lucide="book-open"></i><span>toolbar.studies</span></button>
      <button class="chip" id="toolbar.theme"><i data-lucide="sun"></i><span>toolbar.theme</span></button>
      <button class="chip" id="toolbar.language"><i data-lucide="languages"></i><span>toolbar.language</span></button>
    </nav>
  </header>

  <main class="container">
    <!-- TOP PERSONA SUMMARY -->
    <section class="grid grid-3 persona">
      <article class="card" id="persona.gender">
        <header class="card-head">
          <i data-lucide="users"></i>
          <strong>persona.gender</strong>
        </header>
        <div class="card-body">
          <div class="kpi">54% • ♂ 44% • ♀ 2%</div>
          <small class="muted">persona.hint</small>
        </div>
      </article>

      <article class="card" id="persona.age">
        <header class="card-head">
          <i data-lucide="calendar"></i>
          <strong>persona.age</strong>
        </header>
        <div class="card-body">
          <div class="kpi">25–34 (31%) • 35–44 (27%)</div>
          <small class="muted">persona.hint</small>
        </div>
      </article>

      <article class="card" id="persona.neighborhood">
        <header class="card-head">
          <i data-lucide="map-pin"></i>
          <strong>persona.neighborhood</strong>
        </header>
        <div class="card-body">
          <div class="kpi">Boqueirão, CIC, Bairro Novo</div>
          <small class="muted">persona.hintTop</small>
        </div>
      </article>
    </section>

    <!-- SECTORS KPIs -->
    <section class="grid grid-5 sectors">
      <article class="card" id="sector.saude">
        <header class="card-head">
          <i data-lucide="heart-pulse"></i>
          <strong>sector.saude</strong>
        </header>
        <div class="card-body kpi-pair">
          <div class="kpi">4,2</div>
          <div class="delta up">+0,3</div>
        </div>
      </article>

      <article class="card" id="sector.educacao">
        <header class="card-head">
          <i data-lucide="graduation-cap"></i>
          <strong>sector.educacao</strong>
        </header>
        <div class="card-body kpi-pair">
          <div class="kpi">3,8</div>
          <div class="delta stable">delta.stable</div>
        </div>
      </article>

      <article class="card" id="sector.transporte">
        <header class="card-head">
          <i data-lucide="bus"></i>
          <strong>sector.transporte</strong>
        </header>
        <div class="card-body kpi-pair">
          <div class="kpi">3,2</div>
          <div class="delta down">−0,2</div>
        </div>
      </article>

      <article class="card" id="sector.seguranca">
        <header class="card-head">
          <i data-lucide="shield"></i>
          <strong>sector.seguranca</strong>
        </header>
        <div class="card-body kpi-pair">
          <div class="kpi">4,0</div>
          <div class="delta stable">delta.stable</div>
        </div>
      </article>

      <article class="card" id="sector.meioambiente">
        <header class="card-head">
          <i data-lucide="leaf"></i>
          <strong>sector.meioambiente</strong>
        </header>
        <div class="card-body kpi-pair">
          <div class="kpi">4,4</div>
          <div class="delta up">+0,1</div>
        </div>
      </article>
    </section>

    <!-- CHARTS ROW -->
    <section class="grid grid-2 charts">
      <article class="panel" id="charts.avg_by_sector">
        <header class="panel-head">
          <i data-lucide="bar-chart-3"></i>
          <strong>charts.avg_by_sector</strong>
          <span class="hint"><i data-lucide="info"></i></span>
        </header>
        <div class="panel-body empty">Colunas (placeholder)</div>
      </article>

      <article class="panel" id="charts.distribution">
        <header class="panel-head">
          <i data-lucide="chart-bar"></i>
          <strong>charts.distribution</strong>
          <span class="hint"><i data-lucide="info"></i></span>
        </header>
        <div class="panel-body empty">Barras (placeholder)</div>
      </article>
    </section>
  </main>

  <!-- Scripts do app -->
  <script src="./main.js"></script>
  <!-- Lucide: correção de renderização de ícones -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script>
    // Garante renderização inicial e re-render após atualizações do DOM
    function renderIconsSafely() {
      if (window.lucide && typeof window.lucide.createIcons === 'function') {
        try { window.lucide.createIcons(); } catch (e) { /* no-op */ }
      }
    }

    document.addEventListener('DOMContentLoaded', renderIconsSafely);

    // Caso o app dispare eventos após atualizar UI (ex.: quando dados chegam do IndexedDB)
    window.addEventListener('ui:updated', renderIconsSafely);

    // Observa mudanças em nós principais para re-render (leve e seguro)
    const mo = new MutationObserver((m) => {
      for (const rec of m) {
        if (rec.addedNodes && rec.addedNodes.length) { renderIconsSafely(); break; }
      }
    });
    mo.observe(document.body, { childList: true, subtree: true });
  </script>
</body>
</html>
