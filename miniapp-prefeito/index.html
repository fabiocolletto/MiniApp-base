<!doctype html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Painel Prefeito ‚Äî Dashboard de Indicadores (v1.0)</title>
  
  <!-- Carrega a biblioteca Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  
  <!-- 1. VINCULA√á√ÉO DO STYLESHEET BASE (Design System) -->
  <!-- Tenta carregar a branch tempor√°ria primeiro: fabiocolletto-patch-1 -->
  <link rel="stylesheet" 
        href="https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base@fabiocolletto-patch-1/miniapp-base/styles.css"
        id="styles-temp"
        onerror="loadFallback('temp')">

  <!-- 2. Fallback para a branch principal (main) -->
  <link rel="stylesheet" 
        href="https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base@main/miniapp-base/styles.css" 
        id="styles-main"
        onerror="loadFallback('main')">

  <style>
    /* Estilos M√≠nimos */
    body { 
      margin: 0; 
      padding: 0; 
      overflow-x: hidden; 
      background-color: var(--background-page); 
      color: var(--text-color-primary);
      font-family: 'Inter', sans-serif;
    }
    
    .chart-container { 
      height: 100%; 
    } 

    /* Ajustes espec√≠ficos de layout */
    .kpi-card p { margin: 0; }
    .kpi-card { 
      min-width: 260px; 
      display: flex; 
      flex-direction: column; 
      justify-content: space-between;
      gap: 8px; /* Adiciona um pequeno gap entre os elementos */
    }

    /* Estilo para o indicador de vers√£o (para que se pare√ßa com uma tag/pill) */
    .version-indicator {
        font-size: 0.75rem; /* var(--font-size-s) */
        padding: 4px 8px; /* var(--space-1) var(--space-2) */
        border-radius: 4px; /* var(--radius-s) */
        margin-left: 12px; /* var(--space-3) */
        font-weight: 500;
        user-select: none;
    }
    .version-indicator.temp {
        background-color: #f59e0b; /* Amarelo/Warn */
        color: #1f2937; /* Cor do texto escuro */
    }
    .version-indicator.main {
        background-color: #3b82f6; /* Azul/Info */
        color: white; 
    }

    /* Sidebar - √çcones para os pain√©is */
    .icon-kpi {
      font-size: 1.2rem;
      margin-right: 4px;
    }

    /* Responsividade da Sidebar */
    @media (max-width: 768px) {
      .version-indicator {
        margin-left: 8px;
        padding: 2px 4px;
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>

  <div id="app-wrapper">
    
    <!-- SIDEBAR -->
    <aside id="sidebar" role="navigation">
      <button id="menu-toggle" class="btn-toggle" aria-label="Abrir e Fechar Menu">
        <span class="app-icon" id="menu-close-icon">‚úñÔ∏è</span>
        <span class="app-icon" id="menu-open-icon">‚ò∞</span>
      </button>

      <ul class="nav-list">
        <li><a href="#" class="nav-item active"><span class="app-icon">üè†</span> <span>Dashboard Geral</span></a></li>
        <li class="separator">Pain√©is de KPI</li>
        <li><a href="#" class="nav-item"><span class="icon-kpi">ü•á</span> <span>K01‚ÄìK05 (Servi√ßos Essenciais)</span></a></li>
        <li><a href="#" class="nav-item"><span class="icon-kpi">ü•à</span> <span>K06‚ÄìK10 (Gest√£o e Finan√ßas)</span></a></li>
        <li><a href="#" class="nav-item"><span class="icon-kpi">ü•â</span> <span>K11‚ÄìK15 (Infraestrutura)</span></a></li>
        <li><a href="#" class="nav-item"><span class="icon-kpi">üèÖ</span> <span>K16‚ÄìK20 (Social e Cultural)</span></a></li>
        <li class="separator">Pessoa</li>
        <li><a href="#" class="nav-item"><span class="app-icon">üë§</span> <span>Vari√°veis Persona (P01‚ÄìP20)</span></a></li>
      </ul>
      
      <div style="padding: 0 var(--space-4); font-size: var(--font-size-s); color: var(--text-color-muted);">
        MiniApp v1.0.0
      </div>
    </aside>

    <!-- CONTE√öDO PRINCIPAL -->
    <div id="main-content">
      
      <!-- HEADER FIXO -->
      <header>
        <div class="header-title-text">
          <h1>Dashboard de Indicadores Transversais</h1>
          <p class="subtitle-with-version">
            KPIs (K01‚ÄìK20) / Escala 1-5 
            <!-- INDICADOR DE VERS√ÉO (Ser√° preenchido pelo JS) -->
            <span id="version-status" class="version-indicator">Carregando...</span>
          </p>
        </div>
      </header>

      <!-- SE√á√ÉO DE CONTE√öDO -->
      
      <!-- CARROSSEL DE KPI'S (K01, K06, K11 - Exemplos dos 3 Pain√©is) -->
      <section class="carousel" style="min-height: 140px; margin-top: 24px;">
        
        <!-- Card 1: K01 - Sa√∫de (Alto) -->
        <article class="card kpi-card">
            <p class="subtitle" style="color: var(--text-color-muted);">K01: Satisfa√ß√£o c/ Sa√∫de (Setor 1)</p>
            <p class="kpi-value success">4.2</p> 
            <p class="description" style="font-size: var(--font-size-s); color: var(--text-color-muted);">M√©dia da Avalia√ß√£o (1-5)</p>
            <span class="tag success">Excelente</span>
        </article>
        
        <!-- Card 2: K06 - Planejamento/Finan√ßas (M√©dio) -->
        <article class="card kpi-card">
            <p class="subtitle" style="color: var(--text-color-muted);">K06: Desempenho Administrativo (Setor 6)</p>
            <p class="kpi-value warn">3.1</p>
            <p class="description" style="font-size: var(--font-size-s); color: var(--text-color-muted);">M√©dia da Avalia√ß√£o (1-5)</p>
            <span class="tag warn">Aten√ß√£o</span>
        </article>
        
        <!-- Card 3: K11 - Obras P√∫blicas e Infraestrutura (Baixo) -->
        <article class="card kpi-card">
            <p class="subtitle" style="color: var(--text-color-muted);">K11: Qualidade da Infraestrutura (Setor 5)</p>
            <p class="kpi-value danger">2.5</p>
            <p class="description" style="font-size: var(--font-size-s); color: var(--text-color-muted);">M√©dia da Avalia√ß√£o (1-5)</p>
            <span class="tag danger">Cr√≠tico</span>
        </article>

        <!-- Card 4: P01 - Variavel de Persona (Exemplo de N√∫mero) -->
        <article class="card kpi-card">
            <p class="subtitle" style="color: var(--text-color-muted);">P01: Idade M√©dia do Participante</p>
            <p class="kpi-value info">38 anos</p>
            <p class="description" style="font-size: var(--font-size-s); color: var(--text-color-muted);">Vari√°vel Persona (P01)</p>
            <span class="tag info">Dados Demogr√°ficos</span>
        </article>
      </section>
      
      <!-- GRID DE GR√ÅFICOS (Foco em K01-K05 e Comparativo Setorial) -->
      <main class="grid" aria-live="polite" style="margin-top: 24px;">
        
        <!-- Gr√°fico de Linha: Evolu√ß√£o da Satisfa√ß√£o ao Longo do Tempo -->
        <article class="card chart-card">
          <div class="chart-header"><h3>Evolu√ß√£o da Satisfa√ß√£o por Setor (1-5)</h3></div>
          <div id="chart_line" class="chart-container"></div>
        </article>

        <!-- Gr√°fico de Barra: Comparativo de Satisfa√ß√£o M√©dia (K06-K10) -->
        <article class="card chart-card">
          <div class="chart-header"><h3>Comparativo de Satisfa√ß√£o M√©dia (Painel K06-K10)</h3></div>
          <div id="chart_bar" class="chart-container"></div>
        </article>
        
        <!-- A√ß√£o em Destaque -->
        <article class="card full-width app-card" style="min-height: auto; flex-direction: row; align-items: center; justify-content: space-between;">
          <h3>Relat√≥rio Detalhado de Resolu√ß√µes e Coment√°rios (K01-K20)</h3>
          <a href="#" class="btn primary">Exportar Dados Brutos</a>
        </article>
        
      </main>

    </div>
  </div>

  <!-- JAVASCRIPT: TOGGLE, GR√ÅFICOS E LOAD CSS -->
  <script>
    const VERSION_STATUS_ELEMENT = document.getElementById('version-status');
    let stylesLoaded = false;

    // Fun√ß√£o para atualizar o status de carregamento e o indicador visual
    function updateLoadStatus(version, success = true) {
        if (stylesLoaded) return; // Se j√° carregou, ignora outros eventos

        stylesLoaded = true;
        VERSION_STATUS_ELEMENT.textContent = `CSS: Branch ${version}`;
        VERSION_STATUS_ELEMENT.classList.remove('temp', 'main');
        
        if (success) {
            VERSION_STATUS_ELEMENT.classList.add(version);
            if (version === 'temp') {
                console.log('Design System carregado da branch TEMPOR√ÅRIA.');
            } else {
                console.warn('Design System carregado da branch MAIN (Fallback).');
            }
        } else {
            VERSION_STATUS_ELEMENT.textContent = 'CSS: ERRO FATAL';
            VERSION_STATUS_ELEMENT.style.backgroundColor = 'red';
            console.error('Falha ao carregar o Design System de ambas as fontes.');
        }
        
        // Uma vez que o CSS est√° carregado, os gr√°ficos podem ser desenhados.
        google.charts.setOnLoadCallback(drawAllCharts);
    }
    
    // Configura listeners para o carregamento bem-sucedido
    document.getElementById('styles-temp').onload = () => updateLoadStatus('temp');
    document.getElementById('styles-main').onload = () => updateLoadStatus('main');


    // Fun√ß√£o que √© chamada em caso de erro no carregamento
    function loadFallback(failedVersion) {
        if (failedVersion === 'temp') {
            console.warn('Falha ao carregar branch TEMPOR√ÅRIA. O Fallback MAIN deve tentar carregar em seguida.');
        } else if (failedVersion === 'main') {
            // Se at√© o main falhar, exibe erro final
            updateLoadStatus('main', false);
        }
    }


    // === L√≥gica do Toggle do Menu ===
    document.addEventListener('DOMContentLoaded', () => {
      const wrapper = document.getElementById('app-wrapper');
      const toggleButton = document.getElementById('menu-toggle');
      
      // Assume-se que o CSS da sidebar est√° carregado para definir o estado inicial
      wrapper.classList.remove('closed'); 
      
      toggleButton.addEventListener('click', () => {
        wrapper.classList.toggle('closed');
        // Redesenha os gr√°ficos para corrigir o tamanho ap√≥s o toggle
        drawAllCharts(); 
      });
    });

    // === L√≥gica dos Gr√°ficos (Google Charts) ===
    google.charts.load('current', {'packages':['corechart', 'bar']});

    // Helper para obter vari√°veis CSS, essencial para o tema din√¢mico
    const getCssVar = (name, fallback) => {
        try {
            const value = getComputedStyle(document.body).getPropertyValue(name).trim();
            return value || fallback;
        } catch (e) {
            return fallback || '#000000'; 
        }
    };

    function drawAllCharts() {
        // Verifica se os elementos existem antes de tentar desenhar
        if (document.getElementById('chart_line')) drawLineChart();
        if (document.getElementById('chart_bar')) drawBarChart();
    }

    // Gr√°fico de Linha: Evolu√ß√£o de Satisfa√ß√£o (1-5) - Setores 1, 2, 3
    function drawLineChart() {
        const data = google.visualization.arrayToDataTable([
            ['M√™s', 'Sa√∫de (Setor 1)', 'Educa√ß√£o (Setor 2)', 'Mobilidade (Setor 3)'],
            ['Abr', 4.0, 3.8, 3.0], 
            ['Mai', 4.2, 3.9, 3.2], 
            ['Jun', 4.3, 4.1, 3.5], 
            ['Jul', 4.1, 4.0, 3.6], 
            ['Ago', 4.2, 4.2, 3.8], 
            ['Set', 4.4, 4.3, 3.9]
        ]);
        
        const options = {
            hAxis: { 
                title: 'M√™s', 
                textStyle: { color: getCssVar('--text-color-muted', '#64748b') } 
            },
            vAxis: { 
                title: 'N√≠vel (1-5)', 
                viewWindow: { min: 1, max: 5 }, 
                format: 'decimal', // Exibe o valor de 1 a 5
                textStyle: { color: getCssVar('--text-color-muted', '#64748b') } 
            },
            legend: { 
                position: 'bottom', 
                textStyle: { color: getCssVar('--text-color-primary', '#0f172a')} 
            },
            // Cores: Padr√£o, Secund√°ria, e uma cor de feedback
            colors: [
                getCssVar('--color-accent-green', '#16a34a'), 
                getCssVar('--color-brand-secondary', '#0b57d0'), 
                getCssVar('--color-brand-primary', '#ff7a00')
            ],
            chartArea: { width: '90%', height: '70%' },
            backgroundColor: 'transparent',
            animation: { duration: 1000, easing: 'out', startup: true }
        };
        const chart = new google.visualization.LineChart(document.getElementById('chart_line'));
        chart.draw(data, options);
    }

    // Gr√°fico de Barra: Comparativo de Satisfa√ß√£o M√©dia (K06-K10)
    function drawBarChart() {
        const data = google.visualization.arrayToDataTable([
            ['Setor', 'Satisfa√ß√£o M√©dia (1-5)', { role: 'style' }],
            // Simula√ß√£o de cores baseada no resultado (verde=bom, amarelo=alerta, vermelho=cr√≠tico)
            ['Planejamento', 3.1, getCssVar('--color-warning-yellow', '#f59e0b')],
            ['Ass. Social', 3.7, getCssVar('--color-accent-green', '#16a34a')], 
            ['Desenvolvimento', 3.5, getCssVar('--color-brand-secondary', '#0b57d0')],
            ['Meio Ambiente', 2.9, getCssVar('--color-danger-red', '#dc2626')]
        ]);

        const options = {
            title: 'M√©dia dos KPIs K06-K10',
            chartArea: { width: '70%', height: '80%' },
            hAxis: { 
                title: 'N√≠vel (1-5)', 
                minValue: 1, 
                maxValue: 5,
                textStyle: { color: getCssVar('--text-color-muted', '#64748b') } 
            },
            vAxis: { 
                textStyle: { color: getCssVar('--text-color-muted', '#64748b') } 
            },
            legend: { position: 'none' },
            backgroundColor: 'transparent',
            animation: { duration: 1000, easing: 'out', startup: true }
        };
        const chart = new google.visualization.BarChart(document.getElementById('chart_bar'));
        chart.draw(data, options);
    }
    
    // Garante que os gr√°ficos sejam redesenhados ao mudar o tamanho da janela
    window.addEventListener('resize', drawAllCharts, false);

    // Tenta for√ßar o fallback caso os eventos onload/onerror n√£o disparem imediatamente
    window.addEventListener('load', () => {
        setTimeout(() => {
            if (!stylesLoaded) {
                const tempLink = document.getElementById('styles-temp');
                const mainLink = document.getElementById('styles-main');
                
                // Verifica o status de carregamento via `sheet` (pode n√£o funcionar em todos os navegadores/ambientes)
                if (tempLink.sheet) {
                   updateLoadStatus('temp');
                } else if (mainLink.sheet) {
                   updateLoadStatus('main');
                } else {
                   // Se nada carregou, for√ßa o status de erro (fallback de √∫ltimo recurso)
                   updateLoadStatus('main', false);
                }
            }
        }, 3000); // 3 segundos para o CSS carregar
    });

  </script>

</body>
</html>
