<!doctype html>
<html lang="pt-BR" data-theme="light">
<head>
Â  <meta charset="utf-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1">
Â  <title>Painel de Indicadores â€” i18next + Templates (v1.0.0)</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;600&display=swap" rel="stylesheet">
  Â  <link rel="stylesheet" href="/miniapp-base/styles.css?v=1.0.0">
Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base/miniapp-base/styles.css?v=1.0.0" media="print" onload="this.media='all'">
Â  <style>
Â  Â  .modal{position:fixed;inset:0;display:none}
Â  Â  .modal:target{display:block}
Â  Â  .kpi{position:relative}
Â  Â  .kpi details.info{position:absolute;top:6px;right:6px}
Â  Â  .kpi details.info summary{list-style:none;border:none;background:transparent;width:28px;height:28px;display:grid;place-items:center;padding:0}
Â  Â  .kpi details.info[open] .panel{min-width:260px}
Â  </style>
Â  <script src="https://unpkg.com/i18next@23/dist/umd/i18next.min.js"></script>
Â  <script src="https://unpkg.com/i18next-http-backend@2/dist/umd/i18nextHttpBackend.min.js"></script>
</head>
<body>
Â  <header>
Â  Â  <div class="title">
Â  Â  Â  <span class="material-symbols-rounded" aria-hidden="true">insights</span>
Â  Â  Â  <div>
Â  Â  Â  Â  <h1 data-i18n="app.title">MunicÃ­pio de Curitiba â€” Painel de Indicadores</h1>
Â  Â  Â  Â  <p class="subtitle" data-i18n="app.subtitle">VersÃ£o com i18n e templates remotos</p>
Â  Â  Â  </div>
Â  Â  Â  <span class="version" aria-label="versÃ£o do arquivo">v1.0.0</span>
Â  Â  </div>
Â  Â  <div class="toolbar" role="group" aria-label="Controles de exibiÃ§Ã£o">
Â  Â  Â  <div class="split" id="toolbar-split"></div>
Â  Â  </div>
Â  </header>

Â  <section id="persona-bar" class="kpi-bar" aria-label="Resumo de perfil da amostra"></section>
Â  <section id="kpi-bar" class="kpi-bar" aria-label="Indicadores-chave por setor"></section>

Â  <main id="cards" class="grid" aria-live="polite"></main>

Â  <section id="theme" class="modal" aria-labelledby="th1">
Â  Â  <a class="backdrop" href="#" aria-hidden="true"></a>
Â  Â  <div class="sheet compact" role="dialog" aria-modal="true">
Â  Â  Â  <header class="sheet-head">
Â  Â  Â  Â  <h2 id="th1" data-i18n="theme.title">Tema do painel</h2>
Â  Â  Â  Â  <a class="close" href="#" aria-label="Fechar">âœ•</a>
Â  Â  Â  </header>
Â  Â  Â  <div class="sheet-body">
Â  Â  Â  Â  <div class="quickbar" role="group">
          Â  Â  Â  Â  Â  <a class="chipbtn" id="theme-light-btn" href="#" data-theme="light"><span class="material-symbols-rounded">light_mode</span><span data-i18n="theme.light">Claro</span></a>
Â  Â  Â  Â  Â  <a class="chipbtn" id="theme-dark-btn" href="#" data-theme="dark"><span class="material-symbols-rounded">dark_mode</span><span data-i18n="theme.dark">Escuro</span></a>
Â  Â  Â  Â  Â  <a class="chipbtn" id="theme-auto-btn" href="#" data-theme="auto"><span class="material-symbols-rounded">autorenew</span><span data-i18n="theme.auto">AutomÃ¡tico</span></a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <section id="language" class="modal" aria-labelledby="lg1">
Â  Â  <a class="backdrop" href="#" aria-hidden="true"></a>
Â  Â  <div class="sheet compact" role="dialog" aria-modal="true">
Â  Â  Â  <header class="sheet-head">
Â  Â  Â  Â  <h2 id="lg1" data-i18n="lang.title">Idioma do painel</h2>
Â  Â  Â  Â  <a class="close" href="#" aria-label="Fechar">âœ•</a>
Â  Â  Â  </header>
Â  Â  Â  <div class="sheet-body">
Â  Â  Â  Â  <div class="quickbar" role="group">
          Â  Â  Â  Â  Â  <a class="chipbtn" id="lang-pt-btn" href="#" data-lang="pt-BR"><span class="flag">ğŸ‡§ğŸ‡·</span><span data-i18n="lang.pt">PortuguÃªs</span></a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <section id="sync" class="modal" aria-labelledby="gd1">
Â  Â  <a class="backdrop" href="#" aria-hidden="true"></a>
Â  Â  <div class="sheet compact" role="dialog" aria-modal="true">
Â  Â  Â  <header class="sheet-head">
Â  Â  Â  Â  <h2 id="gd1" data-i18n="sync.title">MÃºltiplos dispositivos</h2>
Â  Â  Â  Â  <a class="close" href="#" aria-label="Fechar">âœ•</a>
Â  Â  Â  </header>
Â  Â  Â  <div class="sheet-body">
Â  Â  Â  Â  <p style="margin-top:0;color:var(--muted)" data-i18n="sync.lead">Ative a sincronizaÃ§Ã£o via Google Drive para que suas pesquisas e preferÃªncias fiquem disponÃ­veis em todos os seus dispositivos. VocÃª verÃ¡ um pedido de permissÃ£o do Google.</p>
Â  Â  Â  Â  <div class="subcard" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
Â  Â  Â  Â  Â  <div style="display:flex;flex-direction:column;gap:4px">
Â  Â  Â  Â  Â  Â  <strong data-i18n="sync.ctaTitle">Sincronizar com Google Drive</strong>
Â  Â  Â  Â  Â  Â  <span style="font-size:12px;color:var(--muted)" data-i18n="sync.ctaHint">Armazena configuraÃ§Ãµes e catÃ¡logos de pesquisas no seu Drive, com consentimento.</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button id="sync-toggle" class="btn" aria-pressed="false" title="Habilitar sincronizaÃ§Ã£o"><span class="material-symbols-rounded" aria-hidden="true">cloud_sync</span><span class="sync-label" data-i18n="sync.enable">Permitir e ativar</span></button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <p id="sync-state" style="margin:10px 0 0;color:var(--muted)" data-i18n="sync.state.off">SincronizaÃ§Ã£o desativada</p>
Â  Â  Â  Â  <div id="sync-tip" class="pill info" style="margin-top:10px;display:none"></div>
Â  Â  Â  Â  <div style="display:flex;justify-content:flex-end;margin-top:10px">
Â  Â  Â  Â  Â  <a id="sync-open-tab" class="btn" href="#" style="display:none" title="Abrir em nova aba"><span class="material-symbols-rounded">open_in_new</span><span data-i18n="sync.openTab">Abrir em nova aba</span></a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

  <section id="kpi-saude" class="modal" aria-labelledby="k1"><a class="backdrop" href="#" aria-hidden="true"></a><div class="sheet compact" role="dialog" aria-modal="true"><header class="sheet-head"><h2 id="k1">SaÃºde â€” resumo do setor</h2><a class="close" href="#" aria-label="Fechar">âœ•</a></header><div class="sheet-body"><p class="subtitle">15 indicadores conceituais padrÃ£o. Este painel replica o layout dos detalhes dos grÃ¡ficos, com foco no setor.</p></div></div></section>
  <section id="kpi-educacao" class="modal" aria-labelledby="k2"><a class="backdrop" href="#" aria-hidden="true"></a><div class="sheet compact" role="dialog" aria-modal="true"><header class="sheet-head"><h2 id="k2">EducaÃ§Ã£o â€” resumo do setor</h2><a class="close" href="#" aria-label="Fechar">âœ•</a></header><div class="sheet-body"><p class="subtitle">15 indicadores conceituais padrÃ£o.</p></div></div></section>
  <section id="kpi-transporte" class="modal" aria-labelledby="k3"><a class="backdrop" href="#" aria-hidden="true"></a><div class="sheet compact" role="dialog" aria-modal="true"><header class="sheet-head"><h2 id="k3">Transporte â€” resumo do setor</h2><a class="close" href="#" aria-label="Fechar">âœ•</a></header><div class="sheet-body"><p class="subtitle">15 indicadores conceituais padrÃ£o.</p></div></div></section>
  <section id="kpi-seguranca" class="modal" aria-labelledby="k4"><a class="backdrop" href="#" aria-hidden="true"></a><div class="sheet compact" role="dialog" aria-modal="true"><header class="sheet-head"><h2 id="k4">SeguranÃ§a â€” resumo do setor</h2><a class="close" href="#" aria-label="Fechar">âœ•</a></header><div class="sheet-body"><p class="subtitle">15 indicadores conceituais padrÃ£o.</p></div></div></section>
  <section id="kpi-meioambiente" class="modal" aria-labelledby="k5"><a class="backdrop" href="#" aria-hidden="true"></a><div class="sheet compact" role="dialog" aria-modal="true"><header class="sheet-head"><h2 id="k5">Meio ambiente â€” resumo do setor</h2><a class="close" href="#" aria-label="Fechar">âœ•</a></header><div class="sheet-body"><p class="subtitle">15 indicadores conceituais padrÃ£o.</p></div></div></section>

Â  <section id="info-modal" class="modal" aria-label="InformaÃ§Ãµes"></section>

Â  <footer data-i18n="app.footer">Base preparada para i18n (i18next) e templates externos versionados.</footer>

Â  <script>
    // CORREÃ‡Ã•ES I18N
    // Caminho relativo para os JSONs locais do miniapp-prefeito/i18n/locales/
Â    const I18N_BACKEND_PATH = 'i18n/locales/{{lng}}/{{ns}}.json';
    // Adicionando namespaces especÃ­ficos do MiniApp
Â    const I18N_NAMESPACES = ['common','kpi','charts','reports', 'miniapp_prefeito', 'system'];
    
    // CONSTANTES DE PERSISTÃŠNCIA
    const THEME_STORAGE_KEY = 'miniapp-prefeito-theme';
    const LANG_STORAGE_KEY = 'miniapp-prefeito-lang';

Â  window.__INDEXED_LIB_CANDIDATES__ = [
Â  Â  'modules/indexed/indexed.min.js','modules/indexed/indexed.js',
Â  Â  'https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base/modules/indexed/indexed.min.js',
Â  Â  'https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base/modules/indexed/indexed.js',
Â  Â  'https://raw.githubusercontent.com/fabiocolletto/MiniApp-base/main/modules/indexed/indexed.min.js',
Â  Â  'https://raw.githubusercontent.com/fabiocolletto/MiniApp-base/main/modules/indexed/indexed.js'
Â  ];
Â  window.__RELATORIO_LIB_CANDIDATES__ = [
Â  Â  'miniapp-base/relatorio_utils.js','/miniapp-base/relatorio_utils.js','modules/relatorio_utils.js',
Â  Â  'https://cdn.jsdelivr.net/gh/fabiocolletto/MiniApp-base/miniapp-base/relatorio_utils.js',
Â  Â  'https://raw.githubusercontent.com/fabiocolletto/MiniApp-base/main/miniapp-base/relatorio_utils.js'
Â  ];

Â  function applyI18n(root){
Â  Â  try{ (root||document).querySelectorAll('[data-i18n]').forEach(function(n){ var k=n.getAttribute('data-i18n'); if(k) n.textContent = i18next.t(k); }); }catch(_){ }
Â  }
Â  function $t(k){ try{ return i18next.t(k) || k; }catch(_){ return k; } }


    // --- LÃ“GICA DE TEMA ---
Â  function applyTheme(theme) {
Â  Â  Â  const html = document.documentElement;
Â  Â  Â  window.location.hash = ''; // Fecha o modal
Â  Â  Â Â 
Â  Â  Â  if (theme === 'auto') {
Â  Â  Â  Â  Â  html.removeAttribute('data-theme');
Â  Â  Â  Â  Â  localStorage.removeItem(THEME_STORAGE_KEY);
Â  Â  Â  } else {
Â  Â  Â  Â  Â  html.setAttribute('data-theme', theme);
Â  Â  Â  Â  Â  localStorage.setItem(THEME_STORAGE_KEY, theme);
Â  Â  Â  }
Â  }

Â  function loadInitialTheme() {
Â  Â  Â  const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
Â  Â  Â  const html = document.documentElement;

Â  Â  Â  if (savedTheme === 'auto') {
Â  Â  Â  Â  Â  html.removeAttribute('data-theme');
Â  Â  Â  } else if (savedTheme) {
Â  Â  Â  Â  Â  html.setAttribute('data-theme', savedTheme);
Â  Â  Â  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
Â  Â  Â  Â  Â  html.setAttribute('data-theme', 'dark');
Â  Â  Â  } else {
Â  Â  Â  Â  Â  html.setAttribute('data-theme', 'light');
Â  Â  Â  }
Â  }

Â  function bindThemeToggles() {
Â  Â  Â  const themeModal = document.getElementById('theme');
Â  Â  Â  if (!themeModal) return;

Â  Â  Â  themeModal.querySelectorAll('.chipbtn').forEach(button => {
Â  Â  Â  Â  Â  const theme = button.getAttribute('data-theme');
Â  Â  Â  Â  Â  if (theme) {
Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  applyTheme(theme);
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  }
Â  Â  Â  });
Â  }
    // --- FIM LÃ“GICA DE TEMA ---


    // --- LÃ“GICA DE IDIOMA ---
    function applyLanguage(lang) {
        const newLang = lang || 'pt-BR';
        localStorage.setItem(LANG_STORAGE_KEY, newLang);
        window.location.hash = '';

        // Se o i18next jÃ¡ estiver rodando, muda e re-renderiza
        if (window.i18next && i18next.isInitialized) {
            i18next.changeLanguage(newLang).then(() => {
                renderToolbar(); // RE-RENDERIZA A TOOLBAR com novo idioma
                renderPersona(); // RE-RENDERIZA PERSONA
                renderKPIs();    // RE-RENDERIZA KPIs
                renderIndicators(); // RE-RENDERIZA INDICATORS
                applyI18n(document); // Aplica em todo o resto
            });
        }
        document.documentElement.lang = newLang;
    }

    function loadInitialLanguage() {
        const savedLang = localStorage.getItem(LANG_STORAGE_KEY) || document.documentElement.lang || 'pt-BR';
        document.documentElement.lang = savedLang;
        return savedLang;
    }

    function bindLanguageToggles() {
        const langModal = document.getElementById('language');
        if (!langModal) return;

        langModal.querySelectorAll('.chipbtn').forEach(button => {
            const lang = button.getAttribute('data-lang');
            if (lang) {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    applyLanguage(lang);
                });
            }
        });
    }
    // --- FIM LÃ“GICA DE IDIOMA ---


Â  (function loadScripts(){
Â  Â  function loadOne(list, cb){ if(!list||!list.length) return cb&&cb(); var src=list.shift(); var s=document.createElement('script'); s.src=src; s.async=true; s.onload=function(){ cb&&cb(true,src); }; s.onerror=function(){ loadOne(list, cb); }; document.head.appendChild(s); }
Â  Â  loadOne(window.__INDEXED_LIB_CANDIDATES__.slice(), function(){ loadOne(window.__RELATORIO_LIB_CANDIDATES__.slice(), function(){ initI18n(); }); });
Â  })();

Â  function initI18n(){
    const initialLang = loadInitialLanguage(); // Usa o idioma persistido ou padrÃ£o
Â  Â  try{
Â  Â  Â  i18next.use(i18nextHttpBackend).init({
Â  Â  Â  Â  lng: initialLang, // Usa o idioma inicial persistido
Â  Â  Â  Â  fallbackLng: 'pt-BR',
Â  Â  Â  Â  ns: I18N_NAMESPACES,
Â  Â  Â  Â  defaultNS: 'common',
Â  Â  Â  Â  backend: { loadPath: I18N_BACKEND_PATH },
Â  Â  Â  Â  interpolation: { escapeValue: false }
Â  Â  Â  }).then(function(){ initPanel(); });
Â  Â  }catch(e){ initPanel(); }
Â  }

Â  function report(kind, state, text){ try{ (window.relatorio||window.Relatorio)?.status?.(kind, state, text); }catch(_){} }

Â  function renderToolbar(){
Â  Â  var el=document.getElementById('toolbar-split');
Â  Â  if(!el) return;
Â  Â  el.innerHTML=''
Â  Â  Â  + '<a class="btn" href="#filters" title="Filtrar"><span class="material-symbols-rounded" aria-hidden="true">filter_list</span>'+$t('toolbar.filters')+'</a>'
Â  Â  Â  + '<a class="btn" href="#manage-studies" title="Pesquisas"><span class="material-symbols-rounded" aria-hidden="true">inventory_2</span>'+$t('toolbar.studies')+'</a>'
Â  Â  Â  + '<a class="btn" href="#theme" title="Tema"><span class="material-symbols-rounded" aria-hidden="true">light_mode</span>'+$t('toolbar.theme')+'</a>'
Â  Â  Â  + '<a class="btn" href="#language" title="Idioma"><span class="material-symbols-rounded" aria-hidden="true">translate</span>'+$t('toolbar.language')+'</a>'
Â  Â  Â  + '<a class="btn" href="#sync" id="toolbar-sync" title="Multi"><span class="material-symbols-rounded" aria-hidden="true">devices</span>'+$t('toolbar.multidevice')+'<span id="toolbar-sync-dot" class="status-dot" aria-hidden="true"></span></a>';
Â  }
  // ... (renderPersona, renderKPIs, renderIndicators permanecem inalteradas, mas garantem a traduÃ§Ã£o via $t() na primeira renderizaÃ§Ã£o) ...

Â  function renderPersona(){
Â  Â  var wrap=document.getElementById('persona-bar');
Â  Â  var cards=[
Â  Â  Â  {id:'p-genero', icon:'diversity_3', title:$t('persona.gender'), value:'â™€ 54% Â· â™‚ 44% Â· â„ 2%', hint:$t('persona.hint')||'ApÃ³s filtros'},
Â  Â  Â  {id:'p-idade', icon:'cake', title:$t('persona.age'), value:'25â€“34 (31%) Â· 35â€“44 (27%)', hint:$t('persona.hint')||'Faixas dominantes'},
Â  Â  Â  {id:'p-bairro', icon:'location_city', title:$t('persona.neighborhood'), value:'BoqueirÃ£o, CIC, Bairro Novo', hint:$t('persona.hintTop')||'Top 3'}
Â  Â  ];
Â  Â  wrap.innerHTML=cards.map(function(c){
Â  Â  Â  return '<div class="kpi" role="group" aria-label="'+c.title+'">\
Â  Â  Â  Â  <div class="label"><span class="material-symbols-rounded">'+c.icon+'</span><span>'+c.title+'</span></div>\
Â  Â  Â  Â  <div class="value" style="font-size:18px">'+c.value+'</div>\
Â  Â  Â  Â  <div class="delta neutral" style="opacity:.8">'+c.hint+'</div>\
Â  Â  Â  </div>';
Â  Â  }).join('');
Â  }

Â  function renderKPIs(){
Â  Â  var list=[
Â  Â  Â  {id:'saude', icon:'vaccines', label:$t('sector.saude'), val:'4,2', delta:'+0,3', cls:'positive', summaryKey:'reports.kpi.saude.summary'},
Â  Â  Â  {id:'educacao', icon:'school', label:$t('sector.educacao'), val:'3,8', delta:$t('delta.stable'), cls:'neutral', summaryKey:'reports.kpi.educacao.summary'},
Â  Â  Â  {id:'transporte', icon:'directions_bus', label:$t('sector.transporte'), val:'3,2', delta:'-0,2', cls:'negative', summaryKey:'reports.kpi.transporte.summary'},
Â  Â  Â  {id:'seguranca', icon:'shield_person', label:$t('sector.seguranca'), val:'4,0', delta:$t('delta.stable'), cls:'neutral', summaryKey:'reports.kpi.seguranca.summary'},
Â  Â  Â  {id:'meioambiente', icon:'eco', label:$t('sector.meioambiente'), val:'4,4', delta:'+0,1', cls:'positive', summaryKey:'reports.kpi.meioambiente.summary'}
Â  Â  ];
Â  Â  var wrap=document.getElementById('kpi-bar');
Â  Â  wrap.innerHTML=list.map(function(s){
Â  Â  Â  return '<div class="kpi" role="group" aria-label="'+s.label+'">\
Â  Â  Â  Â  <details class="info"><summary aria-label="InformaÃ§Ãµes"><span class="material-symbols-rounded" aria-hidden="true">info</span></summary>\
Â  Â  Â  Â  Â  <div class="panel" role="dialog" aria-labelledby="kpi-'+s.id+'"><h4>'+s.label+'</h4><p data-i18n="'+s.summaryKey+'">'+i18next.t(s.summaryKey,{avg:s.val,delta:s.delta})+'</p><p class="hint" data-i18n="info.hint">Toque no Ã­cone novamente para fechar.</p></div>\
Â  Â  Â  Â  </details>\
Â  Â  Â  Â  <div class="label"><span class="material-symbols-rounded">'+s.icon+'</span><span>'+s.label+'</span></div>\
Â  Â  Â  Â  <div class="value">'+s.val+'</div>\
Â  Â  Â  Â  <div class="delta '+s.cls+'"><span class="material-symbols-rounded" aria-hidden="true" style="font-size:16px">'+(s.cls==='positive'?'trending_up':s.cls==='negative'?'trending_down':'trending_flat')+'</span>'+s.delta+'</div>\
Â  Â  Â  </div>';
Â  Â  }).join('');
Â  }

Â  function renderIndicators(){
Â  Â  var cards=[
Â  Â  Â  {id:'sector-avg', icon:'bar_chart_4_bars', title:$t('charts.avg_by_sector'), infoTitle:$t('info.howto.title'), infoCopy:$t('info.howto.copy'), infoHint:$t('info.hint'), ph:'Colunas (placeholder)'},
Â  Â  Â  {id:'distribution', icon:'stacked_bar_chart', title:$t('charts.distribution'), infoTitle:$t('info.howto.title'), infoCopy:$t('charts.distributionDesc')||'ProporÃ§Ã£o apÃ³s filtros.', infoHint:$t('info.hint'), ph:'Barras empilhadas (placeholder)'},
Â  Â  Â  {id:'trend-sector', icon:'show_chart', title:$t('charts.trendBySector')||'TendÃªncia mensal por setor', infoTitle:$t('info.howto.title'), infoCopy:$t('charts.trendBySectorDesc')||'EvoluÃ§Ã£o das mÃ©dias mensais.', infoHint:$t('info.hint'), ph:'Linhas (placeholder)'},
Â  Â  Â  {id:'reviews-month', icon:'insert_chart', title:$t('charts.reviewsByMonth')||'AvaliaÃ§Ãµes por mÃªs', infoTitle:$t('info.howto.title'), infoCopy:$t('charts.reviewsByMonthDesc')||'Volume de respostas coletadas.', infoHint:$t('info.hint'), ph:'Colunas agrupadas (placeholder)'},
Â  Â  Â  {id:'map-bairros', icon:'map', title:$t('charts.mapByNeighborhood')||'Mapa do municÃ­pio â€” pontos por bairro', infoTitle:$t('info.howto.title'), infoCopy:$t('charts.mapByNeighborhoodDesc')||'DistribuiÃ§Ã£o espacial.', infoHint:$t('info.hint'), ph:'Mapa (placeholder)'},
Â  Â  Â  {id:'share-sector', icon:'pie_chart', title:$t('charts.shareBySector')||'ParticipaÃ§Ã£o por setor', infoTitle:$t('info.howto.title'), infoCopy:$t('charts.shareBySectorDesc')||'Percentual por setor.', infoHint:$t('info.hint'), ph:'Pizza (placeholder)'}
Â  Â  ];
Â  Â  var grid=document.getElementById('cards');
Â  Â  grid.innerHTML=cards.map(function(c){ return '<section class="card" aria-labelledby="t-'+c.id+'">\
Â  Â  Â  <h3 id="t-'+c.id+'"><span class="material-symbols-rounded" aria-hidden="true">'+c.icon+'</span>'+c.title+'</h3>\
Â  Â  Â  <details class="info"><summary aria-label="InformaÃ§Ãµes"><span class="material-symbols-rounded" aria-hidden="true">info</span></summary>\
Â  Â  Â  <div class="panel" role="dialog" aria-labelledby="t-'+c.id+'"><p>'+c.infoCopy+'</p><p class="hint">'+c.infoHint+'</p></div></details>\
Â  Â  Â  <div class="ph">'+c.ph+'</div></section>'; }).join('');
Â  }

Â  async function initPanel(){
Â  Â  // GARANTE QUE A ORDEM DE RENDERIZAÃ‡ÃƒO ESTÃ CORRETA
Â  Â  renderToolbar();
Â  Â  renderPersona();
Â  Â  renderKPIs();
Â  Â  renderIndicators();

    // APLICAR I18N DEPOIS QUE OS ELEMENTOS FORAM CRIADOS POR renderXXX()
Â  Â  applyI18n(document);

Â  Â  // CONECTA OS EVENTOS DE TEMA E IDIOMA APÃ“S O DOM SER RENDERIZADO
Â  Â  bindThemeToggles();
    bindLanguageToggles();
Â  Â  
    // ... (LÃ³gica de IndexedDB e Sync permanece inalterada) ...

Â  Â  if(window.indexed && window.indexed.open){
Â  Â  Â  await window.indexed.open('PainelPrefeitoDB', 1, function(db, stores){ window.indexed.stores = stores||window.indexed.stores||{}; if(!window.indexed.stores.config){ window.indexed.defineStore('config', {keyPath:'key'}); } if(!window.indexed.stores.tpl){ window.indexed.defineStore('tpl', {keyPath:'key'});} });
Â  Â  }

Â  Â  const btn = document.getElementById('sync-toggle');
Â  Â  const openTab = document.getElementById('sync-open-tab');
Â  Â  const ready = {ok:true};
Â  Â  if(openTab){ openTab.style.display = 'none'; }
Â  Â  if(btn){ btn.addEventListener('click', async function(){ const on = btn.getAttribute('aria-pressed')==='true'; if(on){ await setSyncEnabled(false); report('drive','off','sync desativada'); return;} showSyncTip('Solicitando permissÃ£o do Googleâ€¦'); setTimeout(async function(){ await setSyncEnabled(true); showSyncTip('SincronizaÃ§Ã£o ativada'); }, 500); }); }

Â  Â  document.addEventListener('click', function(e){
Â  Â  Â  document.querySelectorAll('details.info[open]').forEach(function(d){ if(!d.contains(e.target)) d.removeAttribute('open'); });
Â  Â  });
Â  Â  document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ document.querySelectorAll('details.info[open]').forEach(function(d){ d.removeAttribute('open'); }); } });
Â  }

  function showSyncTip(message, warn){ var el=document.getElementById('sync-tip'); if(!el) return; el.textContent = message || ''; el.style.display = message? 'inline-flex':'none'; el.classList.remove('ok','warn','info'); el.classList.add(warn? 'warn':'ok'); var dot=document.getElementById('toolbar-sync-dot'); if(dot){ dot.className = 'status-dot ' + (warn? 'err':'ok'); dot.title = message || (warn? 'Problema de sincronizaÃ§Ã£o' : 'SincronizaÃ§Ã£o ok'); } }
  function updateSyncUI(enabled){ var tbtn=document.getElementById('toolbar-sync'); if(tbtn){ tbtn.dataset.active = enabled? 'true':'false'; } var dot=document.getElementById('toolbar-sync-dot'); if(dot){ dot.className = 'status-dot ' + (enabled? 'ok':'warn'); } var sbtn=document.getElementById('sync-toggle'); var lab=sbtn? sbtn.querySelector('.sync-label'):null; if(sbtn){ sbtn.setAttribute('aria-pressed', enabled? 'true':'false'); if(lab) lab.textContent = enabled? 'Ativado (clique para desligar)' : 'Permitir e ativar'; } var st=document.getElementById('sync-state'); if(st){ st.textContent = enabled? 'SincronizaÃ§Ã£o ativada' : 'SincronizaÃ§Ã£o desativada'; } }
  async function setSyncEnabled(enabled){ if(!(window.indexed && window.indexed.put && window.indexed.stores && window.indexed.stores.config)){ updateSyncUI(enabled); return; } await window.indexed.put(window.indexed.stores.config, {key:'sync_enabled', value:!!enabled, ts:Date.now()}); updateSyncUI(enabled); }


Â  // Garante que o tema seja carregado antes de qualquer outra inicializaÃ§Ã£o, masÂ 
Â  // que o initI18n e initPanel sÃ³ rodem apÃ³s o DOM estar carregado.
Â  initThemeSystem();
Â  if(document.readyState!=='loading') initI18n(); else document.addEventListener('DOMContentLoaded', initI18n);
Â  </script>
</body>
</html>
