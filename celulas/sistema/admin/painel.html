<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Admin</title>
  <script>
    async function init() {
      try {
        const admin = await window.AppShell?.getAdmin?.();

        if (!admin) {
          document.getElementById('mode').innerText = 'Nenhum administrador encontrado. Preencha para iniciar o sistema.';
          document.getElementById('adminForm').style.display = 'block';
          return;
        }

        document.getElementById('mode').innerText = 'Administrador carregado';
        document.getElementById('adminName').innerText = admin.nome || 'Sem nome registrado';
        document.getElementById('loadedView').style.display = 'block';

      } catch (err) {
        document.getElementById('mode').innerText = 'Erro ao carregar dados do administrador';
      }
    }

    async function salvarAdmin(event) {
      event.preventDefault();

      const nome = document.getElementById('formNome').value.trim();
      const email = document.getElementById('formEmail').value.trim();

      const novoAdmin = { nome, email };

      try {
        await window.AppShell?.saveAdmin?.(novoAdmin);
        document.getElementById('mode').innerText = 'Administrador registrado com sucesso';
        document.getElementById('adminForm').style.display = 'none';
        document.getElementById('adminName').innerText = nome;
        document.getElementById('loadedView').style.display = 'block';
      } catch (err) {
        document.getElementById('mode').innerText = 'Falha ao registrar administrador';
      }
    }

    window.onload = init;
  </script>
</head>
<body style="font-family: sans-serif; padding: 20px;">
  <h1>Painel do Administrador</h1>
  <p id="mode">Carregando...</p>

  <!-- FORMULÁRIO EXIBIDO QUANDO NÃO HÁ ADMIN -->
  <form id="adminForm" style="display:none; margin-top:20px;" onsubmit="salvarAdmin(event)">
    <label>Nome<br>
      <input id="formNome" type="text" required style="width:100%; padding:8px; margin-top:4px;" />
    </label>
    <br><br>
    <label>Email<br>
      <input id="formEmail" type="email" required style="width:100%; padding:8px; margin-top:4px;" />
    </label>
    <br><br>
    <button type="submit" style="padding:10px 16px;">Salvar Administrador</button>
  </form>

  <!-- VISUALIZAÇÃO QUANDO O ADMIN JÁ EXISTE -->
  <div id="loadedView" style="display:none; margin-top:20px;">
    <p><strong>Administrador:</strong> <span id="adminName">...</span></p>
  </div>
</body>
</html>
