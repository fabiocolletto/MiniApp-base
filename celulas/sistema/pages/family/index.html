<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App Família – 5Horas</title>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    :root {
      --color-primary: #2563eb;
      --color-muted: #6b7280;
      --color-bg: #f5f7fa;
      --color-card-bg: #ffffff;
      --color-border: #e5e7eb;
      --header-height: 56px;
      --footer-height: 70px;
      --content-padding: 16px;
      --content-available: calc(100vh - var(--header-height) - var(--footer-height));
    }

    body {
      margin: 0;
      background: var(--color-card-bg);
      font-family: "Inter", sans-serif;
      min-height: 100vh;
      overflow: hidden;
    }

    /* MINI TAILWIND */
    .u-flex { display:flex; }
    .u-flex-col { flex-direction:column; }
    .u-items-center { align-items:center; }
    .u-justify-center { justify-content:center; }
    .u-justify-between { justify-content:space-between; }
    .u-p4 { padding:16px; }
    .u-p3 { padding:12px; }
    .u-p2 { padding:8px; }
    .u-gap2 { gap:8px; }
    .u-gap3 { gap:12px; }
    .u-text-center { text-align:center; }
    .u-text-muted { color:var(--color-muted); }
    .u-rounded { border-radius:14px; }
    .u-rounded-lg { border-radius:20px; }
    .u-w-full { width:100%; }
    .u-h-full { height:100%; }
    .u-m3 { margin:12px; }

    .app-header {
      position:fixed;
      top:0;
      left:0;
      right:0;
      height:var(--header-height);
      backdrop-filter:blur(10px);
      background: var(--color-card-bg);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:var(--content-padding);
      box-sizing: border-box;
    }

    .app-body {
      box-sizing: border-box;
      margin-top: var(--header-height);
      margin-bottom: var(--footer-height);
      min-height: var(--content-available);
      max-height: var(--content-available);
      overflow-y: auto;
      padding: var(--content-padding);
    }

    .app-footer {
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      height:var(--footer-height);
      background: var(--color-card-bg);
      display:flex;
      justify-content:space-around;
      align-items:center;
      backdrop-filter:blur(8px);
    }

    .footer-btn,
    .header-btn {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      font-size:0.75rem;
      color:var(--color-muted);
      cursor:pointer;
      user-select:none;
    }

    .footer-btn.active,
    .header-btn.active {
      color:var(--color-primary);
    }

    .btn {
      background: var(--color-primary);
      border: none;
      padding: 12px 20px;
      border-radius: 14px;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }

    .card {
      background: var(--color-card-bg);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 16px;
    }

    .embedded-produto {
      height: calc(var(--content-available) - 16px);
      padding: 0;
      overflow: hidden;
    }

    .embedded-produto iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      background: white;
    }
  </style>
</head>

<body>

  <header class="app-header">
    <div class="header-btn" data-cell="menu">
      <span class="material-icons">menu</span>
      <div>Menu</div>
    </div>
    <div id="header-title"></div>
    <div class="header-btn" data-cell="perfil">
      <span class="material-icons">account_circle</span>
      <div>Perfil</div>
    </div>
  </header>

  <main id="app-body" class="app-body"></main>

  <footer class="app-footer">
    <div class="footer-btn active" data-cell="inicio">
      <span class="material-icons">home</span>
      Início
    </div>
    <div class="footer-btn" data-cell="familia">
      <span class="material-icons">group</span>
      Família
    </div>
    <div class="footer-btn" data-cell="governo">
      <span class="material-icons">account_balance</span>
      Governo
    </div>
    <div class="footer-btn" data-cell="avisos">
      <span class="material-icons">notifications</span>
      Avisos
    </div>
    <div class="footer-btn" data-cell="config">
      <span class="material-icons">settings</span>
      Configurações
    </div>
  </footer>

  <script>
    
    (function registrarAdmin() {
      function tentar() {
        if (window.PWAO_RegistrarCelula) {
          window.PWAO_RegistrarCelula({
            nome: "sistema.admin",
            caminho: "./celulas/sistema/pages/family/index.html",
            orgao: "sistema",
            versao: "1.0.0",
            descricao: "Célula administrativa e de tokens OPP"
          });
          return;
        }
        setTimeout(tentar, 60);
      }
      tentar();
    })();

    const produtosGoverno = [
      {
        nome: "governo.produtos.recibo-diarias",
        caminho: "./celulas/governo/produtos/recibo-diarias.js",
        descricao: "Recibo de diárias e prestação de contas",
        titulo: "Recibo de Diárias"
      },
      {
        nome: "governo.produtos.recibo-diarias.organico",
        caminho: "./celulas/governo/produtos/recibo-diarias-organico.html",
        descricao: "Versão orgânica e simplificada do recibo de diárias",
        titulo: "Recibo Orgânico"
      }
    ];

    renderCell("tokens");
    function renderWelcome() {
      document.getElementById("header-title").textContent = "";
      document.getElementById("app-body").innerHTML = `
        <div class="u-flex u-flex-col u-justify-center u-items-center u-text-center u-p4" style="min-height:var(--content-available)">
          <div style="font-size:1.6rem;font-weight:600;color:var(--color-primary);">Bem-vindo ao App Família</div>
          <p class="u-text-muted">Gerencie perfis, vínculos e permissões.</p>
          <button class="btn u-m3" data-cell="inicio">Acessar</button>
        </div>`;

      document.querySelector("button.btn").onclick = () => renderCell("inicio");
    }

    function renderHome() {
      document.getElementById("header-title").textContent = "Início";
      document.getElementById("app-body").innerHTML = `
        <div class="u-flex u-flex-col u-gap3 u-p4">
          <div class="card">Conteúdo da Home</div>
        </div>`;
    }

    function renderFamilia() {
      document.getElementById("header-title").textContent = "Família";
      document.getElementById("app-body").innerHTML = `<div class='u-p4 u-text-center'>Tela Família em construção</div>`;
    }

    function renderGoverno() {
      document.getElementById("header-title").textContent = "Governo";
      document.getElementById("app-body").innerHTML = `
        <div class='u-flex u-flex-col u-gap3 u-p4'>
          <div class='card u-text-center'>
            <div style='font-size:1.2rem;font-weight:600;color:var(--color-primary);'>Linha Governo</div>
            <p class='u-text-muted'>Produtos públicos para servidores e órgãos governamentais.</p>
          </div>
          <div class='card' data-produto-governo='governo.produtos.recibo-diarias' style='cursor:pointer;'>
            <div class='u-flex u-justify-between u-items-center u-gap2'>
              <div class='u-text-left'>
                <div style='font-size:1rem;font-weight:600;color:var(--color-primary);'>Recibo de Diárias</div>
                <p class='u-text-muted'>Abrir modelo de prestação de contas e recibos em PDF.</p>
              </div>
              <span class='material-icons' style='color:var(--color-primary);'>open_in_new</span>
            </div>
          </div>
          <div class='card' data-produto-governo='governo.produtos.recibo-diarias.organico' style='cursor:pointer;'>
            <div class='u-flex u-justify-between u-items-center u-gap2'>
              <div class='u-text-left'>
                <div style='font-size:1rem;font-weight:600;color:var(--color-primary);'>Recibo Orgânico</div>
                <p class='u-text-muted'>Célula viva para montar diárias com auto-preenchimento.</p>
              </div>
              <span class='material-icons' style='color:var(--color-primary);'>open_in_new</span>
            </div>
          </div>
        </div>`;

      document.querySelectorAll('[data-produto-governo]').forEach(card => {
        card.addEventListener('click', () => {
          abrirProdutoGoverno(card.dataset.produtoGoverno);
        });
      });
    }

    async function abrirProdutoGoverno(nomeProduto) {
      const produto = produtosGoverno.find(item => item.nome === nomeProduto);
      if (!produto) return;

      if (window.PWAO_RegistrarCelula) {
        await window.PWAO_RegistrarCelula({
          nome: produto.nome,
          caminho: produto.caminho,
          orgao: "governo",
          versao: "1.0.0",
          descricao: produto.descricao
        });
      }

      const headerTitle = document.getElementById("header-title");
      const appBody = document.getElementById("app-body");

      headerTitle.textContent = produto.titulo;
      appBody.innerHTML = `
        <div class="card embedded-produto">
          <iframe src="${produto.caminho}" title="${produto.titulo}"></iframe>
        </div>
      `;
    }

    function renderAvisos() {
      document.getElementById("header-title").textContent = "Avisos";
      document.getElementById("app-body").innerHTML = `<div class='u-p4 u-text-center'>Lista de Avisos</div>`;
    }

    function renderConfig() {
      document.getElementById("header-title").textContent = "Configurações";
      document.getElementById("app-body").innerHTML = `<div class='u-p4 u-text-center'>Opções de Configuração</div>`;
    }

    function renderPerfil() {
      document.getElementById("header-title").textContent = "Perfil";
      document.getElementById("app-body").innerHTML = `<div class='u-p4 u-text-center'>Perfil do Usuário</div>`;
    }

    /* ORQUESTRADOR */
    document.querySelectorAll('[data-cell]').forEach(btn => {
      btn.addEventListener('click', () => {
        const cell = btn.dataset.cell;
        renderCell(cell);
        document
          .querySelectorAll('.footer-btn, .header-btn')
          .forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    function renderCell(name) {
      switch (name) {
        case "inicio":
          return renderHome();
        case "familia":
          return renderFamilia();
        case "governo":
          return renderGoverno();
        case "avisos":
          return renderAvisos();
        case "config":
          return renderConfig();
        case "perfil":
          return renderPerfil();
        case "menu":
          return; /* futuro menu lateral */
        default:
          document.getElementById("app-body").innerHTML = `
            <div class='u-p4 u-text-center'>
              <strong>Erro:</strong> célula <strong>${name}</strong> não encontrada.<br>
              Verifique o arquivo <strong>Appfamily Index Html - Revised</strong> na função <strong>renderCell(name)</strong>.
            </div>`;
      }
    }

    renderWelcome();
  </script>

</body>
</html>
